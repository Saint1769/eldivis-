<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldivis Chat - –ü–æ–ª–Ω—ã–π —á–∞—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .server-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .chat-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            height: 80vh;
        }
        
        .server-header {
            background: #2d3748;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .server-status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .server-status.running {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #9ae6b4;
        }
        
        .server-status.stopped {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #feb2b2;
        }
        
        .server-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .server-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .start-btn {
            background: #48bb78;
            color: white;
        }
        
        .start-btn:hover {
            background: #38a169;
        }
        
        .stop-btn {
            background: #f56565;
            color: white;
        }
        
        .stop-btn:hover {
            background: #e53e3e;
        }
        
        .server-log {
            background: #1a202c;
            color: #cbd5e0;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 20px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-time {
            color: #718096;
        }
        
        .log-info {
            color: #68d391;
        }
        
        .log-error {
            color: #fc8181;
        }
        
        .log-success {
            color: #68d391;
        }
        
        .chat-header {
            background: #4a5568;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .connection-status {
            padding: 12px 20px;
            text-align: center;
            font-size: 0.9rem;
            background: #fef3c7;
            color: #92400e;
        }
        
        .connection-status.connected {
            background: #d1fae5;
            color: #065f46;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .message.own {
            align-self: flex-end;
            background: #667eea;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message.other {
            align-self: flex-start;
            background: #f1f5f9;
            color: #2d3748;
            border-bottom-left-radius: 5px;
        }
        
        .message-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .chat-input-container {
            padding: 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
        }
        
        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #cbd5e0;
            border-radius: 25px;
            outline: none;
        }
        
        .message-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .send-button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .send-button:hover {
            background: #5a6fd8;
        }
        
        .send-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 20px;
            color: #2d3748;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .login-button {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .login-button:hover {
            background: #5a6fd8;
        }
        
        .login-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        
        .error-message {
            color: #e53e3e;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .users-online {
            padding: 15px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .users-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .user-badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .chat-panel {
                height: 70vh;
            }
            
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="login-modal" id="loginModal">
        <div class="login-form">
            <h2 class="login-title">–í—Ö–æ–¥ –≤ Eldivis Chat</h2>
            <div class="form-group">
                <input type="text" class="form-input" id="nicknameInput" placeholder="–í–∞—à–µ –∏–º—è" value="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
            </div>
            <div class="form-group">
                <input type="text" class="form-input" id="usernameInput" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —é–∑–µ—Ä–Ω–µ–π–º">
                <div class="error-message" id="usernameError">–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç</div>
            </div>
            <button class="login-button" id="loginButton">–í–æ–π—Ç–∏ –≤ —á–∞—Ç</button>
        </div>
    </div>

    <div class="container">
        <!-- –ü–∞–Ω–µ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ -->
        <div class="server-panel">
            <div class="server-header">
                <h2>üöÄ Eldivis Chat Server</h2>
                <p>–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</p>
            </div>
            
            <div class="server-status running" id="serverStatus">
                ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
            </div>
            
            <div class="server-controls">
                <button class="server-btn start-btn" onclick="startServer()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
                <button class="server-btn stop-btn" onclick="stopServer()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
            </div>
            
            <div>
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:</h3>
                <div id="serverStats">
                    <p>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–Ω–ª–∞–π–Ω: <span id="onlineUsers">0</span></p>
                    <p>üí¨ –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: <span id="totalMessages">0</span></p>
                    <p>üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è: <span id="connections">0</span></p>
                </div>
            </div>
            
            <div class="server-log" id="serverLog">
                <div class="log-entry">
                    <span class="log-time">[00:00:00]</span>
                    <span class="log-info">–°–µ—Ä–≤–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</span>
                </div>
                <div class="log-entry">
                    <span class="log-time">[00:00:00]</span>
                    <span class="log-success">–ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º</span>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —á–∞—Ç–∞ -->
        <div class="chat-panel">
            <div class="chat-header">
                Eldivis Chat
            </div>
            
            <div class="users-online">
                <div class="users-list" id="usersList">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                </div>
            </div>
            
            <div class="connection-status" id="connectionStatus">
                –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div style="text-align: center; color: #718096; padding: 40px;">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Eldivis Chat!<br>
                    –í–æ–π–¥–∏—Ç–µ –≤ —á–∞—Ç —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ.
                </div>
            </div>
            
            <div class="chat-input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
                <button class="send-button" id="sendButton" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== –°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨ ====================
        class ChatServer {
            constructor() {
                this.users = new Map();
                this.messages = [];
                this.connections = new Set();
                this.isRunning = false;
                this.logEntries = [];
            }

            start() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.addLog('–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω', 'success');
                this.addLog('–ü–æ—Ä—Ç: 10000', 'info');
                this.addLog('–ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'success');
                
                // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞
                this.serverInterval = setInterval(() => {
                    this.updateStats();
                }, 2000);
            }

            stop() {
                if (!this.isRunning) return;
                
                this.isRunning = false;
                clearInterval(this.serverInterval);
                this.users.clear();
                this.connections.clear();
                this.addLog('–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'error');
            }

            addLog(message, type = 'info') {
                const time = new Date().toLocaleTimeString();
                this.logEntries.push({ time, message, type });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–∞
                if (this.logEntries.length > 50) {
                    this.logEntries.shift();
                }
                
                this.updateLogDisplay();
            }

            updateLogDisplay() {
                const logContainer = document.getElementById('serverLog');
                logContainer.innerHTML = this.logEntries.map(entry => `
                    <div class="log-entry">
                        <span class="log-time">[${entry.time}]</span>
                        <span class="log-${entry.type}">${entry.message}</span>
                    </div>
                `).join('');
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            updateStats() {
                document.getElementById('onlineUsers').textContent = this.users.size;
                document.getElementById('totalMessages').textContent = this.messages.length;
                document.getElementById('connections').textContent = this.connections.size;
            }

            // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WebSocket –∫–ª–∏–µ–Ω—Ç–∞–º–∏
            handleConnection(socketId) {
                this.connections.add(socketId);
                this.addLog(`–ù–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ${socketId}`, 'info');
                this.updateStats();
            }

            handleDisconnection(socketId) {
                this.connections.delete(socketId);
                
                // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
                for (let [username, user] of this.users.entries()) {
                    if (user.socketId === socketId) {
                        this.users.delete(username);
                        this.addLog(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è: ${user.name}`, 'info');
                        break;
                    }
                }
                
                this.updateStats();
            }

            registerUser(socketId, userData) {
                const username = userData.username.toLowerCase();
                
                if (this.users.has(username)) {
                    return { success: false, message: '–Æ–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç' };
                }

                const user = {
                    id: socketId,
                    name: userData.name,
                    username: username,
                    connectedAt: new Date().toISOString()
                };

                this.users.set(username, user);
                this.addLog(`–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.name} (@${user.username})`, 'success');
                this.updateStats();

                return { 
                    success: true, 
                    user: user,
                    messageHistory: this.messages.slice(-50)
                };
            }

            sendMessage(userData, text) {
                const message = {
                    id: Date.now() + Math.random(),
                    username: userData.username,
                    name: userData.name,
                    text: text.trim(),
                    timestamp: new Date().toLocaleTimeString('ru-RU'),
                    fullTimestamp: new Date().toISOString()
                };

                this.messages.push(message);

                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
                if (this.messages.length > 200) {
                    this.messages.shift();
                }

                this.addLog(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${userData.name}: ${text.substring(0, 30)}...`, 'info');
                this.updateStats();

                return message;
            }

            getUsersList() {
                return Array.from(this.users.values());
            }
        }

        // ==================== –ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨ ====================
        const chatServer = new ChatServer();
        let socket = null;
        let currentUser = null;
        let isConnected = false;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const loginModal = document.getElementById('loginModal');
        const nicknameInput = document.getElementById('nicknameInput');
        const usernameInput = document.getElementById('usernameInput');
        const usernameError = document.getElementById('usernameError');
        const loginButton = document.getElementById('loginButton');
        const connectionStatus = document.getElementById('connectionStatus');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const usersList = document.getElementById('usersList');
        const serverStatus = document.getElementById('serverStatus');

        // –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function startServer() {
            chatServer.start();
            serverStatus.textContent = '‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç';
            serverStatus.className = 'server-status running';
            updateUsersList();
        }

        function stopServer() {
            chatServer.stop();
            serverStatus.textContent = '‚ùå –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            serverStatus.className = 'server-status stopped';
            
            if (isConnected) {
                disconnectFromServer();
            }
            
            usersList.innerHTML = '';
            updateUsersList();
        }

        function connectToServer() {
            if (!chatServer.isRunning) {
                alert('–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å–Ω–∞—á–∞–ª–∞.');
                return;
            }

            console.log('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...');
            connectionStatus.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket
            setTimeout(() => {
                const socketId = 'socket_' + Date.now();
                chatServer.handleConnection(socketId);
                
                isConnected = true;
                connectionStatus.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É';
                connectionStatus.classList.add('connected');
                
                messageInput.disabled = false;
                sendButton.disabled = false;
                
                // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const result = chatServer.registerUser(socketId, currentUser);
                
                if (result.success) {
                    loginModal.style.display = 'none';
                    currentUser.socketId = socketId;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
                    if (result.messageHistory && result.messageHistory.length > 0) {
                        chatMessages.innerHTML = '';
                        result.messageHistory.forEach(msg => addMessageToChat(msg));
                    }
                    
                    updateUsersList();
                    messageInput.focus();
                } else {
                    usernameError.textContent = result.message;
                    usernameError.style.display = 'block';
                    loginButton.disabled = false;
                    loginButton.textContent = '–í–æ–π—Ç–∏ –≤ —á–∞—Ç';
                    disconnectFromServer();
                }
            }, 1000);
        }

        function disconnectFromServer() {
            if (currentUser && currentUser.socketId) {
                chatServer.handleDisconnection(currentUser.socketId);
            }
            
            isConnected = false;
            connectionStatus.textContent = '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞';
            connectionStatus.classList.remove('connected');
            
            messageInput.disabled = true;
            sendButton.disabled = true;
            
            currentUser = null;
            updateUsersList();
        }

        function sendMessage() {
            if (!isConnected || !currentUser) {
                alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É!');
                return;
            }

            const text = messageInput.value.trim();
            if (!text) return;

            const message = chatServer.sendMessage(currentUser, text);
            addMessageToChat(message);
            
            messageInput.value = '';
            scrollToBottom();
        }

        function addMessageToChat(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            
            const isOwnMessage = currentUser && message.username === currentUser.username;
            messageElement.classList.add(isOwnMessage ? 'own' : 'other');
            
            messageElement.innerHTML = `
                <div class="message-text">${message.text}</div>
                <div class="message-info">
                    <span class="message-sender">${message.name}</span>
                    <span class="message-time">${message.timestamp}</span>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function updateUsersList() {
            const users = chatServer.getUsersList();
            usersList.innerHTML = users.map(user => `
                <div class="user-badge">${user.name}</div>
            `).join('');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        loginButton.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim();
            const username = usernameInput.value.trim();
            
            if (!nickname || !username) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                usernameError.textContent = '–Æ–∑–µ—Ä–Ω–µ–π–º –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è';
                usernameError.style.display = 'block';
                return;
            }

            if (username.length < 3) {
                usernameError.textContent = '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤';
                usernameError.style.display = 'block';
                return;
            }

            loginButton.disabled = true;
            loginButton.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            usernameError.style.display = 'none';

            currentUser = {
                name: nickname,
                username: username.toLowerCase()
            };

            connectToServer();
        });

        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            startServer();
            usernameInput.value = 'user_' + Math.floor(Math.random() * 1000);
            nicknameInput.focus();
        });
    </script>
</body>
</html>