<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GameLoaders ‚Äî Hub (VIP, Shop, Frames, Glows, Chat)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
/* =========================
   Base styles
   ========================= */
:root{
  --bg:#071023;
  --panel: rgba(255,255,255,0.03);
  --muted:#9aa6d1;
  --text:#eaf0ff;
  --neon1:#7c4dff;
  --neon2:#00d4ff;
  --accent:#00f7ff;
  --vip-grad: conic-gradient(from 0deg,#ff0044,#ff9900,#ffee00,#00ff77,#00ccff,#7c4dff);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:Inter,system-ui,Arial;background:
  radial-gradient(800px 400px at 10% 10%, rgba(124,77,255,0.06), transparent),
  radial-gradient(600px 300px at 90% 80%, rgba(0,212,255,0.03), transparent),
  var(--bg);
  color:var(--text);-webkit-font-smoothing:antialiased;
}
.container{width:min(1200px,96%);margin:0 auto;padding:18px 0}

/* Header */
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.brand{display:flex;align-items:center;gap:12px;font-weight:800;color:var(--neon1);font-size:20px}
.brand .logo{width:18px;height:18px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 8px 28px rgba(124,77,255,0.2)}
.tabs{display:flex;gap:8px}
.tabbtn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);font-weight:700;cursor:pointer}
.tabbtn.active{color:var(--text);background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 12px 40px rgba(124,77,255,0.12)}

/* Panels */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 40px rgba(2,6,23,0.6);}

/* layout */
.grid{display:grid;gap:12px}
.grid.cols-4{grid-template-columns:repeat(4,1fr)}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
.grid.cols-2{grid-template-columns:repeat(2,1fr)}
.row{display:flex;gap:12px;align-items:center;}

/* cards */
.card{border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);transition:transform .18s,box-shadow .18s}
.card:hover{transform:translateY(-6px);box-shadow:0 20px 60px rgba(0,0,0,0.6)}
.hint{color:var(--muted);font-size:13px}

/* buttons */
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
.btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:white;box-shadow:0 8px 30px rgba(124,77,255,0.14)}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.03)}

/* avatar & profile */
.profile{display:flex;gap:16px;align-items:center}
.avatar-wrap{position:relative;width:140px;height:140px;border-radius:50%;padding:6px;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 18px 48px rgba(124,77,255,0.18)}
.avatar-inner{width:100%;height:100%;border-radius:50%;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(255,255,255,0.02));overflow:hidden;display:flex;align-items:center;justify-content:center;border:4px solid rgba(0,0,0,0.25)}
.avatar-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%}
/* overlay for frames (applied as absolute img) */
.frame-overlay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:148px;height:148px;border-radius:50%;pointer-events:none}

/* glow classes (initially locked until purchase) */
.glow-locked { opacity: 0.0; }
.glow-fire { box-shadow: 0 0 36px 12px rgba(255,90,10,0.75); animation: flicker 1s infinite; }
.glow-water { box-shadow: 0 0 30px 10px rgba(0,160,255,0.7); animation: wave 3s infinite; }
.glow-rainbow { animation: rainbowGlow 5s linear infinite; }
.glow-basic { box-shadow: 0 0 22px 8px rgba(200,200,255,0.6); }

/* animations */
@keyframes rainbowGlow {
  0%{ box-shadow:0 0 32px 12px rgba(255,0,0,0.8) }
  25%{ box-shadow:0 0 32px 12px rgba(255,200,0,0.8) }
  50%{ box-shadow:0 0 32px 12px rgba(0,200,255,0.8) }
  75%{ box-shadow:0 0 32px 12px rgba(120,0,255,0.8) }
  100%{ box-shadow:0 0 32px 12px rgba(255,0,0,0.8) }
}
@keyframes flicker {
  0%,20%,22%,63%,64%,100%{ opacity:1; }
  21%,23%,62%,65%{ opacity:0.3; }
}
@keyframes wave{ 0%{box-shadow:0 0 20px 6px rgba(0,160,255,0.7)} 50%{box-shadow:0 0 40px 18px rgba(0,200,255,0.95)} 100%{box-shadow:0 0 20px 6px rgba(0,160,255,0.7)} }

/* VIP badge */
.vip-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:800;background:var(--vip-grad);background-size:300% 300%;animation: vipMove 5s linear infinite;color:#051022}
@keyframes vipMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* chat */
.chat{display:flex;flex-direction:column;gap:8px;height:380px}
.chat-messages{flex:1;overflow:auto;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
.chat-input{display:flex;gap:8px;margin-top:8px}
.chat-input input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}

/* responsive */
@media(max-width:900px){
  .grid.cols-4{grid-template-columns:repeat(2,1fr)}
  .avatar-wrap{width:110px;height:110px}
}
@media(max-width:520px){
  .grid.cols-4{grid-template-columns:1fr}
  .header{flex-direction:column;gap:8px}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand"><span class="logo"></span> GameLoaders</div>
    <div class="tabs" role="tablist">
      <button class="tabbtn active" id="btn-buy">–ö—É–ø–∏—Ç—å</button>
      <button class="tabbtn" id="btn-vip">VIP</button>
      <button class="tabbtn" id="btn-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tabbtn" id="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tabbtn" id="btn-chat">–ß–∞—Ç</button>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <div id="ui-coins" style="font-weight:800">0 üí∞</div>
      <button class="tabbtn" id="authBtn">–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <!-- BUY PAGE -->
  <section id="page-buy" class="panel" style="margin-top:16px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 style="margin:0">–õ–æ–∞–¥–µ—Ä—ã –¥–ª—è –∏–≥—Ä</h2>
        <div class="hint">Free / Pro / VIP-only ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏ –≤–µ—Ä—Å–∏—é</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="filterGame" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--text)"></select>
        <select id="filterType" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--text)">
          <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
          <option value="free">Free</option>
          <option value="pro">Pro</option>
          <option value="vip">VIP-only</option>
        </select>
      </div>
    </div>

    <div id="loadersGrid" class="grid cols-4" style="margin-top:12px"></div>
  </section>

  <!-- VIP PAGE -->
  <section id="page-vip" class="panel" style="margin-top:16px;display:none">
    <h2 style="margin-top:0">VIP –ø–æ–¥–ø–∏—Å–∫–∏</h2>
    <div class="hint">VIP –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∫ VIP-only —Ä–∞–º–∫–∞–º/–ª–æ–∞–¥–µ—Ä–∞–º –∏ –±–æ–Ω—É—Å—ã</div>
    <div class="grid cols-3" style="margin-top:12px">
      <div class="card">
        <h3>1 –º–µ—Å—è—Ü</h3><div class="muted">–ë–æ–Ω—É—Å: +5 —É—Ä–æ–≤–Ω–µ–π</div>
        <div style="margin-top:10px"><button class="btn primary" onclick="buyVIP('month',299)">–ö—É–ø–∏—Ç—å 299 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>12 –º–µ—Å—è—Ü–µ–≤</h3><div class="muted">–õ—É—á—à–µ –ø–æ —Ü–µ–Ω–µ</div>
        <div style="margin-top:10px"><button class="btn primary" onclick="buyVIP('year',2870)">–ö—É–ø–∏—Ç—å 2870 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ</h3><div class="muted">VIP –Ω–∞–≤—Å–µ–≥–¥–∞</div>
        <div style="margin-top:10px"><button class="btn primary" onclick="buyVIP('lifetime',7990)">–ö—É–ø–∏—Ç—å 7990 ‚ÇΩ</button></div>
      </div>
    </div>
  </section>

  <!-- SHOP PAGE -->
  <section id="page-shop" class="panel" style="margin-top:16px;display:none">
    <h2 style="margin-top:0">–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="hint">–ü–æ–∫—É–ø–∞–π –º–æ–Ω–µ—Ç—ã, —Ä–∞–º–∫–∏ –∏ —Å–≤–µ—á–µ–Ω–∏—è</div>

    <div style="margin-top:12px" class="card">
      <h3>–ü–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç</h3>
      <div id="coinPacks" class="grid cols-4" style="margin-top:12px"></div>
    </div>

    <div style="margin-top:12px" class="card">
      <h3>–†–∞–º–∫–∏ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ; 2 ‚Äî VIP-only)</h3>
      <div id="framesGrid" class="grid cols-4" style="margin-top:12px"></div>
    </div>

    <div style="margin-top:12px" class="card">
      <h3>–°–≤–µ—á–µ–Ω–∏—è (—ç—Ñ—Ñ–µ–∫—Ç—ã)</h3>
      <div id="glowsGrid" class="grid cols-4" style="margin-top:12px"></div>
      <div class="hint" style="margin-top:8px">–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —Å–≤–µ—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≤–º–µ—Å—Ç–æ —Ä–∞–º–∫–∏. –°–≤–µ—á–µ–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.</div>
    </div>
  </section>

  <!-- PROFILE PAGE -->
  <section id="page-profile" class="panel" style="margin-top:16px;display:none">
    <h2 style="margin-top:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div class="row" style="align-items:flex-start">
      <div style="width:320px" class="card">
        <div class="profile">
          <div class="avatar-wrap" id="avatarWrap">
            <div class="avatar-inner"><img id="avatarImg" src="https://i.pravatar.cc/300?img=12" alt="avatar"></div>
            <!-- frame overlay will be appended here -->
          </div>
          <div style="flex:1">
            <div id="uiNick" style="font-weight:800">Player</div>
            <div id="vipIndicator" style="margin-top:8px"></div>
            <div style="margin-top:12px">
              <div class="hint">–£—Ä–æ–≤–µ–Ω—å: <span id="uiLevel">1</span> (–º–∞–∫—Å 100)</div>
              <div style="height:10px;background:rgba(255,255,255,0.03);border-radius:8px;margin-top:8px;overflow:hidden">
                <div id="uiXPbar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--neon1),var(--neon2));"></div>
              </div>
              <div class="hint" style="margin-top:6px" id="xpText">0 / 1000 XP</div>
            </div>

            <div style="margin-top:10px;display:flex;gap:8px">
              <button class="btn ghost" onclick="openProfileEditor()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              <button class="btn primary" onclick="simulateXP()">+XP demo</button>
            </div>
            <div style="margin-top:10px" class="hint">–ú–æ–Ω–µ—Ç—ã: <span id="uiCoins">0</span></div>
          </div>
        </div>
      </div>

      <div style="flex:1" class="card">
        <h3>–ú–æ–∏ —É–∫—Ä–∞—à–µ–Ω–∏—è</h3>
        <div class="hint">–í—ã–±—Ä–∞–Ω–Ω–æ–µ —É–∫—Ä–∞—à–µ–Ω–∏–µ (–ª–∏–±–æ —Ä–∞–º–∫–∞, –ª–∏–±–æ —Å–≤–µ—á–µ–Ω–∏–µ)</div>
        <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap" id="ownedList"></div>

        <h4 style="margin-top:14px">–í—ã–±–æ—Ä —É–∫—Ä–∞—à–µ–Ω–∏—è</h4>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <button class="btn ghost" onclick="unequipAll()">–£–±—Ä–∞—Ç—å –≤—Å—ë</button>
          <button class="btn ghost" onclick="equipType('frame')">–í—ã–±—Ä–∞—Ç—å —Ä–∞–º–∫—É</button>
          <button class="btn ghost" onclick="equipType('glow')">–í—ã–±—Ä–∞—Ç—å —Å–≤–µ—á–µ–Ω–∏–µ</button>
        </div>

        <h4 style="margin-top:14px">–°–Ω–∏–º–∏/–ø—Ä–∏–º–µ–Ω–∏</h4>
        <div class="hint" style="margin-top:8px">–ö–ª–∏–∫–Ω–∏ –ø–æ –∫—É–ø–ª–µ–Ω–Ω–æ–π —Ä–∞–º–∫–µ –∏–ª–∏ —Å–≤–µ—á–µ–Ω–∏—é –≤ –º–∞–≥–∞–∑–∏–Ω–µ, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ—ë.</div>
      </div>
    </div>
  </section>

  <!-- CHAT PAGE -->
  <section id="page-chat" class="panel" style="margin-top:16px;display:none">
    <h2 style="margin-top:0">–ß–∞—Ç</h2>
    <div class="row" style="gap:12px;align-items:flex-start">
      <div style="flex:1" class="card">
        <div class="chat">
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input id="chatInput" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button class="btn primary" onclick="sendChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div style="width:280px" class="card">
        <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
        <div id="chatUsers" class="hint">–õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ-—á–∞—Ç (messages saved in browser)</div>
        <h4 style="margin-top:12px">–ü–æ–¥—Å–∫–∞–∑–∫–∏</h4>
        <div class="muted hint">–ß–∞—Ç ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage. –°–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.</div>
      </div>
    </div>
  </section>

  <div style="height:28px"></div>
  <div id="notif" style="position:fixed;right:24px;bottom:24px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;font-weight:800;opacity:0;transform:translateY(16px);transition:all .28s"></div>
</div>

<!-- Profile Editor dialog -->
<dialog id="profileEditor" style="border:none;border-radius:10px;padding:0">
  <div style="width:min(720px,96vw);background:var(--panel);padding:16px;border-radius:10px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <button onclick="document.getElementById('profileEditor').close()" style="background:none;border:0;color:var(--muted);cursor:pointer">‚úï</button>
    </div>
    <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
      <div style="flex:0 0 120px"><img id="editorAvatarPreview" src="" style="width:120px;height:120px;border-radius:8px;object-fit:cover"></div>
      <div style="flex:1">
        <label class="hint">–ù–∏–∫</label>
        <input id="editorNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)"/>
        <label class="hint" style="margin-top:8px;display:block">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
        <input id="editorAvatar" type="file"/>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn primary" onclick="saveProfileEdits()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" onclick="document.getElementById('profileEditor').close()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</dialog>

<!-- Confetti canvas -->
<canvas id="confettiCanvas" style="position:fixed;left:0;top:0;pointer-events:none;z-index:9999"></canvas>

<script>
/* =========================
   State & persistence
   ========================= */
const STORAGE_KEY = 'gameloaders_full_v1';
let state = {
  nick: 'Player',
  avatar: 'https://i.pravatar.cc/300?img=12',
  coins: 500,
  xp: 0,
  vip: false,
  vipLevel: null,
  ownedFrames: [],   // frame ids
  ownedGlows: [],    // glow ids
  applied: { type:null, id:null }, // {type:'frame'|'glow', id:'f1'|'g1'}
  chat: [], // {nick,msg,t}
};
const XP_PER_LEVEL = 1000;
const MAX_LEVEL = 100;
function loadState(){
  try{ const s = JSON.parse(localStorage.getItem(STORAGE_KEY)); if(s) state = Object.assign(state, s); }
  catch(e){ console.warn('load error', e) }
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); updateAll(); }

/* =========================
   Utils
   ========================= */
function $(id){ return document.getElementById(id); }
function notify(msg, t=2200){
  const n = $('notif'); n.textContent = msg; n.style.opacity = 1; n.style.transform='translateY(0)';
  setTimeout(()=>{ n.style.opacity=0; n.style.transform='translateY(16px)'; }, t);
}
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

/* =========================
   XP / Level logic
   ========================= */
function xpToLevel(xp){ return clamp(Math.floor(xp / XP_PER_LEVEL) + 1, 1, MAX_LEVEL); }
function levelToXp(level){ return (level-1)*XP_PER_LEVEL; }
function addXP(amount){
  if(state.xp >= MAX_LEVEL*XP_PER_LEVEL) return;
  const prevLevel = xpToLevel(state.xp);
  state.xp = clamp(state.xp + amount, 0, MAX_LEVEL*XP_PER_LEVEL);
  const newLevel = xpToLevel(state.xp);
  if(newLevel > prevLevel){
    // level up animation & confetti
    notify(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! ${newLevel}`, 3000);
    launchConfetti();
  }
  saveState();
}

/* =========================
   Frames & Glows data
   (using placeholder/direct images; replace with your direct links if available)
   ========================= */
const FRAMES = [
  {id:'f1', title:'Ice Frame', price:150, vipOnly:false, url:'https://i.imgur.com/9r0dF3Z.png'},
  {id:'f2', title:'Border II', price:200, vipOnly:false, url:'https://i.imgur.com/0KXJw7y.png'},
  {id:'f3', title:'Neon Frame', price:300, vipOnly:false, url:'https://i.imgur.com/V7HiEOp.png'},
  {id:'f4', title:'Decor VIP', price:0, vipOnly:true, url:'https://i.imgur.com/6zq4O8y.png'},
  {id:'f5', title:'Royal VIP', price:0, vipOnly:true, url:'https://i.imgur.com/3Xq1GkN.png'}
];
// NOTE: For f4/f5 price is 0 because vipOnly=true (can't buy with coins unless VIP allowed). You can set price if you wish.

const GLOWS = [
  {id:'g1', title:'üî• –û–≥–æ–Ω—å', price:500, cls:'glow-fire'},
  {id:'g2', title:'üíß –í–æ–¥–∞', price:500, cls:'glow-water'},
  {id:'g3', title:'üåà –†–∞–¥—É–≥–∞', price:1000, cls:'glow-rainbow'},
  {id:'g4', title:'‚≠ê Soft Glow', price:200, cls:'glow-basic'}
];

/* =========================
   Coin packs & shop items
   ========================= */
const COIN_PACKS = [
  {id:'c1', coins:100, price:99},
  {id:'c2', coins:250, price:199},
  {id:'c3', coins:500, price:349},
  {id:'c4', coins:1000, price:599},
  {id:'c5', coins:2500, price:1299},
  {id:'c6', coins:5000, price:2399}
];
const SHOP_ITEMS = Array.from({length:24}).map((_,i)=>({
  id:'it'+(i+1),
  title:`–ü—Ä–∏–∫–æ–ª—é—Ö–∞ #${i+1}`,
  price: 25 + i*7,
  vipOnly: (i%7===0)
}));

/* =========================
   Loaders (games)
   ========================= */
const GAMES = ['Apex Legends','Fortnite','Minecraft','CS:GO','Rust','GTA V','Valorant','Overwatch','LoL','Dota2'];
const LOADERS = [];
(function(){
  GAMES.forEach((g,i)=>{
    LOADERS.push({id:`free-${i}`, name:`${g} ‚Äî Free Loader`, game:g, type:'free'});
    LOADERS.push({id:`pro-${i}`, name:`${g} ‚Äî Pro Loader`, game:g, type:'pro', price:199 + i*30});
    LOADERS.push({id:`vip-${i}`, name:`${g} ‚Äî VIP Loader`, game:g, type:'vip'});
  });
})();

/* =========================
   Render functions
   ========================= */
function updateAll(){
  // header coins
  $('ui-coins').textContent = state.coins + ' üí∞';
  // profile UI
  $('uiNick').textContent = state.nick;
  $('avatarImg').src = state.avatar;
  $('editorAvatarPreview').src = state.avatar;
  $('uiLevel').textContent = xpToLevel(state.xp);
  const curXP = state.xp % XP_PER_LEVEL;
  $('uiXPbar').style.width = (curXP / XP_PER_LEVEL * 100) + '%';
  $('xpText').textContent = `${curXP} / ${XP_PER_LEVEL} XP`;
  // vip indicator
  const vipIndicator = $('vipIndicator'); vipIndicator.innerHTML = '';
  if(state.vip){
    const el = document.createElement('div'); el.className='vip-badge'; el.textContent = state.vipLevel === 'lifetime' ? 'VIP ¬∑ Forever' : 'VIP';
    vipIndicator.appendChild(el);
  } else {
    vipIndicator.innerHTML = '<div class="hint">–ù–µ—Ç VIP</div>';
  }
  // owned list in profile
  const ownedList = $('ownedList'); ownedList.innerHTML = '';
  state.ownedFrames.forEach(fid=>{
    const f = FRAMES.find(x=>x.id===fid);
    if(!f) return;
    const el = document.createElement('div'); el.className='card'; el.style.padding='8px'; el.style.minWidth='140px';
    el.innerHTML = `<div style="font-weight:800">${f.title}</div><div class="hint">${f.vipOnly? 'VIP only' : f.price+' –º–æ–Ω–µ—Ç'}</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyFrame('${f.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;
    ownedList.appendChild(el);
  });
  state.ownedGlows.forEach(gid=>{
    const g = GLOWS.find(x=>x.id===gid);
    if(!g) return;
    const el = document.createElement('div'); el.className='card'; el.style.padding='8px'; el.style.minWidth='140px';
    el.innerHTML = `<div style="font-weight:800">${g.title}</div><div class="hint">${g.price} –º–æ–Ω–µ—Ç</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyGlow('${g.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;
    ownedList.appendChild(el);
  });
  // applied visuals
  renderAppliedDecoration();
  // chat render
  renderChat();
  // loaders & shop & frames & glows updates
  renderLoaders();
  renderFrames();
  renderGlows();
  renderCoinPacks();
  renderShopItems();
  // save state
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ---------- loaders ---------- */
function renderLoaders(){
  const grid = $('loadersGrid'); grid.innerHTML = '';
  const ft = document.getElementById('filterType').value;
  const fg = document.getElementById('filterGame').value;
  LOADERS.filter(l=>{
    if(ft!=='all' && l.type!==ft) return false;
    if(fg && fg!=='all' && l.game!==fg) return false;
    return true;
  }).forEach(l=>{
    const c = document.createElement('div'); c.className='card';
    c.innerHTML = `<div class="game hint">${l.game}</div><div style="font-weight:800;margin-top:6px">${l.name}</div><div class="hint" style="margin-top:6px">${l.type==='free'?'–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π': l.type==='pro'?('–ü–ª–∞—Ç–Ω—ã–π ' + l.price+'‚ÇΩ'):'–¢–æ–ª—å–∫–æ VIP'}</div>`;
    const controls = document.createElement('div'); controls.style.marginTop='10px';
    if(l.type==='free'){
      const b = document.createElement('button'); b.className='btn primary'; b.textContent='–°–∫–∞—á–∞—Ç—å'; b.onclick = ()=>{ state.downloads++; addXP(50); notify('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ (–¥–µ–º–æ) +50 XP'); saveState(); };
      controls.appendChild(b);
    } else if(l.type==='pro'){
      const b = document.createElement('button'); b.className='btn primary'; b.textContent=`–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`; b.onclick = ()=>{ state.ownedItems.push('PRO:'+l.id); addXP(300); notify('–ö—É–ø–ª–µ–Ω Pro (–¥–µ–º–æ) +300 XP'); saveState(); };
      controls.appendChild(b);
    } else {
      const b = document.createElement('button'); b.className='btn primary'; b.textContent='–¢–æ–ª—å–∫–æ VIP'; b.onclick = ()=>{ if(state.vip){ state.downloads++; addXP(100); notify('VIP-–∑–∞–≥—Ä—É–∑–∫–∞ +100 XP'); saveState(); } else { notify('–¢—Ä–µ–±—É–µ—Ç—Å—è VIP'); goTab('vip'); } };
      controls.appendChild(b);
    }
    c.appendChild(controls);
    grid.appendChild(c);
  });
}

/* ---------- frames ---------- */
function renderFrames(){
  const grid = $('framesGrid'); grid.innerHTML = '';
  FRAMES.forEach(f=>{
    const el = document.createElement('div'); el.className='card'; el.style.textAlign='center';
    el.innerHTML = `<div style="height:96px;display:flex;align-items:center;justify-content:center"><img src="${f.url}" alt="" style="max-width:100%;max-height:100%;border-radius:8px" onerror="this.style.opacity=0.5"></div><div style="font-weight:800;margin-top:8px">${f.title}</div><div class="hint">${f.vipOnly? 'VIP only' : f.price+' –º–æ–Ω–µ—Ç'}</div>`;
    el.addEventListener('click', ()=>{ // buy or apply
      if(f.vipOnly && !state.vip){ notify('–†–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP'); goTab('vip'); return; }
      const owned = state.ownedFrames.includes(f.id);
      if(!owned){
        if(f.vipOnly){ state.ownedFrames.push(f.id); notify('–†–∞–º–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (VIP)'); saveState(); return; }
        if(state.coins < f.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        state.coins -= f.price;
        state.ownedFrames.push(f.id);
        addXP(Math.round(f.price/2));
        notify('–ö—É–ø–ª–µ–Ω–∞ —Ä–∞–º–∫–∞: '+f.title);
        saveState();
      } else {
        // apply
        state.applied = {type:'frame', id:f.id};
        notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: '+f.title);
        renderAppliedDecoration();
        saveState();
      }
    });
    // mark owned
    if(state.ownedFrames.includes(f.id)){
      const mark = document.createElement('div'); mark.className='hint'; mark.style.marginTop='6px'; mark.textContent='–ö—É–ø–ª–µ–Ω–æ';
      el.appendChild(mark);
    }
    grid.appendChild(el);
  });
}

/* ---------- glows ---------- */
function renderGlows(){
  const grid = $('glowsGrid'); grid.innerHTML = '';
  GLOWS.forEach(g=>{
    const el = document.createElement('div'); el.className='card'; el.style.textAlign='center';
    el.innerHTML = `<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${g.title}</div><div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>`;
    el.addEventListener('click', ()=>{
      const owned = state.ownedGlows.includes(g.id);
      if(!owned){
        if(state.coins < g.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        state.coins -= g.price;
        state.ownedGlows.push(g.id);
        addXP(Math.round(g.price/3));
        notify('–ö—É–ø–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ: '+g.title);
        saveState();
      } else {
        state.applied = {type:'glow', id:g.id};
        notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: '+g.title);
        renderAppliedDecoration();
        saveState();
      }
    });
    if(state.ownedGlows.includes(g.id)){
      const mark = document.createElement('div'); mark.className='hint'; mark.style.marginTop='6px'; mark.textContent='–ö—É–ø–ª–µ–Ω–æ';
      el.appendChild(mark);
    }
    grid.appendChild(el);
  });
}

/* ---------- coin packs ---------- */
function renderCoinPacks(){
  const grid = $('coinPacks'); grid.innerHTML = '';
  COIN_PACKS.forEach(p=>{
    const el = document.createElement('div'); el.className='card'; el.style.textAlign='center';
    el.innerHTML = `<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div class="hint">${p.price} ‚ÇΩ</div>`;
    const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–ö—É–ø–∏—Ç—å';
    btn.onclick = ()=>{ state.coins += p.coins; addXP(Math.round(p.coins/5)); notify('–ö—É–ø–ª–µ–Ω–æ '+p.coins+' –º–æ–Ω–µ—Ç'); saveState(); };
    el.appendChild(btn);
    grid.appendChild(el);
  });
}

/* ---------- shop items ---------- */
function renderShopItems(){
  const grid = $('coinPacks'); // reuse coinPacks area? but we already use coinPacks; instead show shop items in items area (we have itemsGrid above in earlier builds). For clarity, create below the coin packs (already in UI we have frames and glows). We will not render additional items here.
}

/* =========================
   Apply decorations
   ========================= */
function clearOverlay(){
  const existing = document.querySelector('.frame-overlay');
  if(existing) existing.remove();
  // remove glow classes
  const wrap = $('avatarWrap');
  wrap.classList.remove(...GLOWS.map(g=>g.cls));
  // remove any applied transform
}
function renderAppliedDecoration(){
  clearOverlay();
  const wrap = $('avatarWrap');
  if(state.applied.type === 'frame'){
    const f = FRAMES.find(x=>x.id===state.applied.id);
    if(f){
      // add overlay image element
      const img = document.createElement('img');
      img.className='frame-overlay';
      img.src = f.url;
      img.onerror = ()=>{ img.style.opacity = 0.5 };
      $('avatarWrap').appendChild(img);
      // ensure no glow classes
      wrap.classList.remove(...GLOWS.map(g=>g.cls));
    }
  } else if(state.applied.type === 'glow'){
    const g = GLOWS.find(x=>x.id===state.applied.id);
    if(g){
      wrap.classList.add(g.cls);
      // ensure no frame overlay
    }
  } else {
    // nothing
  }
}

/* =========================
   Apply helpers
   ========================= */
function applyFrame(fid){
  const f = FRAMES.find(x=>x.id===fid);
  if(!f) return;
  if(!state.ownedFrames.includes(fid)){
    notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–π —Ä–∞–º–∫–∏');
    return;
  }
  state.applied = {type:'frame', id:fid};
  renderAppliedDecoration();
  saveState();
  notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');
}
function applyGlow(gid){
  const g = GLOWS.find(x=>x.id===gid);
  if(!g) return;
  if(!state.ownedGlows.includes(gid)){
    notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è');
    return;
  }
  state.applied = {type:'glow', id:gid};
  renderAppliedDecoration();
  saveState();
  notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ');
}
function unequipAll(){
  state.applied = {type:null, id:null};
  renderAppliedDecoration(); saveState(); notify('–£–∫—Ä–∞—à–µ–Ω–∏—è —Å–Ω—è—Ç—ã');
}
function equipType(type){
  // open profile tab for selection ‚Äî here we just notify and trust user to click items
  if(type==='frame') { notify('–ù–∞–∂–º–∏ –Ω–∞ –∫—É–ø–ª–µ–Ω–Ω—É—é —Ä–∞–º–∫—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ—ë'); goTab('shop'); }
  if(type==='glow') { notify('–ù–∞–∂–º–∏ –Ω–∞ –∫—É–ø–ª–µ–Ω–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ–≥–æ'); goTab('shop'); }
}

/* =========================
   VIP purchase function
   ========================= */
function buyVIP(kind, price){
  // In demo we treat price as informational; we don't charge real money here.
  state.vip = true;
  state.vipLevel = kind;
  // grant +5 levels => +5000 XP
  addXP(5 * XP_PER_LEVEL);
  // give some coins
  state.coins += 500;
  notify('–í—ã —Å—Ç–∞–ª–∏ VIP! +5 —É—Ä–æ–≤–Ω–µ–π –∏ +500 –º–æ–Ω–µ—Ç');
  saveState();
}

/* =========================
   Profile editor
   ========================= */
function openProfileEditor(){
  $('editorAvatarPreview').src = state.avatar;
  $('editorNick').value = state.nick;
  document.getElementById('profileEditor').showModal();
}
$('editorAvatar') && $('editorAvatar').addEventListener('change', function(e){
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ()=>{ $('editorAvatarPreview').src = r.result; }; r.readAsDataURL(f);
});
function saveProfileEdits(){
  const nv = $('editorNick').value.trim();
  if(nv) state.nick = nv;
  // if preview changed use it
  const preview = $('editorAvatarPreview').src;
  if(preview) state.avatar = preview;
  saveState();
  document.getElementById('profileEditor').close();
  notify('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
}

/* =========================
   Chat (local)
   ========================= */
function renderChat(){
  const out = $('chatMessages'); out.innerHTML = '';
  state.chat.slice(-200).forEach(m=>{
    const div = document.createElement('div'); div.style.marginBottom='8px';
    const time = new Date(m.t).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    div.innerHTML = `<div style="font-weight:700">${escapeHtml(m.nick)} <span style="font-weight:400;color:var(--muted);font-size:12px"> ${time}</span></div><div>${escapeHtml(m.msg)}</div>`;
    out.appendChild(div);
  });
  out.scrollTop = out.scrollHeight;
}
function sendChat(){
  const inp = $('chatInput'); const txt = inp.value.trim(); if(!txt) return;
  const msg = { nick: state.nick, msg: txt, t: Date.now() };
  state.chat.push(msg);
  saveState(); inp.value=''; renderChat(); notify('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
}

/* =========================
   Helpers: populate filters & initial render
   ========================= */
function populateFilters(){
  const sel = $('filterGame'); sel.innerHTML='';
  const opt = document.createElement('option'); opt.value='all'; opt.textContent='–í—Å–µ –∏–≥—Ä—ã'; sel.appendChild(opt);
  GAMES.forEach(g=>{ const o = document.createElement('option'); o.value=g; o.textContent=g; sel.appendChild(o); });
  $('filterType').value='all';
  $('filterGame').value='all';
  $('filterType').addEventListener('change', renderLoaders);
  $('filterGame').addEventListener('change', renderLoaders);
}

/* =========================
   UI helpers to render frames, glows, packs on initial load
   ========================= */
function renderFramesGrid(){ renderFrames(); }
function renderGlowsGrid(){ renderGlows(); }
function renderCoinPacksGrid(){ renderCoinPacks(); }

/* =========================
   Misc utilities
   ========================= */
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* =========================
   Confetti (small)
   ========================= */
const confettiCanvas = document.getElementById('confettiCanvas');
const confettiCtx = confettiCanvas.getContext?confettiCanvas.getContext('2d'):null;
let confettiParticles=[];
function resizeConfetti(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeConfetti); resizeConfetti();
function launchConfetti(){
  if(!confettiCtx) return;
  for(let i=0;i<80;i++){
    confettiParticles.push({
      x: Math.random()*confettiCanvas.width,
      y: Math.random()*confettiCanvas.height - confettiCanvas.height,
      vx: (Math.random()-0.5)*6,
      vy: 2+Math.random()*6,
      size: 4+Math.random()*8,
      color: ['#ff4d4d','#ffd65b','#7c4dff','#00d4ff','#4dff88'][Math.floor(Math.random()*5)],
      rot: Math.random()*360
    });
  }
  if(!confettiLoopRunning){ confettiLoopRunning=true; requestAnimationFrame(confettiLoop); }
}
let confettiLoopRunning=false;
function confettiLoop(){
  confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiParticles.forEach((p,i)=>{
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; p.rot += p.vx;
    confettiCtx.save();
    confettiCtx.translate(p.x,p.y); confettiCtx.rotate(p.rot*Math.PI/180);
    confettiCtx.fillStyle = p.color; confettiCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size);
    confettiCtx.restore();
    if(p.y > confettiCanvas.height+50){ confettiParticles.splice(i,1); }
  });
  if(confettiParticles.length>0){ requestAnimationFrame(confettiLoop); } else { confettiLoopRunning=false; confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
}

/* =========================
   Interaction helpers
   ========================= */
function goTabByButton(btnId, pageId){
  document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section[id^="page-"]').forEach(s=>s.style.display='none');
  document.getElementById(btnId).classList.add('active');
  document.getElementById(pageId).style.display='block';
}
function goTab(page){
  // map: buy->page-buy, vip->page-vip, shop->page-shop, profile->page-profile, chat->page-chat
  ['btn-buy','btn-vip','btn-shop','btn-profile','btn-chat'].forEach(b=>document.getElementById(b).classList.remove('active'));
  document.querySelectorAll('section[id^="page-"]').forEach(s=>s.style.display='none');
  if(page === 'buy'){ document.getElementById('btn-buy').classList.add('active'); document.getElementById('page-buy').style.display='block'; }
  if(page === 'vip'){ document.getElementById('btn-vip').classList.add('active'); document.getElementById('page-vip').style.display='block'; }
  if(page === 'shop'){ document.getElementById('btn-shop').classList.add('active'); document.getElementById('page-shop').style.display='block'; }
  if(page === 'profile'){ document.getElementById('btn-profile').classList.add('active'); document.getElementById('page-profile').style.display='block'; }
  if(page === 'chat'){ document.getElementById('btn-chat').classList.add('active'); document.getElementById('page-chat').style.display='block'; }
}

/* =========================
   Startup: populate & bind events
   ========================= */
loadState();
populateFilters();
renderAll();
goTab('buy');

// hook tab buttons
document.getElementById('btn-buy').addEventListener('click', ()=>goTab('buy'));
document.getElementById('btn-vip').addEventListener('click', ()=>goTab('vip'));
document.getElementById('btn-shop').addEventListener('click', ()=>goTab('shop'));
document.getElementById('btn-profile').addEventListener('click', ()=>goTab('profile'));
document.getElementById('btn-chat').addEventListener('click', ()=>goTab('chat'));

// chat input enter
$('chatInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendChat(); });

/* expose some actions for debugging in console */
window._GL = { state, saveState, addXP, applyFrame, applyGlow, unequipAll, buyVIP, launchConfetti };

</script>
</body>
</html>
