<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GameLoaders ‚Äî Mega Hub (NY Edition)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
/* =========================================================
   Core theme
   ========================================================= */
:root{
  --bg1:#051025; --bg2:#0b1222; --card:#0f1724;
  --muted:#9ab0d6; --text:#e8f0ff;
  --neon1:#7c4dff; --neon2:#00d4ff;
  --glass:rgba(255,255,255,0.03);
  --vip-grad: conic-gradient(from 0deg,#ff0044,#ff9900,#ffee00,#00ff77,#00ccff,#7c4dff);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
body{
  background:
    radial-gradient(600px 300px at 10% 10%, rgba(124,77,255,0.04), transparent),
    radial-gradient(600px 300px at 90% 80%, rgba(0,212,255,0.03), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  padding-bottom:140px;
}

/* Container & header */
.container{width:min(1280px,96%);margin:0 auto;padding:18px 0}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0;position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.00));backdrop-filter:blur(8px);z-index:300;border-bottom:1px solid rgba(255,255,255,0.06)}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--neon1)}
.brand .logo{width:18px;height:18px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 8px 28px rgba(124,77,255,0.2)}
.header .left,.header .center,.header .right{display:flex;align-items:center;gap:10px}
.tabbtn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);font-weight:800;cursor:pointer}
.tabbtn.active{color:var(--text);background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 12px 40px rgba(124,77,255,0.18)}

/* Sections */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.06);box-shadow:0 12px 40px rgba(2,6,23,0.5)}
.spaced{margin-top:16px}
.grid{display:grid;gap:12px}
.cols-2{grid-template-columns:repeat(2,1fr)}
.cols-3{grid-template-columns:repeat(3,1fr)}
.cols-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:960px){.cols-4{grid-template-columns:repeat(2,1fr)}.cols-3{grid-template-columns:repeat(2,1fr)}}

/* Cards & buttons */
.card{border-radius:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.06);transition:transform .18s,box-shadow .18s;overflow:hidden}
.card:hover{transform:translateY(-6px);box-shadow:0 22px 60px rgba(0,0,0,0.55)}
.hint{color:var(--muted);font-size:13px}
.btn{padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:900}
.btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;box-shadow:0 10px 30px rgba(124,77,255,0.22)}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.09)}
.btn.warn{background:linear-gradient(90deg,#ff9966,#ff4d4d);color:#041022}

/* Profile & avatar */
.profile-top{display:flex;gap:18px;align-items:center;position:relative}
.profile-snow-canvas{position:absolute;inset:0;pointer-events:none;z-index:0;border-radius:12px}
.avatar-zone{position:relative;z-index:1}
.avatar-wrap{position:relative;width:136px;height:136px;border-radius:50%;padding:6px;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 18px 48px rgba(124,77,255,0.18)}
.avatar-inner{width:100%;height:100%;border-radius:50%;overflow:hidden;border:4px solid rgba(0,0,0,0.25)}
.avatar-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%}

/* Frame overlay ‚Äî 100% —è—Ä–∫–æ—Å—Ç–∏, —Ä–æ–≤–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ */
.frame-overlay{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:148px;height:148px;border-radius:50%;pointer-events:none;filter:none !important;mix-blend-mode:normal !important;opacity:1 !important;
}

/* Glow overlay */
.glow-class{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:170px;height:170px;border-radius:50%;pointer-events:none;z-index:0}

/* Glow types */
.glow-fire{box-shadow:0 0 38px 16px rgba(255,110,25,0.9)!important;animation:glowFlicker 1.2s infinite}
.glow-water{box-shadow:0 0 36px 14px rgba(0,160,255,0.9)!important;animation:glowWave 3s infinite}
.glow-rainbow{animation:glowRainbow 5s linear infinite}
.glow-basic{box-shadow:0 0 24px 10px rgba(255,255,255,0.85)!important}
@keyframes glowFlicker{0%,20%,22%,64%,65%,100%{opacity:1}21%,23%,63%,66%{opacity:.35}}
@keyframes glowWave{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.06)}100%{transform:translate(-50%,-50%) scale(1)}}
@keyframes glowRainbow{
  0%{box-shadow:0 0 40px 12px rgba(255,0,0,0.9)}
  25%{box-shadow:0 0 40px 12px rgba(255,160,0,0.9)}
  50%{box-shadow:0 0 40px 12px rgba(0,200,255,0.9)}
  75%{box-shadow:0 0 40px 12px rgba(120,0,255,0.9)}
  100%{box-shadow:0 0 40px 12px rgba(255,0,0,0.9)}
}

/* VIP badge */
.vip-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:900;background:var(--vip-grad);background-size:300% 300%;animation:vipShift 6s linear infinite;color:#051022}
@keyframes vipShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* Chat */
.chat-wrap{display:flex;flex-direction:column;height:420px}
.chat-messages{flex:1;overflow:auto;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00))}
.chat-input{display:flex;gap:8px;margin-top:8px}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.09);background:transparent;color:var(--text)}
.chat-msg{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.04);}

/* Notifications */
#notif{position:fixed;right:20px;bottom:20px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;font-weight:900;transform:translateY(12px);opacity:0;transition:all .3s;z-index:9999}

/* Snow (global) */
#snowCanvas{position:fixed;inset:0;pointer-events:none;z-index:0}

/* Wheel styles */
#wheelWrapper{position:relative;display:flex;align-items:center;gap:18px;flex-wrap:wrap}
#wheel{border-radius:50%;box-shadow:0 0 25px #0ff, 0 0 50px #ff000044 inset;background:rgba(0,0,0,0.05)}
.garland{position:absolute;width:540px;height:540px;left:-20px;top:-20px;pointer-events:none}
.bulb{width:18px;height:18px;border-radius:50%;position:absolute;animation:blink 1.5s infinite alternate;box-shadow:0 0 12px currentColor}
@keyframes blink{from{opacity:.35}to{opacity:1}}

@media (max-width:980px){
  .header{flex-direction:column;align-items:flex-start;gap:8px}
}

/* pointer */
.pointer{
  position:absolute;left:50%;top:-6px;transform:translateX(-50%);
  width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:24px solid #fff;filter:drop-shadow(0 4px 10px rgba(0,0,0,.5));
}
</style>
</head>
<body>
<canvas id="snowCanvas"></canvas>

<div class="container" style="position:relative;z-index:1">
  <!-- HEADER -->
  <div class="header" role="banner">
    <div class="left brand"><div class="logo"></div> <div>GameLoaders Mega Hub</div></div>
    <div class="center">
      <button class="tabbtn active" id="btn-buy">–ö—É–ø–∏—Ç—å</button>
      <button class="tabbtn" id="btn-vip">VIP</button>
      <button class="tabbtn" id="btn-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tabbtn" id="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tabbtn" id="btn-chat">–ß–∞—Ç</button>
      <button class="tabbtn" id="btn-wheel">–ö–æ–ª–µ—Å–æ</button>
    </div>
    <div class="right">
      <div id="header-stats" style="display:flex;gap:12px;align-items:center">
        <div class="card" style="padding:6px 10px" id="statCoins">0 üí∞</div>
        <div class="card" style="padding:6px 10px" id="statLevel">Lvl 1</div>
        <div class="card" style="padding:6px 10px" id="statTickets">üéü 0</div>
      </div>
      <button class="tabbtn" id="authBtn">–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <!-- BUY -->
  <section id="page-buy" class="panel spaced">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 style="margin:0">–ö—É–ø–∏—Ç—å ‚Äî –õ–æ–∞–¥–µ—Ä—ã</h2>
        <div class="hint">Free / Pro / VIP-only ‚Äî –¥–µ–º–æ –ø–æ–∫—É–ø–∫–∏/–∑–∞–≥—Ä—É–∑–∫–∏</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="filterGame" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.09);color:var(--text)"></select>
        <select id="filterType" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.09);color:var(--text)">
          <option value="all">–í—Å–µ —Ç–∏–ø—ã</option><option value="free">Free</option><option value="pro">Pro</option><option value="vip">VIP-only</option>
        </select>
      </div>
    </div>
    <div id="loadersGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
  </section>

  <!-- VIP -->
  <section id="page-vip" class="panel spaced" style="display:none">
    <h2 style="margin:0">VIP ‚Äî –æ—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</h2>
    <div class="hint">VIP —Å—Ä–∞–∑—É –¥–∞—ë—Ç +5 —É—Ä–æ–≤–Ω–µ–π, –º–æ–Ω–µ—Ç—ã –∏ –±–∏–ª–µ—Ç—ã –Ω–∞ –∫–æ–ª–µ—Å–æ.</div>
    <div class="grid cols-3 spaced" style="margin-top:12px">
      <div class="card">
        <h3>1 –º–µ—Å—è—Ü</h3>
        <ul class="hint">
          <li>+5 —É—Ä–æ–≤–Ω–µ–π</li>
          <li>+300 –º–æ–Ω–µ—Ç</li>
          <li>üéü –ë–∏–ª–µ—Ç—ã: 3</li>
          <li>–î–æ—Å—Ç—É–ø –∫ VIP —Ä–∞–º–∫–∞–º (2 —à—Ç.)</li>
          <li>–°–∫–∏–¥–∫–∞ 10% –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
        </ul>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('month',299,3,300,5)">–ö—É–ø–∏—Ç—å 299 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>12 –º–µ—Å—è—Ü–µ–≤</h3>
        <ul class="hint">
          <li>+10 —É—Ä–æ–≤–Ω–µ–π</li>
          <li>+1500 –º–æ–Ω–µ—Ç</li>
          <li>üéü –ë–∏–ª–µ—Ç—ã: 12</li>
          <li>VIP —Ä–∞–º–∫–∏ + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –∫–æ–ª–µ—Å–µ</li>
          <li>–°–∫–∏–¥–∫–∞ 20% –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
        </ul>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('year',2870,12,1500,10)">–ö—É–ø–∏—Ç—å 2870 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ</h3>
        <ul class="hint">
          <li>+20 —É—Ä–æ–≤–Ω–µ–π</li>
          <li>+5000 –º–æ–Ω–µ—Ç</li>
          <li>üéü –ë–∏–ª–µ—Ç—ã: 30</li>
          <li>–í—Å–µ VIP —É–∫—Ä–∞—à–µ–Ω–∏—è</li>
          <li>–°–∫–∏–¥–∫–∞ 30% –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
        </ul>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('lifetime',7990,30,5000,20)">–ö—É–ø–∏—Ç—å 7990 ‚ÇΩ</button></div>
      </div>
    </div>
  </section>

  <!-- SHOP -->
  <section id="page-shop" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="hint">–ú–æ–Ω–µ—Ç—ã, —Ä–∞–º–∫–∏, —Å–≤–µ—á–µ–Ω–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã.</div>

    <div class="spaced card">
      <h3>–ü–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç</h3>
      <div id="coinPacks" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–†–∞–º–∫–∏ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ; 2 ‚Äî VIP-only)</h3>
      <div id="framesGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–°–≤–µ—á–µ–Ω–∏—è</h3>
      <div id="glowsGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <div id="effectsGrid" class="grid cols-3 spaced" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="page-profile" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>

    <div class="profile-top spaced" id="profileTop">
      <!-- –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥ –ø—Ä–æ—Ñ–∏–ª—è -->
      <canvas id="profileSnow" class="profile-snow-canvas" style="display:none"></canvas>

      <div class="avatar-zone">
        <div class="avatar-wrap" id="avatarWrap">
          <div class="avatar-inner"><img id="avatarImg" src="https://i.pravatar.cc/400?img=12" alt="avatar"></div>
          <!-- overlays will be injected -->
        </div>
        <div style="margin-top:10px;font-weight:800" id="displayName">Player</div>
        <div id="vipBadge" style="margin-top:8px"></div>
      </div>

      <div style="flex:1" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="hint">–£—Ä–æ–≤–µ–Ω—å</div>
            <div style="font-weight:900;font-size:20px" id="uiLevel">1</div>
          </div>
          <div style="width:60%">
            <div class="hint">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è</div>
            <div style="height:12px;background:rgba(255,255,255,0.08);border-radius:8px;margin-top:6px;overflow:hidden">
              <div id="uiXPbar" style="height:100%;background:linear-gradient(90deg,var(--neon1),var(--neon2));width:0%"></div>
            </div>
            <div style="margin-top:6px" class="hint" id="uiXPtext">0 / 1000 XP</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <div class="hint">–ú–æ–Ω–µ—Ç—ã:</div><div style="font-weight:900" id="uiCoins">0</div>
          <div class="hint">üéü –ë–∏–ª–µ—Ç—ã:</div><div style="font-weight:900" id="uiTickets">0</div>
          <div style="margin-left:auto">
            <button class="btn ghost" onclick="openProfileEditor()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn primary" onclick="awardDemoXP()">+XP demo</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <h4 style="margin:0">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏ / –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h4>
          <div id="ownedList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <h3 style="margin:0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è–º–∏</h3>
      <div class="hint" style="margin-top:8px">–í—ã–±–µ—Ä–∏ ‚Äî —Ä–∞–º–∫—É –∏–ª–∏ —Å–≤–µ—á–µ–Ω–∏–µ. –ù–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</div>
      <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
        <button class="btn ghost" onclick="unequipAll()">–°–Ω—è—Ç—å –≤—Å—ë</button>
        <button class="btn ghost" onclick="openFramesInShop()">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–º–∫–∏</button>
        <button class="btn ghost" onclick="openGlowsInShop()">–û—Ç–∫—Ä—ã—Ç—å —Å–≤–µ—á–µ–Ω–∏—è</button>
        <button class="btn ghost" onclick="toggleProfileSnow()">–í–∫–ª/–í—ã–∫–ª —Å–Ω–µ–≥ –≤ –ø—Ä–æ—Ñ–∏–ª–µ</button>
      </div>
    </div>
  </section>

  <!-- CHAT -->
  <section id="page-chat" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ß–∞—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ)</h2>
    <div class="row" style="margin-top:12px;gap:12px">
      <div style="flex:1" class="card">
        <div class="chat-wrap">
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button class="btn primary" id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div style="width:260px" class="card">
        <h4 style="margin:0">–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
        <div class="hint" style="margin-top:8px">–ß–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn ghost" onclick="clearChat()">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
          <button class="btn ghost" onclick="exportChat()">–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
      </div>
    </div>
  </section>

  <!-- WHEEL -->
  <section id="page-wheel" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ö–æ–ª–µ—Å–æ –≤–µ–∑–µ–Ω–∏—è</h2>
    <div class="hint">–û–¥–Ω–æ –≤—Ä–∞—â–µ–Ω–∏–µ: 499 ‚ÇΩ (–¥–µ–º–æ) –∏–ª–∏ 1 –±–∏–ª–µ—Ç.</div>

    <div id="wheelWrapper" class="spaced">
      <div style="position:relative">
        <canvas id="wheel" width="480" height="480"></canvas>
        <div class="pointer"></div>
        <div class="garland" id="garland"></div>
      </div>

      <div style="min-width:280px" class="card">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
          <div class="card" style="padding:6px 10px">üéü –ë–∏–ª–µ—Ç—ã: <b id="wheelTickets">0</b></div>
          <button class="btn primary" id="spinBtn">–í—Ä–∞—â–∞—Ç—å (499 ‚ÇΩ / 1 –±–∏–ª–µ—Ç)</button>
        </div>
        <div id="wheelResult" class="spaced"></div>
        <div class="spaced">
          <h4 style="margin:0">–ü—Ä–∏–∑—ã:</h4>
          <ul class="hint" style="margin:6px 0 0 18px">
            <li>+100 –º–æ–Ω–µ—Ç</li><li>+250 –º–æ–Ω–µ—Ç</li><li>+500 –º–æ–Ω–µ—Ç</li>
            <li>+700 XP</li><li>+1200 XP</li><li>üéü +1 –±–∏–ª–µ—Ç</li>
            <li>–£–∫—Ä–∞—à–µ–Ω–∏–µ: —Ä–∞–º–∫–∞ (—Å–ª—É—á.)</li><li>–£–∫—Ä–∞—à–µ–Ω–∏–µ: —Å–≤–µ—á–µ–Ω–∏–µ (—Å–ª—É—á.)</li>
            <li>VIP 1 –º–µ—Å—è—Ü</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <div style="height:40px"></div>
</div>

<div id="notif"></div>

<!-- PROFILE EDITOR -->
<dialog id="profileModal" style="border:none;border-radius:10px;padding:0">
  <div style="width:min(800px,96vw);background:rgba(255,255,255,0.03);padding:16px;border-radius:10px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <button onclick="document.getElementById('profileModal').close()" style="background:none;border:0;color:var(--muted);cursor:pointer">‚úï</button>
    </div>
    <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
      <div style="flex:0 0 140px"><img id="editorPreview" src="" style="width:140px;height:140px;border-radius:10px;object-fit:cover"></div>
      <div style="flex:1">
        <label class="hint">–ù–∏–∫</label>
        <input id="editorNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.09);background:transparent;color:var(--text)"/>
        <label class="hint" style="margin-top:8px">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
        <input id="editorAvatar" type="file" />
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn primary" onclick="saveProfileEdits()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" onclick="document.getElementById('profileModal').close()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</dialog>

<!-- Confetti -->
<canvas id="confetti" style="position:fixed;left:0;top:0;pointer-events:none;z-index:9999"></canvas>

<script>
/* =========================================================
   State & persistence
   ========================================================= */
const STORAGE = 'gameloaders_mega_v4';
const XP_PER_LEVEL = 1000, MAX_LEVEL=100;

let state = {
  nick:'Player',
  avatar:'https://i.pravatar.cc/400?img=12',
  coins:1000,
  xp:0,
  vip:false,
  vipLevel:null,
  tickets:0,
  ownedFrames:[],
  ownedGlows:[],
  ownedEffects:[], // –Ω–∞–ø—Ä–∏–º–µ—Ä: 'profile-snow'
  applied:{type:null,id:null}, // frame | glow
  chat:[],
  stats:{downloads:0, users:1}
};

function loadState(){ try{ const s = JSON.parse(localStorage.getItem(STORAGE)); if(s) state = Object.assign(state, s);}catch(e){} }
function saveState(){ localStorage.setItem(STORAGE, JSON.stringify(state)); renderAll(); }

/* =========================================================
   Helpers & UI
   ========================================================= */
const $ = id => document.getElementById(id);
const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
function notify(msg,t=2200){ const n=$('notif'); n.textContent=msg; n.style.opacity=1; n.style.transform='translateY(0)'; setTimeout(()=>{ n.style.opacity=0; n.style.transform='translateY(12px)'; }, t); }
function xpToLevel(xp){ return clamp(Math.floor(xp/XP_PER_LEVEL)+1,1,MAX_LEVEL); }
function addXP(amount){ if(state.xp>=MAX_LEVEL*XP_PER_LEVEL) return; const prev=xpToLevel(state.xp); state.xp=clamp(state.xp+amount,0,MAX_LEVEL*XP_PER_LEVEL); const now=xpToLevel(state.xp); if(now>prev){ notify('üéâ Level Up ‚Äî '+now,3000); launchConfetti(); } saveState(); }
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* =========================================================
   Catalog data
   ========================================================= */
const FRAMES = [
  // —Å—Å—ã–ª–∫–∏ —Å –≤–∞—à–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ + –∑–∞–ø–∞—Å–Ω—ã–µ
  {id:'f1', title:'Ice (LoL style)', price:150, vipOnly:false, url:'https://wallpapers.com/images/hd/leagueof-legends-ice-themed-icon-lbz9rlqcojud9fo5.png'},
  {id:'f2', title:'LoL Icon Ring', price:220, vipOnly:false, url:'https://i2.wp.com/www.seekpng.com/png/full/155-1551417_league-of-legends-icon-png.png'},
  {id:'f3', title:'Neon Circle', price:300, vipOnly:false, url:'https://i.imgur.com/V7HiEOp.png'},
  {id:'f4', title:'VIP - Gold Spiral', price:0, vipOnly:true, url:'https://i.imgur.com/6zq4O8y.png'},
  {id:'f5', title:'VIP - Royal Crest', price:0, vipOnly:true, url:'https://i.imgur.com/3Xq1GkN.png'},
];
for(let i=6;i<=26;i++){
  FRAMES.push({id:'f'+i,title:'Frame #'+i,price:80+((i*17)%420),vipOnly:(i%11===0),url:`https://picsum.photos/seed/frame${i}/300/300`});
}

const GLOWS = [
  {id:'g1', title:'üî• Fire', price:500, cls:'glow-fire'},
  {id:'g2', title:'üíß Water', price:500, cls:'glow-water'},
  {id:'g3', title:'üåà Rainbow', price:1000, cls:'glow-rainbow'},
  {id:'g4', title:'‚≠ê Soft Glow', price:200, cls:'glow-basic'}
];
for(let i=5;i<=16;i++){
  GLOWS.push({id:'g'+i,title:`Glow FX ${i}`,price:100+((i*37)%700),cls:(i%2?'glow-basic':'glow-rainbow')});
}

const EFFECTS = [
  {id:'profile-snow', title:'–°–Ω–µ–≥ –≤ –ø—Ä–æ—Ñ–∏–ª–µ', price:400, desc:'–ö—Ä–∞—Å–∏–≤—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥ –Ω–∞ —Ñ–æ–Ω–µ –ø—Ä–æ—Ñ–∏–ª—è.'}
];

const COIN_PACKS = [
  {id:'c1', coins:100, price:99},
  {id:'c2', coins:250, price:199},
  {id:'c3', coins:500, price:349},
  {id:'c4', coins:1000, price:599},
  {id:'c5', coins:2500, price:1299},
  {id:'c6', coins:5000, price:2399}
];

const GAMES = ['Apex Legends','Fortnite','Minecraft','CS:GO','Rust','GTA V','Valorant','Overwatch','LoL','Dota2','Elden Ring','Skyrim','Terraria','Sea of Thieves'];
const LOADERS = [];
GAMES.forEach((g,idx)=>{
  LOADERS.push({id:`free-${idx}`,name:`${g} ‚Äî Free Loader`,game:g,type:'free'});
  LOADERS.push({id:`pro-${idx}`,name:`${g} ‚Äî Pro Loader`,game:g,type:'pro',price:129+idx*30});
  LOADERS.push({id:`vip-${idx}`,name:`${g} ‚Äî VIP Loader`,game:g,type:'vip'});
});

/* =========================================================
   Rendering
   ========================================================= */
function renderAll(){
  $('statCoins').textContent = `${state.coins} üí∞`;
  $('statLevel').textContent = `Lvl ${xpToLevel(state.xp)}`;
  $('statTickets').textContent = `üéü ${state.tickets}`;
  $('wheelTickets').textContent = state.tickets;

  // profile
  $('displayName').textContent = state.nick;
  $('avatarImg').src = state.avatar;
  $('uiCoins').textContent = state.coins;
  $('uiTickets').textContent = state.tickets;
  $('uiLevel').textContent = xpToLevel(state.xp);
  const cur = state.xp % XP_PER_LEVEL;
  $('uiXPbar').style.width = (cur/XP_PER_LEVEL*100) + '%';
  $('uiXPtext').textContent = `${cur} / ${XP_PER_LEVEL} XP`;

  // VIP badge
  const vb = $('vipBadge'); vb.innerHTML='';
  if(state.vip){
    const d=document.createElement('div'); d.className='vip-badge';
    d.textContent = state.vipLevel==='lifetime' ? 'VIP ¬∑ Forever' : (state.vipLevel==='year' ? 'VIP ¬∑ Year' : 'VIP ¬∑ Month');
    vb.appendChild(d);
  }else vb.innerHTML='<div class="hint">–ù–µ—Ç VIP</div>';

  // owned list
  const ol=$('ownedList'); ol.innerHTML='';
  state.ownedFrames.forEach(fid=>{
    const f=FRAMES.find(x=>x.id===fid); if(!f) return;
    const el=document.createElement('div'); el.className='card'; el.style.padding='8px';
    el.innerHTML=`<div style="font-weight:800">${escapeHtml(f.title)}</div><div class="hint">${f.vipOnly?'VIP only':f.price+' –º–æ–Ω–µ—Ç'}</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyFrame('${f.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;
    ol.appendChild(el);
  });
  state.ownedGlows.forEach(gid=>{
    const g=GLOWS.find(x=>x.id===gid); if(!g) return;
    const el=document.createElement('div'); el.className='card'; el.style.padding='8px';
    el.innerHTML=`<div style="font-weight:800">${escapeHtml(g.title)}</div><div class="hint">${g.price} –º–æ–Ω–µ—Ç</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyGlow('${g.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;
    ol.appendChild(el);
  });
  state.ownedEffects.forEach(eid=>{
    const e=EFFECTS.find(x=>x.id===eid); if(!e) return;
    const el=document.createElement('div'); el.className='card'; el.style.padding='8px';
    el.innerHTML=`<div style="font-weight:800">${escapeHtml(e.title)}</div><div class="hint">${e.price} –º–æ–Ω–µ—Ç</div>`;
    ol.appendChild(el);
  });

  renderApplied();
  renderChat();

  if(!window._renderedOnce){
    populateFilters();
    renderLoaders(); renderCoinPacks();
    renderFramesGrid(); renderGlowsGrid(); renderEffectsGrid();
    setupWheel(); createGarland();
    window._renderedOnce = true;
  }
}

/* Frames grid */
function renderFramesGrid(){
  const parent=$('framesGrid'); parent.innerHTML='';
  FRAMES.forEach(f=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<div style="height:130px;display:flex;align-items:center;justify-content:center">
      <img src="${f.url}" onerror="this.style.opacity=.5" style="max-width:100%;max-height:100%"/>
    </div>
    <div style="font-weight:800;margin-top:8px">${escapeHtml(f.title)}</div>
    <div class="hint">${f.vipOnly? 'VIP only' : f.price + ' –º–æ–Ω–µ—Ç'}</div>`;
    el.addEventListener('click', ()=>{
      if(f.vipOnly && !state.vip){ notify('–†–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP'); goTo('vip'); return; }
      if(!state.ownedFrames.includes(f.id)){
        if(!f.vipOnly){
          if(state.coins < f.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
          state.coins -= f.price; state.ownedFrames.push(f.id); addXP(Math.round(f.price/2));
          notify('–†–∞–º–∫–∞ –∫—É–ø–ª–µ–Ω–∞: '+f.title); saveState();
        } else { state.ownedFrames.push(f.id); notify('–†–∞–º–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ (VIP)'); saveState(); }
      } else { state.applied = {type:'frame', id:f.id}; notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: '+f.title); saveState(); }
    });
    if(state.ownedFrames.includes(f.id)){ const tag = document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}

/* Glows grid */
function renderGlowsGrid(){
  const parent=$('glowsGrid'); parent.innerHTML='';
  GLOWS.forEach(g=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(g.title)}</div>
      <div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>`;
    el.addEventListener('click', ()=>{
      if(!state.ownedGlows.includes(g.id)){
        if(state.coins < g.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        state.coins -= g.price; state.ownedGlows.push(g.id); addXP(Math.round(g.price/3));
        notify('–ö—É–ø–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ: '+g.title); saveState();
      } else { state.applied={type:'glow',id:g.id}; notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: '+g.title); saveState(); }
    });
    if(state.ownedGlows.includes(g.id)){ const tag=document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}

/* Effects grid */
function renderEffectsGrid(){
  const parent=$('effectsGrid'); parent.innerHTML='';
  EFFECTS.forEach(e=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<div style="font-weight:900">${escapeHtml(e.title)}</div><div class="hint">${escapeHtml(e.desc)}</div><div class="hint" style="margin-top:6px">${e.price} –º–æ–Ω–µ—Ç</div>`;
    el.addEventListener('click', ()=>{
      if(!state.ownedEffects.includes(e.id)){
        if(state.coins < e.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        state.coins -= e.price; state.ownedEffects.push(e.id); addXP(Math.round(e.price/2));
        notify('–ö—É–ø–ª–µ–Ω–æ: '+e.title); saveState();
      } else {
        if(e.id==='profile-snow'){ toggleProfileSnow(true); notify('–°–Ω–µ–≥ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –≤–∫–ª—é—á—ë–Ω'); }
      }
    });
    if(state.ownedEffects.includes(e.id)){ const tag=document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}

/* Coin packs */
function renderCoinPacks(){
  const parent=$('coinPacks'); parent.innerHTML='';
  COIN_PACKS.forEach(p=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div class="hint">${p.price} ‚ÇΩ</div>`;
    const b=document.createElement('button'); b.className='btn primary'; b.textContent='–ö—É–ø–∏—Ç—å';
    b.onclick=()=>{ state.coins+=p.coins; addXP(Math.round(p.coins/5)); notify(`–ö—É–ø–ª–µ–Ω–æ ${p.coins} –º–æ–Ω–µ—Ç (+${Math.round(p.coins/5)} XP)`); saveState(); };
    el.appendChild(b); parent.appendChild(el);
  });
}

/* Loaders */
function renderLoaders(){
  const parent=$('loadersGrid'); parent.innerHTML='';
  const t=$('filterType').value, g=$('filterGame').value;
  LOADERS.filter(l=>{
    if(t!=='all' && l.type!==t) return false;
    if(g && g!=='all' && l.game!==g) return false;
    return true;
  }).forEach(l=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<div class="hint">${escapeHtml(l.game)}</div>
      <div style="font-weight:900;margin-top:6px">${escapeHtml(l.name)}</div>
      <div class="hint" style="margin-top:8px">${l.type==='free'?'–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π':l.type==='pro'?'–ü–ª–∞—Ç–Ω—ã–π '+l.price+'‚ÇΩ':'–¢–æ–ª—å–∫–æ VIP'}</div>`;
    const ctrl=document.createElement('div'); ctrl.style.marginTop='10px';
    if(l.type==='free'){
      const b=document.createElement('button'); b.className='btn primary'; b.textContent='–°–∫–∞—á–∞—Ç—å';
      b.onclick=()=>{ state.stats.downloads++; addXP(50); notify('–°–∫–∞—á–∞–Ω–æ (–¥–µ–º–æ) +50 XP'); saveState(); };
      ctrl.appendChild(b);
    }else if(l.type==='pro'){
      const b=document.createElement('button'); b.className='btn primary'; b.textContent=`–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`;
      b.onclick=()=>{ addXP(300); notify('–ö—É–ø–ª–µ–Ω Pro (–¥–µ–º–æ) +300 XP'); saveState(); };
      ctrl.appendChild(b);
    }else{
      const b=document.createElement('button'); b.className='btn primary'; b.textContent='–¢–æ–ª—å–∫–æ VIP';
      b.onclick=()=>{ if(state.vip){ state.stats.downloads++; addXP(100); notify('VIP –∑–∞–≥—Ä—É–∑–∫–∞ +100 XP'); saveState(); } else { notify('–ù—É–∂–µ–Ω VIP'); goTo('vip'); } };
      ctrl.appendChild(b);
    }
    el.appendChild(ctrl); parent.appendChild(el);
  });
}

function populateFilters(){
  const sel=$('filterGame'); sel.innerHTML='<option value="all">–í—Å–µ –∏–≥—Ä—ã</option>'; GAMES.forEach(g=>{ const o=document.createElement('option'); o.value=g; o.textContent=g; sel.appendChild(o); });
  $('filterType').value='all'; $('filterGame').value='all';
  $('filterType').addEventListener('change', renderLoaders);
  $('filterGame').addEventListener('change', renderLoaders);
}

/* =========================================================
   Apply decorations (frames & glows)
   ========================================================= */
function clearOverlays(){
  const f=document.querySelector('.frame-overlay'); if(f) f.remove();
  const g=document.querySelector('.glow-class'); if(g) g.remove();
  $('avatarWrap').classList.remove(...GLOWS.map(x=>x.cls));
}
function renderApplied(){
  clearOverlays();
  const wrap=$('avatarWrap');
  if(state.applied && state.applied.type==='frame'){
    const f=FRAMES.find(x=>x.id===state.applied.id);
    if(f){ const img=document.createElement('img'); img.className='frame-overlay'; img.src=f.url; wrap.appendChild(img); }
  }else if(state.applied && state.applied.type==='glow'){
    const g=GLOWS.find(x=>x.id===state.applied.id);
    if(g){ const div=document.createElement('div'); div.className='glow-class '+g.cls; wrap.appendChild(div); }
  }
}
function applyFrame(fid){ if(!state.ownedFrames.includes(fid)){ notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–π —Ä–∞–º–∫–∏'); return; } state.applied={type:'frame',id:fid}; saveState(); notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞'); }
function applyGlow(gid){ if(!state.ownedGlows.includes(gid)){ notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è'); return; } state.applied={type:'glow',id:gid}; saveState(); notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ'); }
function unequipAll(){ state.applied={type:null,id:null}; saveState(); notify('–í—Å–µ —É–∫—Ä–∞—à–µ–Ω–∏—è —Å–Ω—è—Ç—ã'); }
function openFramesInShop(){ goTo('shop'); setTimeout(()=>document.getElementById('framesGrid').scrollIntoView({behavior:'smooth'}),50); }
function openGlowsInShop(){ goTo('shop'); setTimeout(()=>document.getElementById('glowsGrid').scrollIntoView({behavior:'smooth'}),50); }

/* =========================================================
   VIP purchase (demo)
   ========================================================= */
function buyVIP(level, price, tickets, coins, levels){
  state.vip=true; state.vipLevel=level;
  state.tickets += tickets;
  state.coins += coins;
  addXP(levels*XP_PER_LEVEL);
  notify(`VIP –æ—Ñ–æ—Ä–º–ª–µ–Ω (${level}). –ë–∏–ª–µ—Ç–æ–≤: +${tickets}, –º–æ–Ω–µ—Ç—ã: +${coins}, —É—Ä–æ–≤–Ω–∏: +${levels}.`);
  saveState();
}

/* =========================================================
   Chat
   ========================================================= */
function renderChat(){
  const out=$('chatMessages'); out.innerHTML='';
  state.chat.slice(-500).forEach(m=>{
    const div=document.createElement('div'); div.className='chat-msg';
    const t=new Date(m.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    div.innerHTML=`<div style="font-weight:700">${escapeHtml(m.nick)} <span style="font-weight:400;color:var(--muted);font-size:12px"> ${t}</span></div><div>${escapeHtml(m.msg)}</div>`;
    out.appendChild(div);
  });
  out.scrollTop = out.scrollHeight;
}
function sendChat(){ const inp=$('chatInput'); const txt=inp.value.trim(); if(!txt) return; state.chat.push({nick:state.nick,msg:txt,t:Date.now()}); saveState(); inp.value=''; renderChat(); }
function clearChat(){ state.chat=[]; saveState(); notify('–ß–∞—Ç –æ—á–∏—â–µ–Ω'); }
function exportChat(){ const blob=new Blob([JSON.stringify(state.chat,null,2)],{type:'application/json'}); const u=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=u; a.download='chat_export.json'; a.click(); URL.revokeObjectURL(u); }

/* =========================================================
   Profile editor
   ========================================================= */
$('editorAvatar').addEventListener('change', e=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader(); r.onload=()=>{ $('editorPreview').src=r.result; }; r.readAsDataURL(f);
});
function openProfileEditor(){ $('editorPreview').src=state.avatar; $('editorNick').value=state.nick; $('profileModal').showModal(); }
function saveProfileEdits(){ const nv=$('editorNick').value.trim(); if(nv) state.nick=nv; const preview=$('editorPreview').src; if(preview) state.avatar=preview; saveState(); $('profileModal').close(); notify('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω'); }

/* =========================================================
   Wheel of Fortune (canvas + sound + garland)
   ========================================================= */
const wheelCanvas = $('wheel'); const wctx = wheelCanvas.getContext('2d');
const radius = wheelCanvas.width/2;
const wheelPrizes = [
  {k:'coins100', label:'+100 –º–æ–Ω–µ—Ç', action:()=>{ state.coins+=100; }},
  {k:'coins250', label:'+250 –º–æ–Ω–µ—Ç', action:()=>{ state.coins+=250; }},
  {k:'coins500', label:'+500 –º–æ–Ω–µ—Ç', action:()=>{ state.coins+=500; }},
  {k:'xp700',    label:'+700 XP',    action:()=>{ addXP(700); }},
  {k:'xp1200',   label:'+1200 XP',   action:()=>{ addXP(1200); }},
  {k:'ticket',   label:'üéü +1 –±–∏–ª–µ—Ç',action:()=>{ state.tickets+=1; }},
  {k:'frame',    label:'–†–∞–º–∫–∞ (—Å–ª—É—á.)', action:()=>{ const pool=FRAMES.filter(f=>!f.vipOnly); const f=pool[Math.floor(Math.random()*pool.length)]; if(!state.ownedFrames.includes(f.id)) state.ownedFrames.push(f.id); }},
  {k:'glow',     label:'–°–≤–µ—á–µ–Ω–∏–µ (—Å–ª—É—á.)', action:()=>{ const g=GLOWS[Math.floor(Math.random()*GLOWS.length)]; if(!state.ownedGlows.includes(g.id)) state.ownedGlows.push(g.id); }},
  {k:'vip1m',    label:'VIP 1 –º–µ—Å—è—Ü', action:()=>{ state.vip=true; state.vipLevel = state.vipLevel || 'month'; state.tickets+=2; addXP(5*XP_PER_LEVEL); }}
];
const seg = Math.PI*2 / wheelPrizes.length;
let wheelAngle=0, wheelSpeed=0, wheelSpinning=false;
let tickAudio = new Audio("https://cdn.pixabay.com/download/audio/2022/03/10/audio_8e8eb1fe04.mp3?filename=mouse-click-153941.mp3");

function drawWheel(rot=0){
  wctx.clearRect(0,0,wheelCanvas.width,wheelCanvas.height);
  for(let i=0;i<wheelPrizes.length;i++){
    const start = i*seg + rot;
    wctx.beginPath();
    // –Ω–æ–≤–æ–≥–æ–¥–Ω—è—è –ø–∞–ª–∏—Ç—Ä–∞
    const colors = ['#ff4d4d','#ffd24d','#4dff88','#4da6ff','#b84dff','#ff944d','#4dffff','#ff66cc','#9cff4d'];
    wctx.fillStyle = colors[i % colors.length];
    wctx.moveTo(radius,radius);
    wctx.arc(radius,radius,radius-4,start,start+seg);
    wctx.fill();

    // Text
    wctx.save();
    wctx.translate(radius,radius);
    wctx.rotate(start+seg/2);
    wctx.fillStyle='#041022';
    wctx.font='16px Inter, Arial';
    wctx.textAlign='right';
    wctx.fillText(wheelPrizes[i].label, radius-24,6);
    wctx.restore();
  }
  // center hub
  wctx.beginPath(); wctx.fillStyle='#fff'; wctx.arc(radius,radius,36,0,Math.PI*2); wctx.fill();
  wctx.beginPath(); wctx.fillStyle='#0dd'; wctx.arc(radius,radius,26,0,Math.PI*2); wctx.fill();
}

function setupWheel(){ drawWheel(wheelAngle); $('spinBtn').addEventListener('click', spinWheel); }
function spinWheel(){
  if(wheelSpinning) return;
  if(state.tickets<=0){ notify('–°–ø–∏—Å–∞–Ω–æ 499 ‚ÇΩ (–¥–µ–º–æ). –î–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π –æ–ø–ª–∞—Ç—ã –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.'); } else { state.tickets--; }
  $('wheelTickets').textContent = state.tickets;
  wheelSpinning=true; wheelSpeed = Math.random()*0.25 + 0.35; animateWheel();
}
function animateWheel(){
  if(!wheelSpinning) return;
  wheelSpeed *= 0.985;
  wheelAngle += wheelSpeed;
  drawWheel(wheelAngle);
  if(Math.random()<0.18) { try{ tickAudio.currentTime=0; tickAudio.play(); }catch(e){} }
  if(wheelSpeed < 0.0025){
    wheelSpinning=false;
    wheelAngle = wheelAngle % (Math.PI*2);
    let index = Math.floor((wheelPrizes.length - (wheelAngle/(2*Math.PI))*wheelPrizes.length) % wheelPrizes.length);
    const prize = wheelPrizes[index];
    prize.action(); saveState();
    $('wheelResult').innerHTML = `<div class="card">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <b>${prize.label}</b></div>`;
    notify('–í—ã–∏–≥—Ä—ã—à: '+prize.label,3000);
  } else {
    requestAnimationFrame(animateWheel);
  }
}

/* Garland around wheel */
function createGarland(){
  const g=$('garland'); g.innerHTML='';
  const count = 34;
  for(let i=0;i<count;i++){
    const bulb=document.createElement('div'); bulb.className='bulb';
    bulb.style.color=['#ff3b3b','#ffe066','#66ff99','#66d9ff','#ff66ff'][i%5];
    const a = (i/count)*Math.PI*2;
    const x = 270 + Math.cos(a)*260;
    const y = 270 + Math.sin(a)*260;
    bulb.style.left=(x-9)+'px'; bulb.style.top=(y-9)+'px';
    bulb.style.animationDelay = (i*0.08)+'s';
    g.appendChild(bulb);
  }
}

/* =========================================================
   Snow (global) + profile snow toggle
   ========================================================= */
const snowCanvas = $('snowCanvas'), sctx = snowCanvas.getContext('2d');
let snowflakes=[];
function resizeSnow(){ snowCanvas.width=innerWidth; snowCanvas.height=innerHeight; }
addEventListener('resize', resizeSnow); resizeSnow();
function spawnSnow(n=120){ for(let i=0;i<n;i++){ snowflakes.push({x:Math.random()*snowCanvas.width,y:Math.random()*snowCanvas.height,r:1+Math.random()*3,vx:(Math.random()-.5)*0.8,vy:0.6+Math.random()*1.2}); } }
spawnSnow(160);
function snowLoop(){
  sctx.clearRect(0,0,snowCanvas.width,snowCanvas.height);
  sctx.fillStyle='rgba(255,255,255,0.9)';
  snowflakes.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy; if(p.y>snowCanvas.height){p.y=-5; p.x=Math.random()*snowCanvas.width;}
    sctx.beginPath(); sctx.arc(p.x,p.y,p.r,0,Math.PI*2); sctx.fill();
  });
  requestAnimationFrame(snowLoop);
}
snowLoop();

/* Profile snow (separate canvas inside profile panel) */
let profileSnowRunning=false, profileSnow=[];
function toggleProfileSnow(forceOn){
  const owned = state.ownedEffects.includes('profile-snow');
  if(!owned && !forceOn){ notify('–≠—Ñ—Ñ–µ–∫—Ç –Ω–µ –∫—É–ø–ª–µ–Ω. –û—Ç–∫—Ä–æ–π –ú–∞–≥–∞–∑–∏–Ω ‚Üí –≠—Ñ—Ñ–µ–∫—Ç—ã.'); return; }
  const canvas = $('profileSnow');
  if(canvas.style.display==='none' && (owned || forceOn)){
    canvas.style.display='block';
    startProfileSnow();
  } else {
    canvas.style.display='none';
    profileSnowRunning=false; profileSnow=[];
  }
}
function startProfileSnow(){
  const canvas=$('profileSnow'), ctx=canvas.getContext('2d');
  const host=$('profileTop'); const r=host.getBoundingClientRect();
  canvas.width = host.clientWidth; canvas.height = host.clientHeight;
  profileSnow=[]; for(let i=0;i<90;i++){ profileSnow.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:1+Math.random()*2,vy:0.5+Math.random()*1}); }
  profileSnowRunning=true;
  (function loop(){
    if(!profileSnowRunning) return;
    // keep size in sync
    const w=host.clientWidth,h=host.clientHeight; if(w!==canvas.width||h!==canvas.height){ canvas.width=w; canvas.height=h; }
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='rgba(255,255,255,0.95)';
    profileSnow.forEach(p=>{ p.y+=p.vy; if(p.y>canvas.height){p.y=-5; p.x=Math.random()*canvas.width;} ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });
    requestAnimationFrame(loop);
  })();
}

/* =========================================================
   Confetti
   ========================================================= */
const confettiCanvas = $('confetti'); const cctx = confettiCanvas.getContext('2d'); let confetti=[];
function resizeCanvas(){ confettiCanvas.width=innerWidth; confettiCanvas.height=innerHeight; } addEventListener('resize', resizeCanvas); resizeCanvas();
function launchConfetti(){ for(let i=0;i<130;i++){ confetti.push({x:Math.random()*confettiCanvas.width,y:-Math.random()*confettiCanvas.height,vx:(Math.random()-.5)*6,vy:2+Math.random()*6,s:4+Math.random()*8,c:['#ff4d4d','#ffd65b','#7c4dff','#00d4ff','#4dff88'][Math.floor(Math.random()*5)],r:Math.random()*360}); } if(!window._confRun){window._confRun=true; requestAnimationFrame(confettiLoop);} }
function confettiLoop(){
  cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confetti.forEach((p,i)=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; p.r+=p.vx; cctx.save(); cctx.translate(p.x,p.y); cctx.rotate(p.r*Math.PI/180); cctx.fillStyle=p.c; cctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); cctx.restore(); if(p.y>confettiCanvas.height+50) confetti.splice(i,1); });
  if(confetti.length) requestAnimationFrame(confettiLoop); else window._confRun=false;
}

/* =========================================================
   Navigation & bindings
   ========================================================= */
function goTo(tab){
  const mapping={buy:'page-buy',vip:'page-vip',shop:'page-shop',profile:'page-profile',chat:'page-chat',wheel:'page-wheel'};
  document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section[id^="page-"]').forEach(s=>s.style.display='none');
  $('btn-'+tab).classList.add('active'); $(mapping[tab]).style.display='block';
}
function bindUI(){
  $('btn-buy').addEventListener('click',()=>goTo('buy'));
  $('btn-vip').addEventListener('click',()=>goTo('vip'));
  $('btn-shop').addEventListener('click',()=>goTo('shop'));
  $('btn-profile').addEventListener('click',()=>goTo('profile'));
  $('btn-chat').addEventListener('click',()=>goTo('chat'));
  $('btn-wheel').addEventListener('click',()=>goTo('wheel'));
  $('chatSend').addEventListener('click',sendChat);
  $('chatInput').addEventListener('keydown',e=>{ if(e.key==='Enter') sendChat(); });
  $('authBtn').addEventListener('click',()=>notify('DEMO: –í–æ–π–¥–µ–Ω—ã –∫–∞–∫ –≥–æ—Å—Ç—å'));
}
function awardDemoXP(){ addXP(200); notify('+200 XP'); saveState(); }

/* =========================================================
   Init
   ========================================================= */
loadState();
bindUI();
renderAll();
notify('–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ üéÑ',2600);

/* expose for console */
window._GL = {state,saveState,addXP,applyFrame,applyGlow,unequipAll,buyVIP,toggleProfileSnow};
</script>
</body>
</html>
