<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GameLoaders ‚Äî Mega Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#051025;--bg2:#0b1222;--card:#0f1724;--muted:#9ab0d6;--text:#e8f0ff;
  --neon1:#7c4dff;--neon2:#00d4ff;--vip-grad:conic-gradient(from 0deg,#ff0044,#ff9900,#ffee00,#00ff77,#00ccff,#7c4dff);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
body{
  background:
    radial-gradient(600px 300px at 10% 10%, rgba(124,77,255,0.04), transparent),
    radial-gradient(600px 300px at 90% 80%, rgba(0,212,255,0.03), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  padding-bottom:120px;
}
.container{width:min(1280px,96%);margin:0 auto;padding:18px 0}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0;position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));backdrop-filter:blur(8px);z-index:200;border-bottom:1px solid rgba(255,255,255,0.03)}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--neon1)}
.brand .logo{width:18px;height:18px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 8px 28px rgba(124,77,255,0.2)}
.header .left,.header .center,.header .right{display:flex;align-items:center;gap:10px}
.tabbtn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);font-weight:700;cursor:pointer}
.tabbtn.active{color:var(--text);background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 12px 40px rgba(124,77,255,0.12)}
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 40px rgba(2,6,23,0.5)}
.spaced{margin-top:16px}
.grid{display:grid;gap:12px}
.cols-2{grid-template-columns:repeat(2,1fr)}
.cols-3{grid-template-columns:repeat(3,1fr)}
.cols-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:960px){.cols-4{grid-template-columns:repeat(2,1fr)}.cols-3{grid-template-columns:repeat(2,1fr)}}
.card{border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);transition:transform .18s,box-shadow .18s;overflow:hidden}
.card:hover{transform:translateY(-6px);box-shadow:0 22px 60px rgba(0,0,0,0.6)}
.hint{color:var(--muted);font-size:13px}
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
.btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#fff;box-shadow:0 8px 30px rgba(124,77,255,0.14)}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.06)}
.btn.warn{background:linear-gradient(90deg,#ff9966,#ff4d4d);color:#041022}

/* ====== –ü—Ä–æ—Ñ–∏–ª—å ====== */
/* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–æ–±—â–µ –ù–ï–¢ —Ä–∞–º–∫–∏/—Å–≤–µ—á–µ–Ω–∏—è */
.avatar-wrap{position:relative;width:136px;height:136px;border-radius:50%;padding:0;background:transparent;box-shadow:none}
.avatar-inner{width:100%;height:100%;border-radius:50%;overflow:hidden;border:none}
.avatar-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.frame-overlay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:150px;height:150px;border-radius:50%;pointer-events:none;mix-blend-mode:screen}
.glow-class{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:170px;height:170px;border-radius:50%;pointer-events:none;z-index:0}
.glow-fire{box-shadow:0 0 38px 16px rgba(255,110,25,0.85)!important;animation:glowFlicker 1.2s infinite}
.glow-water{box-shadow:0 0 36px 14px rgba(0,160,255,0.8)!important;animation:glowWave 3s infinite}
.glow-rainbow{animation:glowRainbow 5s linear infinite}
.glow-basic{box-shadow:0 0 20px 8px rgba(255,255,255,0.6)!important}
@keyframes glowFlicker{0%,20%,22%,64%,65%,100%{opacity:1}21%,23%,63%,66%{opacity:.3}}
@keyframes glowWave{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.06)}100%{transform:translate(-50%,-50%) scale(1)}}
@keyframes glowRainbow{
  0%{box-shadow:0 0 40px 12px rgba(255,0,0,0.8)}
  25%{box-shadow:0 0 40px 12px rgba(255,160,0,0.8)}
  50%{box-shadow:0 0 40px 12px rgba(0,200,255,0.8)}
  75%{box-shadow:0 0 40px 12px rgba(120,0,255,0.8)}
  100%{box-shadow:0 0 40px 12px rgba(255,0,0,0.8)}
}
.vip-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:800;background:var(--vip-grad);background-size:300% 300%;animation:vipShift 6s linear infinite;color:#051022}
@keyframes vipShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.stats{display:flex;gap:12px}
.stat{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-weight:700}

/* ====== –ß–∞—Ç ====== */
.chat-wrap{display:flex;flex-direction:column;height:420px}
.chat-messages{flex:1;overflow:auto;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))}
.chat-input{display:flex;gap:8px;margin-top:8px}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
.chat-msg{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);}

/* ====== –ö–æ–ª–µ—Å–æ ====== */
.wheel-wrap{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
.wheel{width:320px;height:320px;border-radius:50%;border:6px solid rgba(255,255,255,0.06);position:relative;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.5)}
.slice{position:absolute;left:50%;top:50%;transform-origin:0 0;width:50%;height:50%;clip-path:polygon(0 0,100% 0,0 100%);}
.wheel-ind{position:absolute;left:50%;top:-10px;transform:translateX(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #fff;filter:drop-shadow(0 2px 6px rgba(0,0,0,.6))}
.spin-btn{min-width:180px}
.tickets-pill{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.08);display:inline-flex;align-items:center;gap:6px}

/* ====== —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ====== */
#notif{position:fixed;right:20px;bottom:20px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;font-weight:800;transform:translateY(12px);opacity:0;transition:all .3s;z-index:9999}

@media (max-width:980px){
  .header{flex-direction:column;align-items:flex-start;gap:8px}
}
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <div class="header" role="banner">
    <div class="left brand"><div class="logo"></div> <div>GameLoaders Mega Hub</div></div>
    <div class="center">
      <button class="tabbtn active" id="btn-buy">–ö—É–ø–∏—Ç—å</button>
      <button class="tabbtn" id="btn-vip">VIP</button>
      <button class="tabbtn" id="btn-wheel">–ö–æ–ª–µ—Å–æ</button>
      <button class="tabbtn" id="btn-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tabbtn" id="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tabbtn" id="btn-chat">–ß–∞—Ç</button>
    </div>
    <div class="right">
      <div id="header-stats" style="display:flex;gap:12px;align-items:center">
        <div class="stat" id="statCoins">0 üí∞</div>
        <div class="stat" id="statTickets">üéü 0</div>
        <div class="stat" id="statLevel">Lvl 1</div>
      </div>
      <button class="tabbtn" id="authBtn">–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <!-- BUY -->
  <section id="page-buy" class="panel spaced">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 style="margin:0">–ö—É–ø–∏—Ç—å ‚Äî –õ–æ–∞–¥–µ—Ä—ã</h2>
        <div class="hint">Free / Pro / VIP-only ‚Äî –¥–µ–º–æ –ø–æ–∫—É–ø–∫–∏/–∑–∞–≥—Ä—É–∑–∫–∏</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="filterGame" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)"></select>
        <select id="filterType" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)">
          <option value="all">–í—Å–µ —Ç–∏–ø—ã</option><option value="free">Free</option><option value="pro">Pro</option><option value="vip">VIP-only</option>
        </select>
      </div>
    </div>
    <div id="loadersGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
  </section>

  <!-- VIP -->
  <section id="page-vip" class="panel spaced" style="display:none">
    <h2 style="margin:0">VIP ‚Äî –æ—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</h2>
    <div class="hint">VIP —Å—Ä–∞–∑—É –¥–∞—ë—Ç +5 —É—Ä–æ–≤–Ω–µ–π, –º–æ–Ω–µ—Ç—ã –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –±–∏–ª–µ—Ç—ã –Ω–∞ –∫–æ–ª–µ—Å–æ</div>
    <div class="grid cols-3 spaced" style="margin-top:12px">
      <div class="card">
        <h3>1 –º–µ—Å—è—Ü</h3>
        <ul class="hint">
          <li>+5 —É—Ä–æ–≤–Ω–µ–π</li>
          <li>+300 –º–æ–Ω–µ—Ç</li>
          <li>üéü +2 –±–∏–ª–µ—Ç–∞ –Ω–∞ –∫–æ–ª–µ—Å–æ</li>
          <li>–î–æ—Å—Ç—É–ø –∫ VIP-—Ä–∞–º–∫–∞–º (2 —à—Ç.)</li>
          <li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ —á–∞—Ç–µ (–±–µ–π–¥–∂)</li>
        </ul>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('month',299,2)">–ö—É–ø–∏—Ç—å 299 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>12 –º–µ—Å—è—Ü–µ–≤</h3>
        <ul class="hint">
          <li>+5 —É—Ä–æ–≤–Ω–µ–π</li>
          <li>+1000 –º–æ–Ω–µ—Ç</li>
          <li>üéü +5 –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –∫–æ–ª–µ—Å–æ</li>
          <li>VIP-—Ä–∞–º–∫–∏ + —Å–ø–µ—Ü. —Å–∫–∏–¥–∫–∏</li>
          <li>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥–æ–¥–æ–≤–æ–π –±–µ–π–¥–∂</li>
        </ul>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('year',2870,5)">–ö—É–ø–∏—Ç—å 2870 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ</h3>
        <ul class="hint">
          <li>+5 —É—Ä–æ–≤–Ω–µ–π</li>
          <li>+2500 –º–æ–Ω–µ—Ç</li>
          <li>üéü +10 –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –∫–æ–ª–µ—Å–æ</li>
          <li>–í—Å–µ VIP-—Ä–∞–º–∫–∏ –∏ –±—É–¥—É—â–∏–µ</li>
          <li>–ë–µ–π–¥–∂ ¬´VIP ¬∑ Forever¬ª</li>
        </ul>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('lifetime',7990,10)">–ö—É–ø–∏—Ç—å 7990 ‚ÇΩ</button></div>
      </div>
    </div>
  </section>

  <!-- WHEEL -->
  <section id="page-wheel" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ö–æ–ª–µ—Å–æ –≤–µ–∑–µ–Ω–∏—è</h2>
    <div class="hint">–û–¥–Ω–æ –≤—Ä–∞—â–µ–Ω–∏–µ: <b>499 ‚ÇΩ</b> (–¥–µ–º–æ). –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ üéü –±–∏–ª–µ—Ç.</div>
    <div class="wheel-wrap spaced">
      <div style="position:relative">
        <div class="wheel-ind"></div>
        <div id="wheel" class="wheel"></div>
      </div>
      <div style="flex:1;min-width:260px">
        <div class="tickets-pill">üéü –ë–∏–ª–µ—Ç—ã: <b id="ticketCount" style="margin-left:6px">0</b></div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn primary spin-btn" onclick="spinWheel()">–í—Ä–∞—â–∞—Ç—å (499 ‚ÇΩ / 1 –±–∏–ª–µ—Ç)</button>
          <button class="btn ghost" onclick="giftTicket()">–î–µ–º–æ: –∫—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</button>
        </div>
        <div id="lastPrize" class="card" style="margin-top:12px;display:none"></div>
        <div class="card" style="margin-top:12px">
          <div class="hint">–ü—Ä–∏–∑—ã:</div>
          <ul id="prizeList" class="hint" style="margin:6px 0 0 18px"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- SHOP -->
  <section id="page-shop" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="hint">–ú–æ–Ω–µ—Ç—ã, —Ä–∞–º–∫–∏, —Å–≤–µ—á–µ–Ω–∏—è –∏ –ø—Ä–∏–∫–æ–ª—é—Ö–∏</div>
    <div class="spaced card">
      <h3>–ü–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç</h3>
      <div id="coinPacks" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>
    <div class="spaced card">
      <h3>–†–∞–º–∫–∏ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ; 2 ‚Äî VIP-only)</h3>
      <div id="framesGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>
    <div class="spaced card">
      <h3>–°–≤–µ—á–µ–Ω–∏—è</h3>
      <div id="glowsGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>
    <div class="spaced card">
      <h3>–ü—Ä–∏–∫–æ–ª—é—Ö–∏</h3>
      <div id="itemsGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="page-profile" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div class="profile-top spaced" style="display:flex;gap:18px;align-items:center">
      <div style="display:flex;flex-direction:column;align-items:center">
        <div class="avatar-wrap" id="avatarWrap">
          <div class="avatar-inner"><img id="avatarImg" src="https://i.pravatar.cc/400?img=12" alt="avatar"></div>
          <!-- overlays rendered dynamically -->
        </div>
        <div style="margin-top:10px;font-weight:800" id="displayName">Player</div>
        <div id="vipBadge" style="margin-top:8px"></div>
      </div>

      <div style="flex:1" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="hint">–£—Ä–æ–≤–µ–Ω—å</div>
            <div style="font-weight:900;font-size:20px" id="uiLevel">1</div>
          </div>
          <div style="width:60%">
            <div class="hint">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è</div>
            <div style="height:12px;background:rgba(255,255,255,0.06);border-radius:8px;margin-top:6px;overflow:hidden">
              <div id="uiXPbar" style="height:100%;background:linear-gradient(90deg,var(--neon1),var(--neon2));width:0%"></div>
            </div>
            <div style="margin-top:6px" class="hint" id="uiXPtext">0 / 1000 XP</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <div class="hint">–ú–æ–Ω–µ—Ç—ã:</div><div style="font-weight:900" id="uiCoins">0</div>
          <div class="hint" style="margin-left:12px">üéü –ë–∏–ª–µ—Ç—ã:</div><div style="font-weight:900" id="uiTickets">0</div>
          <div style="margin-left:auto">
            <button class="btn ghost" onclick="openProfileEditor()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn primary" onclick="awardDemoXP()">+XP demo</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <h4 style="margin:0">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏ / –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h4>
          <div id="ownedList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <h3 style="margin:0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è–º–∏</h3>
      <div class="hint" style="margin-top:8px">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ª–∏–±–æ —Ä–∞–º–∫—É, –ª–∏–±–æ —Å–≤–µ—á–µ–Ω–∏–µ (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–ª—å–∑—è)</div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn ghost" onclick="unequipAll()">–°–Ω—è—Ç—å –≤—Å—ë</button>
        <button class="btn ghost" onclick="openFramesInShop()">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–º–∫–∏</button>
        <button class="btn ghost" onclick="openGlowsInShop()">–û—Ç–∫—Ä—ã—Ç—å —Å–≤–µ—á–µ–Ω–∏—è</button>
      </div>
    </div>
  </section>

  <!-- CHAT -->
  <section id="page-chat" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ß–∞—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ)</h2>
    <div class="row" style="margin-top:12px;gap:12px">
      <div style="flex:1" class="card">
        <div class="chat-wrap">
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button class="btn primary" id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div style="width:260px" class="card">
        <h4 style="margin:0">–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
        <div class="hint" style="margin-top:8px">–ß–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn ghost" onclick="clearChat()">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
          <button class="btn ghost" onclick="exportChat()">–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
      </div>
    </div>
  </section>

  <div style="height:36px"></div>
</div>

<div id="notif"></div>

<!-- Profile editor modal -->
<dialog id="profileModal" style="border:none;border-radius:10px;padding:0">
  <div style="width:min(800px,96vw);background:rgba(255,255,255,0.02);padding:16px;border-radius:10px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <button onclick="document.getElementById('profileModal').close()" style="background:none;border:0;color:var(--muted);cursor:pointer">‚úï</button>
    </div>
    <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
      <div style="flex:0 0 140px"><img id="editorPreview" src="" style="width:140px;height:140px;border-radius:10px;object-fit:cover"></div>
      <div style="flex:1">
        <label class="hint">–ù–∏–∫</label>
        <input id="editorNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)"/>
        <label class="hint" style="margin-top:8px">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
        <input id="editorAvatar" type="file" />
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn primary" onclick="saveProfileEdits()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" onclick="document.getElementById('profileModal').close()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</dialog>

<!-- confetti canvas -->
<canvas id="confetti" style="position:fixed;left:0;top:0;pointer-events:none;z-index:9999"></canvas>

<script>
/* ====== state ====== */
const STORAGE='gameloaders_mega_v4';
let state={
  nick:'Player',
  avatar:'https://i.pravatar.cc/400?img=12',
  coins:1000,
  xp:0,
  vip:false,
  vipLevel:null,
  tickets:0,                 // üéü –±–∏–ª–µ—Ç—ã –¥–ª—è –∫–æ–ª–µ—Å–∞
  ownedFrames:[],
  ownedGlows:[],
  applied:{type:null,id:null},
  chat:[]
};
const XP_PER_LEVEL=1000, MAX_LEVEL=100;

/* ====== helpers ====== */
const $=id=>document.getElementById(id);
function notify(msg,t=2200){const n=$('notif');n.textContent=msg;n.style.opacity=1;n.style.transform='translateY(0)';setTimeout(()=>{n.style.opacity=0;n.style.transform='translateY(12px)'},t)}
function clamp(v,a,b){return Math.max(a,Math.min(b,v))}
function xpToLevel(xp){return clamp(Math.floor(xp/XP_PER_LEVEL)+1,1,MAX_LEVEL)}
function addXP(a){if(state.xp>=MAX_LEVEL*XP_PER_LEVEL)return;const p=xpToLevel(state.xp);state.xp=clamp(state.xp+a,0,MAX_LEVEL*XP_PER_LEVEL);const n=xpToLevel(state.xp);if(n>p){notify(`üéâ Level Up ‚Äî ${n}`,3000);launchConfetti()}saveState()}
function saveState(){localStorage.setItem(STORAGE,JSON.stringify(state));renderAll()}
function loadState(){try{const s=JSON.parse(localStorage.getItem(STORAGE));if(s)state=Object.assign(state,s)}catch(e){}}

/* ====== Data ====== */
/* –≤–∞—à–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞–º–∫–∏ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ, 2 ‚Äî VIP) */
const FRAMES=[
  {id:'f1', title:'LoL Ice Frame', price:350, vipOnly:false, url:'https://wallpapers.com/images/hd/leagueof-legends-ice-themed-icon-lbz9rlqcojud9fo5.png'},
  {id:'f2', title:'LoL Icon Frame', price:420, vipOnly:false, url:'https://i2.wp.com/www.seekpng.com/png/full/155-1551417_league-of-legends-icon-png.png'},
  {id:'f3', title:'Imgur Neon Frame', price:380, vipOnly:false, url:'https://i.imgur.com/V7HiEOp.png'},
  {id:'f4', title:'Design VIP Gold', price:0, vipOnly:true, url:'https://en.idei.club/uploads/posts/2023-06/1687020123_en-idei-club-p-border-avatar-dizain-krasivo-3.png'},
  {id:'f5', title:'Design VIP Royal', price:0, vipOnly:true, url:'https://en.idei.club/uploads/posts/2023-06/1687020123_en-idei-club-p-border-avatar-dizain-krasivo-3.png'}
];
// –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–µ–∫
for(let i=6;i<=16;i++){FRAMES.push({id:'f'+i,title:'Frame #'+i,price:120+(i*17)%500,vipOnly:(i%9===0),url:`https://picsum.photos/seed/frame${i}/256/256`})}

const GLOWS=[
  {id:'g1',title:'üî• Fire',price:500,cls:'glow-fire'},
  {id:'g2',title:'üíß Water',price:500,cls:'glow-water'},
  {id:'g3',title:'üåà Rainbow',price:1000,cls:'glow-rainbow'},
  {id:'g4',title:'‚≠ê Soft Glow',price:200,cls:'glow-basic'}
];
for(let i=5;i<=14;i++){GLOWS.push({id:'g'+i,title:`Glow FX ${i}`,price:100+(i*37)%800,cls:(i%2?'glow-basic':'glow-rainbow')})}

const COIN_PACKS=[
  {id:'c1',coins:100,price:99},
  {id:'c2',coins:250,price:199},
  {id:'c3',coins:500,price:349},
  {id:'c4',coins:1000,price:599},
  {id:'c5',coins:2500,price:1299},
  {id:'c6',coins:5000,price:2399}
];

const SHOP_ITEMS=[];
for(let i=1;i<=24;i++){SHOP_ITEMS.push({id:'it'+i,title:`Charm #${i}`,price:25+(i*7)%400,vipOnly:(i%7===0),desc:`Cosmetic ${i}`})}

const GAMES=['Apex Legends','Fortnite','Minecraft','CS:GO','Rust','GTA V','Valorant','Overwatch','LoL','Dota2'];
const LOADERS=[];
GAMES.forEach((g,idx)=>{LOADERS.push({id:`free-${idx}`,name:`${g} ‚Äî Free Loader`,game:g,type:'free'});LOADERS.push({id:`pro-${idx}`,name:`${g} ‚Äî Pro Loader`,game:g,type:'pro',price:129+idx*30});LOADERS.push({id:`vip-${idx}`,name:`${g} ‚Äî VIP Loader`,game:g,type:'vip'})});

/* ====== render ====== */
function renderAll(){
  $('statCoins').textContent=`${state.coins} üí∞`;
  $('statTickets').textContent=`üéü ${state.tickets}`;
  $('ticketCount').textContent=state.tickets;
  $('statLevel').textContent=`Lvl ${xpToLevel(state.xp)}`;
  $('displayName').textContent=state.nick;
  $('avatarImg').src=state.avatar;
  $('uiCoins').textContent=state.coins;
  $('uiTickets').textContent=state.tickets;
  $('uiLevel').textContent=xpToLevel(state.xp);
  const cur=state.xp%XP_PER_LEVEL;$('uiXPbar').style.width=(cur/XP_PER_LEVEL*100)+'%';$('uiXPtext').textContent=`${cur} / ${XP_PER_LEVEL} XP`;

  // VIP badge
  const vb=$('vipBadge');vb.innerHTML='';
  if(state.vip){const d=document.createElement('div');d.className='vip-badge';d.textContent=state.vipLevel==='lifetime'?'VIP ¬∑ Forever':'VIP';vb.appendChild(d)}else{vb.innerHTML='<div class="hint">–ù–µ—Ç VIP</div>'}

  // owned list
  const ol=$('ownedList');ol.innerHTML='';
  state.ownedFrames.forEach(fid=>{const f=FRAMES.find(x=>x.id===fid);if(!f)return;const el=document.createElement('div');el.className='card';el.style.padding='8px';el.innerHTML=`<div style="font-weight:800">${escapeHtml(f.title)}</div><div class="hint">${f.vipOnly?'VIP only':f.price+' –º–æ–Ω–µ—Ç'}</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyFrame('${f.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;ol.appendChild(el)});
  state.ownedGlows.forEach(gid=>{const g=GLOWS.find(x=>x.id===gid);if(!g)return;const el=document.createElement('div');el.className='card';el.style.padding='8px';el.innerHTML=`<div style="font-weight:800">${escapeHtml(g.title)}</div><div class="hint">${g.price} –º–æ–Ω–µ—Ç</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyGlow('${g.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;ol.appendChild(el)});

  renderApplied();
  renderChat();

  if(!window._renderedOnce){
    renderCoinPacks();renderFramesGrid();renderGlowsGrid();renderShopItems();renderLoaders();populateFilters();buildWheel();listPrizes();
    window._renderedOnce=true;
  }
  localStorage.setItem(STORAGE,JSON.stringify(state));
}

/* frames / glows / items / coin packs */
function renderCoinPacks(){
  const parent=$('coinPacks');parent.innerHTML='';
  COIN_PACKS.forEach(p=>{
    const el=document.createElement('div');el.className='card';
    el.innerHTML=`<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div class="hint">${p.price} ‚ÇΩ</div>`;
    const b=document.createElement('button');b.className='btn primary';b.textContent='–ö—É–ø–∏—Ç—å';
    b.onclick=()=>{state.coins+=p.coins;addXP(Math.round(p.coins/5));notify(`–ö—É–ø–ª–µ–Ω–æ ${p.coins} –º–æ–Ω–µ—Ç (+${Math.round(p.coins/5)} XP)`);saveState()};
    el.appendChild(b);parent.appendChild(el);
  });
}
function renderFramesGrid(){
  const parent=$('framesGrid');parent.innerHTML='';
  FRAMES.forEach(f=>{
    const el=document.createElement('div');el.className='card';
    el.innerHTML=`<div style="height:110px;display:flex;align-items:center;justify-content:center"><img src="${f.url}" onerror="this.style.opacity=0.5" style="max-width:100%;max-height:100%;border-radius:8px"/></div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(f.title)}</div>
      <div class="hint">${f.vipOnly?'VIP only':f.price+' –º–æ–Ω–µ—Ç'}</div>`;
    el.addEventListener('click',()=>{
      if(f.vipOnly && !state.vip){notify('–†–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP');goTo('vip');return}
      if(!state.ownedFrames.includes(f.id)){
        if(!f.vipOnly){
          if(state.coins<f.price){notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');return}
          state.coins-=f.price;state.ownedFrames.push(f.id);addXP(Math.round(f.price/2));notify('–†–∞–º–∫–∞ –∫—É–ø–ª–µ–Ω–∞: '+f.title);saveState();
        }else{state.ownedFrames.push(f.id);notify('–†–∞–º–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ (VIP)');saveState()}
      }else{state.applied={type:'frame',id:f.id};notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: '+f.title);saveState()}
    });
    if(state.ownedFrames.includes(f.id)){const tag=document.createElement('div');tag.className='hint';tag.style.marginTop='6px';tag.textContent='–ö—É–ø–ª–µ–Ω–æ';el.appendChild(tag)}
    parent.appendChild(el);
  });
}
function renderGlowsGrid(){
  const parent=$('glowsGrid');parent.innerHTML='';
  GLOWS.forEach(g=>{
    const el=document.createElement('div');el.className='card';
    el.innerHTML=`<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(g.title)}</div>
      <div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>`;
    el.addEventListener('click',()=>{
      if(!state.ownedGlows.includes(g.id)){
        if(state.coins<g.price){notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');return}
        state.coins-=g.price;state.ownedGlows.push(g.id);addXP(Math.round(g.price/3));notify('–ö—É–ø–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ: '+g.title);saveState();
      }else{state.applied={type:'glow',id:g.id};notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: '+g.title);saveState()}
    });
    if(state.ownedGlows.includes(g.id)){const tag=document.createElement('div');tag.className='hint';tag.style.marginTop='6px';tag.textContent='–ö—É–ø–ª–µ–Ω–æ';el.appendChild(tag)}
    parent.appendChild(el);
  });
}
function renderShopItems(){
  const parent=$('itemsGrid');parent.innerHTML='';
  SHOP_ITEMS.forEach(it=>{
    const el=document.createElement('div');el.className='card';
    el.innerHTML=`<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(it.title)}</div>
      <div class="hint">${escapeHtml(it.desc)}</div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center"><div style="flex:1;color:var(--muted)">${it.price} –º–æ–Ω–µ—Ç ${it.vipOnly?'(VIP)':''}</div></div>`;
    const btn=document.createElement('button');btn.className='btn primary';btn.textContent=it.vipOnly?'VIP':'–ö—É–ø–∏—Ç—å';
    btn.onclick=()=>{if(it.vipOnly && !state.vip){notify('–¢—Ä–µ–±—É–µ—Ç—Å—è VIP');goTo('vip');return}
      if(state.coins<it.price){notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');return}
      state.coins-=it.price;addXP(Math.round(it.price/2));state.ownedItems=state.ownedItems||[];state.ownedItems.push(it.id);notify('–ö—É–ø–ª–µ–Ω–æ: '+it.title);saveState()};
    el.querySelector('div').appendChild(btn);parent.appendChild(el);
  });
}

/* loaders */
function renderLoaders(){
  const parent=$('loadersGrid');parent.innerHTML='';
  const ft=$('filterType').value, fg=$('filterGame').value;
  LOADERS.filter(l=>(ft==='all'||l.type===ft)&&(fg==='all'||!fg||l.game===fg)).forEach(l=>{
    const el=document.createElement('div');el.className='card';
    el.innerHTML=`<div class="hint">${escapeHtml(l.game)}</div><div style="font-weight:900;margin-top:6px">${escapeHtml(l.name)}</div><div class="hint" style="margin-top:8px">${l.type==='free'?'–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π':l.type==='pro'?'–ü–ª–∞—Ç–Ω—ã–π '+l.price+'‚ÇΩ':'–¢–æ–ª—å–∫–æ VIP'}</div>`;
    const ctrl=document.createElement('div');ctrl.style.marginTop='10px';
    if(l.type==='free'){const b=document.createElement('button');b.className='btn primary';b.textContent='–°–∫–∞—á–∞—Ç—å';b.onclick=()=>{addXP(50);notify('–°–∫–∞—á–∞–Ω–æ (–¥–µ–º–æ) +50 XP');saveState()};ctrl.appendChild(b)}
    else if(l.type==='pro'){const b=document.createElement('button');b.className='btn primary';b.textContent=`–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`;b.onclick=()=>{addXP(300);notify('–ö—É–ø–ª–µ–Ω Pro (–¥–µ–º–æ) +300 XP');saveState()};ctrl.appendChild(b)}
    else{const b=document.createElement('button');b.className='btn primary';b.textContent='–¢–æ–ª—å–∫–æ VIP';b.onclick=()=>{if(state.vip){addXP(100);notify('VIP –∑–∞–≥—Ä—É–∑–∫–∞ +100 XP');saveState()}else{notify('–ù—É–∂–µ–Ω VIP');goTo('vip')}};ctrl.appendChild(b)}
    el.appendChild(ctrl);parent.appendChild(el);
  });
}
function populateFilters(){
  const sel=$('filterGame');sel.innerHTML='<option value="all">–í—Å–µ –∏–≥—Ä—ã</option>';GAMES.forEach(g=>{const o=document.createElement('option');o.value=g;o.textContent=g;sel.appendChild(o)});
  $('filterType').value='all';$('filterGame').value='all';$('filterType').addEventListener('change',renderLoaders);$('filterGame').addEventListener('change',renderLoaders);
}

/* applied visuals */
function clearOverlays(){document.querySelectorAll('.frame-overlay,.glow-class').forEach(e=>e.remove());$('avatarWrap').classList.remove(...GLOWS.map(g=>g.cls))}
function renderApplied(){
  clearOverlays();
  const wrap=$('avatarWrap');
  if(state.applied && state.applied.type==='frame'){
    const f=FRAMES.find(x=>x.id===state.applied.id);if(f){const img=document.createElement('img');img.className='frame-overlay';img.src=f.url;img.onerror=()=>img.style.opacity=.5;wrap.appendChild(img)}
  }else if(state.applied && state.applied.type==='glow'){
    const g=GLOWS.find(x=>x.id===state.applied.id);if(g){const div=document.createElement('div');div.className='glow-class '+g.cls;wrap.appendChild(div)}
  }
}
function applyFrame(fid){if(!state.ownedFrames.includes(fid)){notify('–ù–µ—Ç —ç—Ç–æ–π —Ä–∞–º–∫–∏');return}state.applied={type:'frame',id:fid};saveState();notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞')}
function applyGlow(gid){if(!state.ownedGlows.includes(gid)){notify('–ù–µ—Ç —ç—Ç–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è');return}state.applied={type:'glow',id:gid};saveState();notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ')}
function unequipAll(){state.applied={type:null,id:null};saveState();notify('–£–∫—Ä–∞—à–µ–Ω–∏—è —Å–Ω—è—Ç—ã')}

/* VIP */
function buyVIP(level,price,ticketsBonus){
  state.vip=true;state.vipLevel=level;addXP(5*XP_PER_LEVEL);
  if(level==='month'){state.coins+=300}
  else if(level==='year'){state.coins+=1000}
  else if(level==='lifetime'){state.coins+=2500}
  state.tickets+=ticketsBonus||0;
  notify(`VIP –æ—Ñ–æ—Ä–º–ª–µ–Ω ‚Äî +5 —É—Ä–æ–≤–Ω–µ–π, +–±–æ–Ω—É—Å –º–æ–Ω–µ—Ç –∏ üéü +${ticketsBonus||0} –±–∏–ª–µ—Ç–æ–≤`);
  saveState();
}

/* ====== –ö–æ–ª–µ—Å–æ: –ª–æ–≥–∏–∫–∞ ====== */
const PRIZES=[
  {label:'+100 –º–æ–Ω–µ—Ç', type:'coins', value:100, color:'#7c4dff'},
  {label:'+250 XP', type:'xp', value:250, color:'#00d4ff'},
  {label:'+300 –º–æ–Ω–µ—Ç', type:'coins', value:300, color:'#21d07a'},
  {label:'üéü +1 –±–∏–ª–µ—Ç', type:'ticket', value:1, color:'#ffaa00'},
  {label:'–†–∞–º–∫–∞ (—Å–ª—É—á.)', type:'frame', value:'random', color:'#ff4d6d'},
  {label:'+500 –º–æ–Ω–µ—Ç', type:'coins', value:500, color:'#2dd4bf'},
  {label:'–°–≤–µ—á–µ–Ω–∏–µ (—Å–ª—É—á.)', type:'glow', value:'random', color:'#60a5fa'},
  {label:'+700 XP', type:'xp', value:700, color:'#f59e0b'}
];
function buildWheel(){
  const wheel=$('wheel');wheel.innerHTML='';
  const n=PRIZES.length;
  for(let i=0;i<n;i++){
    const deg=360/n*i;
    const slice=document.createElement('div');slice.className='slice';
    slice.style.transform=`translate(-0%, -100%) rotate(${deg}deg)`;
    slice.style.background=PRIZES[i].color;
    const label=document.createElement('div');
    label.style.position='absolute';label.style.left='50%';label.style.top='50%';
    label.style.transform='translate(-10px,-90px) rotate(90deg)';label.style.transformOrigin='left top';
    label.style.fontWeight='800';label.style.fontSize='12px';label.style.textShadow='0 1px 2px rgba(0,0,0,.6)';
    label.textContent=PRIZES[i].label;
    slice.appendChild(label);wheel.appendChild(slice);
  }
}
function listPrizes(){
  const ul=$('prizeList');ul.innerHTML='';
  PRIZES.forEach(p=>{const li=document.createElement('li');li.textContent=p.label;ul.appendChild(li)});
}
let spinning=false;
function spinWheel(){
  if(spinning)return;
  // —Å–ø–∏—Å–∞–Ω–∏–µ –±–∏–ª–µ—Ç–∞ / –ø–æ–∫—É–ø–∫–∞
  if(state.tickets>0){state.tickets--;saveState()}
  else{
    // –¥–µ–º–æ-–ø–æ–∫—É–ø–∫–∞ ¬´–∑–∞ 499 ‚ÇΩ¬ª
    if(!confirm('–ö—É–ø–∏—Ç—å –æ–¥–Ω–æ –≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞ 499 ‚ÇΩ? (–¥–µ–º–æ)'))return;
    // –¥–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ–º, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å XP
    addXP(50);
  }
  spinning=true;
  const wheel=$('wheel');
  const n=PRIZES.length;
  const targetIndex=Math.floor(Math.random()*n);
  const baseRot=360*5; // 5 –æ–±–æ—Ä–æ—Ç–æ–≤
  const sliceAngle=360/n;
  const targetAngle=baseRot + (360 - targetIndex*sliceAngle) - sliceAngle/2;
  wheel.style.transition='transform 4s cubic-bezier(.17,.67,.32,1.26)';
  wheel.style.transform=`rotate(${targetAngle}deg)`;
  setTimeout(()=>{spinning=false;applyPrize(PRIZES[targetIndex]);wheel.style.transition='none';wheel.style.transform=`rotate(${(360 - targetIndex*sliceAngle) - sliceAngle/2}deg)`},4200);
}
function applyPrize(p){
  let text='–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: '+p.label+'!';
  if(p.type==='coins'){state.coins+=p.value;addXP( Math.round(p.value/5) )}
  if(p.type==='xp'){addXP(p.value)}
  if(p.type==='ticket'){state.tickets+=p.value}
  if(p.type==='frame'){
    // —Å–ª—É—á–∞–π–Ω–∞—è –ù–ï VIP —Ä–∞–º–∫–∞
    const pool=FRAMES.filter(f=>!f.vipOnly);
    if(pool.length){const f=pool[Math.floor(Math.random()*pool.length)];if(!state.ownedFrames.includes(f.id))state.ownedFrames.push(f.id);text += ` (–ø–æ–ª—É—á–µ–Ω–∞ ${f.title})`}
  }
  if(p.type==='glow'){
    const g=GLOWS[Math.floor(Math.random()*GLOWS.length)];
    if(!state.ownedGlows.includes(g.id))state.ownedGlows.push(g.id);
    text += ` (–ø–æ–ª—É—á–µ–Ω–æ ${g.title})`;
  }
  notify(text,3000);saveState();
  const lp=$('lastPrize');lp.style.display='block';lp.innerHTML=`<b>${text}</b>`;
}

/* ====== Chat ====== */
function renderChat(){
  const out=$('chatMessages');out.innerHTML='';
  (state.chat||[]).slice(-500).forEach(m=>{
    const div=document.createElement('div');div.className='chat-msg';
    const t=new Date(m.t).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    div.innerHTML=`<div style="font-weight:700">${escapeHtml(m.nick)} <span style="font-weight:400;color:var(--muted);font-size:12px"> ${t}</span></div><div>${escapeHtml(m.msg)}</div>`;
    out.appendChild(div);
  });
  out.scrollTop=out.scrollHeight;
}
function sendChat(){const inp=$('chatInput');const txt=inp.value.trim();if(!txt)return;state.chat.push({nick:state.nick,msg:txt,t:Date.now()});saveState();inp.value='';renderChat()}
function clearChat(){state.chat=[];saveState();notify('–ß–∞—Ç –æ—á–∏—â–µ–Ω')}
function exportChat(){const blob=new Blob([JSON.stringify(state.chat,null,2)],{type:'application/json'});const u=URL.createObjectURL(blob);const a=document.createElement('a');a.href=u;a.download='chat_export.json';a.click();URL.revokeObjectURL(u)}

/* ====== Profile editor ====== */
$('editorAvatar')&&$('editorAvatar').addEventListener('change',e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{$('editorPreview').src=r.result};r.readAsDataURL(f)});
function openProfileEditor(){$('editorPreview').src=state.avatar;$('editorNick').value=state.nick;document.getElementById('profileModal').showModal()}
function saveProfileEdits(){const nv=$('editorNick').value.trim();if(nv)state.nick=nv;const preview=$('editorPreview').src;if(preview)state.avatar=preview;saveState();document.getElementById('profileModal').close();notify('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω')}

/* ====== Confetti ====== */
const confettiCanvas=$('confetti');const ctx=confettiCanvas.getContext?confettiCanvas.getContext('2d'):null;let confetti=[]
function resizeCanvas(){confettiCanvas.width=window.innerWidth;confettiCanvas.height=window.innerHeight}
window.addEventListener('resize',resizeCanvas);resizeCanvas();
function launchConfetti(){if(!ctx)return;for(let i=0;i<120;i++){confetti.push({x:Math.random()*confettiCanvas.width,y:-Math.random()*confettiCanvas.height,vx:(Math.random()-.5)*6,vy:2+Math.random()*6,s:4+Math.random()*8,c:['#ff4d4d','#ffd65b','#7c4dff','#00d4ff','#4dff88'][Math.floor(Math.random()*5)],r:Math.random()*360})}if(!window._confettiRunning){window._confettiRunning=true;requestAnimationFrame(confettiLoop)}}
function confettiLoop(){ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);confetti.forEach((p,i)=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.05;p.r+=p.vx;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r*Math.PI/180);ctx.fillStyle=p.c;ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);ctx.restore();if(p.y>confettiCanvas.height+50)confetti.splice(i,1)});if(confetti.length)requestAnimationFrame(confettiLoop);else window._confettiRunning=false}

/* ====== Misc ====== */
function escapeHtml(s){return (s+'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
function goTo(tab){const map={buy:'page-buy',vip:'page-vip',wheel:'page-wheel',shop:'page-shop',profile:'page-profile',chat:'page-chat'};document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('section[id^="page-"]').forEach(s=>s.style.display='none');document.getElementById('btn-'+tab).classList.add('active');document.getElementById(map[tab]).style.display='block'}
function awardDemoXP(){addXP(200);notify('+200 XP');saveState()}
function openFramesInShop(){goTo('shop');document.getElementById('framesGrid').scrollIntoView({behavior:'smooth'})}
function openGlowsInShop(){goTo('shop');document.getElementById('glowsGrid').scrollIntoView({behavior:'smooth'})}
function giftTicket(){state.tickets++;saveState();notify('üéü –ü–æ–ª—É—á–µ–Ω –±–∏–ª–µ—Ç (–¥–µ–º–æ)')}

/* ====== init ====== */
function bindUI(){
  document.getElementById('btn-buy').addEventListener('click',()=>goTo('buy'));
  document.getElementById('btn-vip').addEventListener('click',()=>goTo('vip'));
  document.getElementById('btn-wheel').addEventListener('click',()=>goTo('wheel'));
  document.getElementById('btn-shop').addEventListener('click',()=>goTo('shop'));
  document.getElementById('btn-profile').addEventListener('click',()=>goTo('profile'));
  document.getElementById('btn-chat').addEventListener('click',()=>goTo('chat'));
  $('chatSend').addEventListener('click',sendChat);
  $('chatInput').addEventListener('keydown',e=>{if(e.key==='Enter')sendChat()});
  $('authBtn').addEventListener('click',()=>notify('DEMO: –í–æ–π–¥–µ–Ω—ã –∫–∞–∫ –≥–æ—Å—Ç—å'));
  window.addEventListener('beforeunload',()=>saveState());
}
loadState();bindUI();renderAll();notify('–ó–∞–≥—Ä—É–∂–µ–Ω–æ: GameLoaders Mega Hub ‚Äî –¥–µ–º–æ',2500);
</script>
</body>
</html>
