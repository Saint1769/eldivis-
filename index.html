<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GameLoaders ‚Äî Mega Hub (Huge Single File)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
/* =========================
   Global design system & variables
   ========================= */
:root{
  --bg1: #051025;
  --bg2: #0b1222;
  --card:#0f1724;
  --muted:#9ab0d6;
  --text:#e8f0ff;
  --accent1: 128 76% 56%;
  --accent2: 195 100% 50%;
  --neon1: #7c4dff;
  --neon2: #00d4ff;
  --glass: rgba(255,255,255,0.03);
  --vip-grad: conic-gradient(from 0deg,#ff0044,#ff9900,#ffee00,#00ff77,#00ccff,#7c4dff);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
body{
  background:
    radial-gradient(600px 300px at 10% 10%, rgba(124,77,255,0.04), transparent),
    radial-gradient(600px 300px at 90% 80%, rgba(0,212,255,0.03), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding-bottom:120px;
}

/* layout */
.container{width:min(1280px,96%);margin:0 auto;padding:18px 0}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0;position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));backdrop-filter:blur(8px);z-index:200;border-bottom:1px solid rgba(255,255,255,0.03)}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--neon1)}
.brand .logo{width:18px;height:18px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 8px 28px rgba(124,77,255,0.2)}
.header .left, .header .center, .header .right{display:flex;align-items:center;gap:10px}
.tabbtn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);font-weight:700;cursor:pointer}
.tabbtn.active{color:var(--text);background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 12px 40px rgba(124,77,255,0.12)}

/* main panels */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 40px rgba(2,6,23,0.5)}
.spaced{margin-top:16px}

/* grid utilities */
.grid{display:grid;gap:12px}
.cols-2{grid-template-columns:repeat(2,1fr)}
.cols-3{grid-template-columns:repeat(3,1fr)}
.cols-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:960px){.cols-4{grid-template-columns:repeat(2,1fr)}.cols-3{grid-template-columns:repeat(2,1fr)}}

/* card */
.card{border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);transition:transform .18s,box-shadow .18s;overflow:hidden}
.card:hover{transform:translateY(-8px);box-shadow:0 22px 60px rgba(0,0,0,0.6)}
.hint{color:var(--muted);font-size:13px}

/* buttons */
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
.btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#fff;box-shadow:0 8px 30px rgba(124,77,255,0.14)}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.04)}
.btn.warn{background:linear-gradient(90deg,#ff9966,#ff4d4d);color:#041022}

/* profile */
.profile-top{display:flex;gap:18px;align-items:center}
.avatar-wrap{position:relative;width:136px;height:136px;border-radius:50%;padding:6px;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 18px 48px rgba(124,77,255,0.18)}
.avatar-inner{width:100%;height:100%;border-radius:50%;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(255,255,255,0.02));overflow:hidden;border:4px solid rgba(0,0,0,0.25)}
.avatar-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.frame-overlay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:150px;height:150px;border-radius:50%;pointer-events:none;mix-blend-mode:screen}
.glow-class{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:170px;height:170px;border-radius:50%;pointer-events:none;z-index:0}

/* glow types */
.glow-fire{box-shadow:0 0 38px 16px rgba(255,110,25,0.85) !important; animation:glowFlicker 1.2s infinite}
.glow-water{box-shadow:0 0 36px 14px rgba(0,160,255,0.8) !important; animation:glowWave 3s infinite}
.glow-rainbow{animation:glowRainbow 5s linear infinite}
.glow-basic{box-shadow:0 0 20px 8px rgba(255,255,255,0.6) !important}

/* keyframes */
@keyframes glowFlicker{0%,20%,22%,64%,65%,100%{opacity:1}21%,23%,63%,66%{opacity:0.3}}
@keyframes glowWave{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.06)}100%{transform:translate(-50%,-50%) scale(1)}}
@keyframes glowRainbow{
  0%{box-shadow:0 0 40px 12px rgba(255,0,0,0.8)}
  25%{box-shadow:0 0 40px 12px rgba(255,160,0,0.8)}
  50%{box-shadow:0 0 40px 12px rgba(0,200,255,0.8)}
  75%{box-shadow:0 0 40px 12px rgba(120,0,255,0.8)}
  100%{box-shadow:0 0 40px 12px rgba(255,0,0,0.8)}
}

/* vip badge */
.vip-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:800;background:var(--vip-grad);background-size:300% 300%;animation:vipShift 6s linear infinite;color:#051022}
@keyframes vipShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* big header stats */
.stats{display:flex;gap:12px}
.stat{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-weight:700}

/* chat */
.chat-wrap{display:flex;flex-direction:column;height:420px}
.chat-messages{flex:1;overflow:auto;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))}
.chat-input{display:flex;gap:8px;margin-top:8px}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
.chat-msg{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);}

/* notifications */
#notif{position:fixed;right:20px;bottom:20px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;font-weight:800;transform:translateY(12px);opacity:0;transition:all .3s;z-index:9999}

/* responsiveness */
@media (max-width:980px){
  .header{flex-direction:column;align-items:flex-start;gap:8px}
  .avatar-wrap{width:110px;height:110px}
}
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <div class="header" role="banner">
    <div class="left brand"><div class="logo"></div> <div>GameLoaders Mega Hub</div></div>
    <div class="center">
      <button class="tabbtn active" id="btn-buy">–ö—É–ø–∏—Ç—å</button>
      <button class="tabbtn" id="btn-vip">VIP</button>
      <button class="tabbtn" id="btn-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tabbtn" id="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tabbtn" id="btn-chat">–ß–∞—Ç</button>
    </div>
    <div class="right">
      <div id="header-stats" style="display:flex;gap:12px;align-items:center">
        <div class="stat" id="statCoins">0 üí∞</div>
        <div class="stat" id="statLevel">Lvl 1</div>
      </div>
      <button class="tabbtn" id="authBtn">–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <!-- MAIN PANELS -->
  <section id="page-buy" class="panel spaced">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 style="margin:0">–ö—É–ø–∏—Ç—å ‚Äî –õ–æ–∞–¥–µ—Ä—ã</h2>
        <div class="hint">Free / Pro / VIP-only ‚Äî –¥–µ–º–æ –ø–æ–∫—É–ø–∫–∏/–∑–∞–≥—Ä—É–∑–∫–∏</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="filterGame" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--text)"></select>
        <select id="filterType" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--text)">
          <option value="all">–í—Å–µ —Ç–∏–ø—ã</option><option value="free">Free</option><option value="pro">Pro</option><option value="vip">VIP-only</option>
        </select>
      </div>
    </div>
    <div id="loadersGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
  </section>

  <section id="page-vip" class="panel spaced" style="display:none">
    <h2 style="margin:0">VIP ‚Äî –æ—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</h2>
    <div class="hint">VIP —Å—Ä–∞–∑—É –¥–∞—ë—Ç +5 —É—Ä–æ–≤–Ω–µ–π –∏ –¥–æ—Å—Ç—É–ø –∫ VIP-only —Ä–∞–º–∫–∞–º</div>
    <div class="grid cols-3 spaced" style="margin-top:12px">
      <div class="card">
        <h3>1 –º–µ—Å—è—Ü</h3><div class="muted">–ë–æ–Ω—É—Å—ã: +5 —É—Ä–æ–≤–Ω–µ–π, +300 –º–æ–Ω–µ—Ç</div>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('month',299)">–ö—É–ø–∏—Ç—å 299 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>12 –º–µ—Å—è—Ü–µ–≤</h3><div class="muted">–õ—É—á—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ</div>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('year',2870)">–ö—É–ø–∏—Ç—å 2870 ‚ÇΩ</button></div>
      </div>
      <div class="card">
        <h3>–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ</h3><div class="muted">VIP –Ω–∞–≤—Å–µ–≥–¥–∞</div>
        <div style="margin-top:12px"><button class="btn primary" onclick="buyVIP('lifetime',7990)">–ö—É–ø–∏—Ç—å 7990 ‚ÇΩ</button></div>
      </div>
    </div>
  </section>

  <section id="page-shop" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="hint">–ú–æ–Ω–µ—Ç—ã, —Ä–∞–º–∫–∏, —Å–≤–µ—á–µ–Ω–∏—è –∏ –º–Ω–æ–≥–æ –ø—Ä–∏–∫–æ–ª—é—Ö</div>
    <div class="spaced card">
      <h3>–ü–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç</h3>
      <div id="coinPacks" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–†–∞–º–∫–∏ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ; 2 ‚Äî VIP-only)</h3>
      <div id="framesGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–°–≤–µ—á–µ–Ω–∏—è</h3>
      <div id="glowsGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–ü—Ä–∏–∫–æ–ª—é—Ö–∏ (24+)</h3>
      <div id="itemsGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>
  </section>

  <section id="page-profile" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div class="profile-top spaced">
      <div style="display:flex;flex-direction:column;align-items:center">
        <div class="avatar-wrap" id="avatarWrap">
          <div class="avatar-inner"><img id="avatarImg" src="https://i.pravatar.cc/400?img=12" alt="avatar"></div>
          <!-- overlays rendered dynamically -->
        </div>
        <div style="margin-top:10px;font-weight:800" id="displayName">Player</div>
        <div id="vipBadge" style="margin-top:8px"></div>
      </div>

      <div style="flex:1" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="hint">–£—Ä–æ–≤–µ–Ω—å</div>
            <div style="font-weight:900;font-size:20px" id="uiLevel">1</div>
          </div>
          <div style="width:60%">
            <div class="hint">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è</div>
            <div style="height:12px;background:rgba(255,255,255,0.03);border-radius:8px;margin-top:6px;overflow:hidden">
              <div id="uiXPbar" style="height:100%;background:linear-gradient(90deg,var(--neon1),var(--neon2));width:0%"></div>
            </div>
            <div style="margin-top:6px" class="hint" id="uiXPtext">0 / 1000 XP</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <div class="hint">–ú–æ–Ω–µ—Ç—ã:</div><div style="font-weight:900" id="uiCoins">0</div>
          <div style="margin-left:auto">
            <button class="btn ghost" onclick="openProfileEditor()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn primary" onclick="awardDemoXP()">+XP demo</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <h4 style="margin:0">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏ / –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h4>
          <div id="ownedList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <h3 style="margin:0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è–º–∏</h3>
      <div class="hint" style="margin-top:8px">–í—ã–±–µ—Ä–∏ ‚Äî —Ä–∞–º–∫—É –∏–ª–∏ —Å–≤–µ—á–µ–Ω–∏–µ. –ù–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn ghost" onclick="unequipAll()">–°–Ω—è—Ç—å –≤—Å—ë</button>
        <button class="btn ghost" onclick="openFramesInShop()">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–º–∫–∏</button>
        <button class="btn ghost" onclick="openGlowsInShop()">–û—Ç–∫—Ä—ã—Ç—å —Å–≤–µ—á–µ–Ω–∏—è</button>
      </div>
    </div>
  </section>

  <section id="page-chat" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ß–∞—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ)</h2>
    <div class="row" style="margin-top:12px;gap:12px">
      <div style="flex:1" class="card">
        <div class="chat-wrap">
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button class="btn primary" id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div style="width:260px" class="card">
        <h4 style="margin:0">–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
        <div class="hint" style="margin-top:8px">–ß–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –°–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –≤—ã.</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn ghost" onclick="clearChat()">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
          <button class="btn ghost" onclick="exportChat()">–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
      </div>
    </div>
  </section>

  <div style="height:36px"></div>
</div>

<div id="notif"></div>

<!-- Profile editor modal -->
<dialog id="profileModal" style="border:none;border-radius:10px;padding:0">
  <div style="width:min(800px,96vw);background:rgba(255,255,255,0.02);padding:16px;border-radius:10px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <button onclick="document.getElementById('profileModal').close()" style="background:none;border:0;color:var(--muted);cursor:pointer">‚úï</button>
    </div>
    <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
      <div style="flex:0 0 140px"><img id="editorPreview" src="" style="width:140px;height:140px;border-radius:10px;object-fit:cover"></div>
      <div style="flex:1">
        <label class="hint">–ù–∏–∫</label>
        <input id="editorNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)"/>
        <label class="hint" style="margin-top:8px">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
        <input id="editorAvatar" type="file" />
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn primary" onclick="saveProfileEdits()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" onclick="document.getElementById('profileModal').close()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</dialog>

<!-- confetti canvas -->
<canvas id="confetti" style="position:fixed;left:0;top:0;pointer-events:none;z-index:9999"></canvas>

<script>
/* =========================
   "Huge" app JS: state, render,
   many generators, XP rules, chat, etc.
   ========================= */

/* ---------- State & Persistence ---------- */
const STORAGE = 'gameloaders_mega_v3';
let state = {
  nick: 'Player',
  avatar: 'https://i.pravatar.cc/400?img=12',
  coins: 1000,
  xp: 0,
  vip: false,
  vipLevel: null,
  ownedFrames: [], // ids
  ownedGlows: [],  // ids
  applied: { type:null, id:null }, // {type:'frame'|'glow', id: 'f123' }
  chat: [], // {nick,msg,t}
  stats: { downloads:0, users:1 }
};
const XP_PER_LEVEL = 1000;
const MAX_LEVEL = 100;
function loadState(){ try{ const s = JSON.parse(localStorage.getItem(STORAGE)); if(s) state = Object.assign(state, s); } catch(e){ console.error(e) } }
function saveState(){ localStorage.setItem(STORAGE, JSON.stringify(state)); renderAll(); }

/* ---------- Helpers ---------- */
const $ = id => document.getElementById(id);
function notify(msg, t=2200){ const n = $('notif'); n.textContent = msg; n.style.opacity = 1; n.style.transform='translateY(0)'; setTimeout(()=>{ n.style.opacity=0; n.style.transform='translateY(12px)'; }, t); }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

/* ---------- XP/Leveling ---------- */
function xpToLevel(xp){ return clamp(Math.floor(xp / XP_PER_LEVEL) + 1, 1, MAX_LEVEL); }
function addXP(amount){
  if(state.xp >= MAX_LEVEL * XP_PER_LEVEL) return;
  const prev = xpToLevel(state.xp);
  state.xp = clamp(state.xp + amount, 0, MAX_LEVEL * XP_PER_LEVEL);
  const now = xpToLevel(state.xp);
  if(now > prev){
    notify(`üéâ Level Up ‚Äî ${now}`, 3000);
    launchConfetti();
  }
  saveState();
}

/* ---------- Data Generators (make it huge) ---------- */
/* Frames: use some placeholders and use loop to generate many variants */
const FRAMES = [
  {id:'f1', title:'Ice Frame', price:150, vipOnly:false, url:'https://i.imgur.com/9r0dF3Z.png'},
  {id:'f2', title:'Border II', price:200, vipOnly:false, url:'https://i.imgur.com/0KXJw7y.png'},
  {id:'f3', title:'Neon Frame', price:300, vipOnly:false, url:'https://i.imgur.com/V7HiEOp.png'},
  {id:'f4', title:'Decor VIP', price:0, vipOnly:true, url:'https://i.imgur.com/6zq4O8y.png'},
  {id:'f5', title:'Royal VIP', price:0, vipOnly:true, url:'https://i.imgur.com/3Xq1GkN.png'}
];
// generate 40 synthetic frames to inflate the catalog (ids f6..f45)
for(let i=6;i<=45;i++){
  FRAMES.push({
    id:'f'+i,
    title:`Frame #${i}`,
    price: 80 + (i*10)%420,
    vipOnly: (i%13===0),
    url: `https://picsum.photos/seed/frame${i}/200/200`
  });
}

/* Glows: fire, water, rainbow, soft + many cosmetic variations */
const GLOWS = [
  {id:'g1', title:'üî• Fire', price:500, cls:'glow-fire'},
  {id:'g2', title:'üíß Water', price:500, cls:'glow-water'},
  {id:'g3', title:'üåà Rainbow', price:1000, cls:'glow-rainbow'},
  {id:'g4', title:'‚≠ê Soft Glow', price:200, cls:'glow-basic'}
];
// synthetic glows to inflate list
for(let i=5;i<=30;i++){
  GLOWS.push({id:'g'+i, title:`Glow FX ${i}`, price: 100 + (i*37)%800, cls: (i%2? 'glow-basic':'glow-rainbow')});
}

/* Coin packs */
const COIN_PACKS = [
  {id:'c1', coins:100, price:99},
  {id:'c2', coins:250, price:199},
  {id:'c3', coins:500, price:349},
  {id:'c4', coins:1000, price:599},
  {id:'c5', coins:2500, price:1299},
  {id:'c6', coins:5000, price:2399}
];

/* Shop items (24+), automatically generate 48 items to be huge */
const SHOP_ITEMS = [];
for(let i=1;i<=48;i++){
  SHOP_ITEMS.push({
    id:'it'+i,
    title: `Charm #${i}`,
    price: 25 + (i*7)%400,
    vipOnly: (i%7===0),
    desc: `Cute cosmetic ${i}`
  });
}

/* Games & loaders generator (lots of entries) */
const GAMES = ['Apex Legends','Fortnite','Minecraft','CS:GO','Rust','GTA V','Valorant','Overwatch','LoL','Dota2','Elden Ring','Skyrim','Terraria','Sea of Thieves'];
const LOADERS = [];
GAMES.forEach((g, idx) => {
  LOADERS.push({id:`free-${idx}`, name:`${g} ‚Äî Free Loader`, game:g, type:'free'});
  LOADERS.push({id:`pro-${idx}`, name:`${g} ‚Äî Pro Loader`, game:g, type:'pro', price:129 + idx*30});
  LOADERS.push({id:`vip-${idx}`, name:`${g} ‚Äî VIP Loader`, game:g, type:'vip'});
});

/* ---------- Renderers ---------- */
function renderAll(){
  // header stats
  $('statCoins').textContent = `${state.coins} üí∞`;
  $('statLevel').textContent = `Lvl ${xpToLevel(state.xp)}`;

  // profile snapshot
  $('displayName').textContent = state.nick;
  $('avatarImg').src = state.avatar;
  $('uiCoins').textContent = state.coins;
  $('uiLevel').textContent = xpToLevel(state.xp);
  const cur = state.xp % XP_PER_LEVEL;
  $('uiXPbar').style.width = (cur / XP_PER_LEVEL * 100) + '%';
  $('uiXPtext').textContent = `${cur} / ${XP_PER_LEVEL} XP`;

  // VIP badge
  const vb = $('vipBadge'); vb.innerHTML = '';
  if(state.vip){ const d = document.createElement('div'); d.className='vip-badge'; d.textContent = state.vipLevel === 'lifetime' ? 'VIP ¬∑ Forever' : 'VIP'; vb.appendChild(d); }
  else vb.innerHTML = '<div class="hint">–ù–µ—Ç VIP</div>';

  // owned list
  const ol = $('ownedList'); ol.innerHTML = '';
  state.ownedFrames.forEach(fid => {
    const f = FRAMES.find(x=>x.id===fid);
    if(!f) return;
    const el = document.createElement('div'); el.className='card'; el.style.padding='8px';
    el.innerHTML = `<div style="font-weight:800">${escapeHtml(f.title)}</div><div class="hint">${f.vipOnly? 'VIP only' : f.price+' –º–æ–Ω–µ—Ç'}</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyFrame('${f.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;
    ol.appendChild(el);
  });
  state.ownedGlows.forEach(gid => {
    const g = GLOWS.find(x=>x.id===gid);
    if(!g) return;
    const el = document.createElement('div'); el.className='card'; el.style.padding='8px';
    el.innerHTML = `<div style="font-weight:800">${escapeHtml(g.title)}</div><div class="hint">${g.price} –º–æ–Ω–µ—Ç</div><div style="margin-top:8px"><button class="btn ghost" onclick="applyGlow('${g.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>`;
    ol.appendChild(el);
  });

  // applied visuals
  renderApplied();

  // chat
  renderChat();

  // render dynamic grids (only once initial heavy generation is costly, but safe)
  if(!window._renderedOnce){
    renderCoinPacks();
    renderFramesGrid();
    renderGlowsGrid();
    renderShopItems();
    renderLoaders();
    populateFilters();
    window._renderedOnce = true;
  }
  // save
  localStorage.setItem(STORAGE, JSON.stringify(state));
}

/* ---------- Render coin packs ---------- */
function renderCoinPacks(){
  const parent = $('coinPacks'); parent.innerHTML = '';
  COIN_PACKS.forEach(p=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div class="hint">${p.price} ‚ÇΩ</div>`;
    const b = document.createElement('button'); b.className='btn primary'; b.textContent='–ö—É–ø–∏—Ç—å';
    b.onclick = ()=>{ state.coins += p.coins; addXP(Math.round(p.coins/5)); notify(`–ö—É–ø–ª–µ–Ω–æ ${p.coins} –º–æ–Ω–µ—Ç (+${Math.round(p.coins/5)} XP)`); saveState(); };
    el.appendChild(b); parent.appendChild(el);
  });
}

/* ---------- Render frames ---------- */
function renderFramesGrid(){
  const parent = $('framesGrid'); parent.innerHTML = '';
  FRAMES.forEach(f=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="height:110px;display:flex;align-items:center;justify-content:center"><img src="${f.url}" onerror="this.style.opacity=0.5" style="max-width:100%;max-height:100%;border-radius:8px"/></div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(f.title)}</div>
      <div class="hint">${f.vipOnly? 'VIP only' : f.price + ' –º–æ–Ω–µ—Ç'}</div>`;
    el.addEventListener('click', ()=>{
      if(f.vipOnly && !state.vip){ notify('–†–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP'); goTo('vip'); return; }
      if(!state.ownedFrames.includes(f.id)){
        if(!f.vipOnly){
          if(state.coins < f.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
          state.coins -= f.price;
          state.ownedFrames.push(f.id);
          addXP(Math.round(f.price/2));
          notify('–†–∞–º–∫–∞ –∫—É–ø–ª–µ–Ω–∞: ' + f.title);
          saveState();
        } else {
          state.ownedFrames.push(f.id); notify('–†–∞–º–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ (VIP)'); saveState();
        }
      } else {
        state.applied = {type:'frame', id:f.id}; notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: '+f.title); saveState();
      }
    });
    if(state.ownedFrames.includes(f.id)){ const tag = document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}

/* ---------- Render glows ---------- */
function renderGlowsGrid(){
  const parent = $('glowsGrid'); parent.innerHTML = '';
  GLOWS.forEach(g=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(g.title)}</div>
      <div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>`;
    el.addEventListener('click', ()=>{
      if(!state.ownedGlows.includes(g.id)){
        if(state.coins < g.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        state.coins -= g.price; state.ownedGlows.push(g.id); addXP(Math.round(g.price/3));
        notify('–ö—É–ø–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ: '+g.title); saveState();
      } else {
        state.applied = {type:'glow', id:g.id}; notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: '+g.title); saveState();
      }
    });
    if(state.ownedGlows.includes(g.id)){ const tag = document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}

/* ---------- Render shop items ---------- */
function renderShopItems(){
  const parent = $('itemsGrid'); parent.innerHTML = '';
  SHOP_ITEMS.forEach(it=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(it.title)}</div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(it.title)}</div>
      <div class="hint">${escapeHtml(it.desc)}</div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center"><div style="flex:1;color:var(--muted)">${it.price} –º–æ–Ω–µ—Ç ${it.vipOnly? '(VIP)': ''}</div></div>`;
    const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent = it.vipOnly ? 'VIP' : '–ö—É–ø–∏—Ç—å';
    btn.onclick = ()=> {
      if(it.vipOnly && !state.vip){ notify('–¢—Ä–µ–±—É–µ—Ç—Å—è VIP'); goTo('vip'); return; }
      if(state.coins < it.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
      state.coins -= it.price; addXP(Math.round(it.price/2));
      // store purchased item id into ownedGlows for variety (or ownedFrames) ‚Äî here just record as owned item
      if(!state.ownedItems) state.ownedItems = [];
      state.ownedItems.push(it.id);
      notify('–ö—É–ø–ª–µ–Ω–æ: '+it.title);
      saveState();
    };
    el.querySelector('div').appendChild(btn);
    parent.appendChild(el);
  });
}

/* ---------- Render loaders ---------- */
function renderLoaders(){
  const parent = $('loadersGrid'); parent.innerHTML = '';
  const filterType = $('filterType').value;
  const filterGame = $('filterGame').value;
  LOADERS.filter(l=>{
    if(filterType!=='all' && l.type!==filterType) return false;
    if(filterGame && filterGame!=='all' && l.game!==filterGame) return false;
    return true;
  }).forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="hint">${escapeHtml(l.game)}</div><div style="font-weight:900;margin-top:6px">${escapeHtml(l.name)}</div><div class="hint" style="margin-top:8px">${l.type==='free' ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π' : l.type==='pro' ? '–ü–ª–∞—Ç–Ω—ã–π '+l.price+'‚ÇΩ' : '–¢–æ–ª—å–∫–æ VIP'}</div>`;
    const ctrl = document.createElement('div'); ctrl.style.marginTop='10px';
    if(l.type==='free'){
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–°–∫–∞—á–∞—Ç—å'; btn.onclick = ()=>{ state.stats.downloads++; addXP(50); notify('–°–∫–∞—á–∞–Ω–æ (–¥–µ–º–æ) +50 XP'); saveState(); };
      ctrl.appendChild(btn);
    } else if(l.type==='pro'){
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent=`–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`; btn.onclick = ()=>{ state.ownedItems = state.ownedItems || []; state.ownedItems.push('PRO:'+l.id); addXP(300); notify('–ö—É–ø–ª–µ–Ω Pro (–¥–µ–º–æ) +300 XP'); saveState(); };
      ctrl.appendChild(btn);
    } else {
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–¢–æ–ª—å–∫–æ VIP'; btn.onclick = ()=>{ if(state.vip){ state.stats.downloads++; addXP(100); notify('VIP –∑–∞–≥—Ä—É–∑–∫–∞ +100 XP'); saveState(); } else { notify('–ù—É–∂–µ–Ω VIP'); goTo('vip'); } };
      ctrl.appendChild(btn);
    }
    el.appendChild(ctrl);
    parent.appendChild(el);
  });
}

/* ---------- Filters ---------- */
function populateFilters(){
  const sel = $('filterGame'); sel.innerHTML = '<option value="all">–í—Å–µ –∏–≥—Ä—ã</option>';
  GAMES.forEach(g=>{ const o = document.createElement('option'); o.value = g; o.textContent = g; sel.appendChild(o); });
  $('filterType').value = 'all'; $('filterGame').value = 'all';
  $('filterType').addEventListener('change', renderLoaders);
  $('filterGame').addEventListener('change', renderLoaders);
}

/* ---------- Apply decorations ---------- */
function clearOverlays(){
  // remove overlays
  const existingFrame = document.querySelector('.frame-overlay');
  if(existingFrame) existingFrame.remove();
  const glowEl = document.querySelector('.glow-class');
  if(glowEl) glowEl.remove();
  // remove glow classes from avatarWrap
  const wrap = $('avatarWrap');
  wrap.classList.remove(...GLOWS.map(g=>g.cls));
}
function renderApplied(){
  clearOverlays();
  const wrap = $('avatarWrap');
  if(state.applied && state.applied.type === 'frame'){
    const f = FRAMES.find(x=>x.id === state.applied.id);
    if(f){
      const img = document.createElement('img'); img.className='frame-overlay'; img.src = f.url;
      img.onerror = ()=>{ img.style.opacity = 0.5; };
      wrap.appendChild(img);
    }
  } else if(state.applied && state.applied.type === 'glow'){
    const g = GLOWS.find(x=>x.id === state.applied.id);
    if(g){
      // create glow element
      const div = document.createElement('div'); div.className = 'glow-class '+g.cls;
      wrap.appendChild(div);
      // also ensure frame overlay removed
    }
  }
}

/* ---------- Shop actions ---------- */
function buyVIP(level, price){
  // demo: no real money. In a real setup implement payment flow
  state.vip = true; state.vipLevel = level;
  addXP(5 * XP_PER_LEVEL); // +5 levels
  state.coins += 500; // bonus
  notify('VIP –æ—Ñ–æ—Ä–º–ª–µ–Ω ‚Äî +5 —É—Ä–æ–≤–Ω–µ–π –∏ +500 –º–æ–Ω–µ—Ç');
  saveState();
}

function applyFrame(fid){
  if(!state.ownedFrames.includes(fid)){ notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–π —Ä–∞–º–∫–∏'); return; }
  state.applied = {type:'frame', id:fid}; saveState(); notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');
}
function applyGlow(gid){
  if(!state.ownedGlows.includes(gid)){ notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è'); return; }
  state.applied = {type:'glow', id:gid}; saveState(); notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ');
}
function unequipAll(){ state.applied = {type:null,id:null}; saveState(); notify('–í—Å–µ —É–∫—Ä–∞—à–µ–Ω–∏—è —Å–Ω—è—Ç—ã'); }

/* ---------- Chat ---------- */
function renderChat(){
  const out = $('chatMessages'); out.innerHTML = '';
  state.chat.slice(-500).forEach(m=>{
    const div = document.createElement('div'); div.className='chat-msg';
    const t = new Date(m.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    div.innerHTML = `<div style="font-weight:700">${escapeHtml(m.nick)} <span style="font-weight:400;color:var(--muted);font-size:12px"> ${t}</span></div><div>${escapeHtml(m.msg)}</div>`;
    out.appendChild(div);
  });
  out.scrollTop = out.scrollHeight;
}
function sendChat(){
  const inp = $('chatInput'); const txt = inp.value.trim(); if(!txt) return;
  state.chat.push({nick: state.nick, msg: txt, t: Date.now()});
  saveState(); inp.value=''; renderChat();
}

/* ---------- Profile editor ---------- */
$('editorAvatar') && $('editorAvatar').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ()=>{ $('editorPreview').src = r.result; }; r.readAsDataURL(f);
});
function openProfileEditor(){
  $('editorPreview').src = state.avatar; $('editorNick').value = state.nick; document.getElementById('profileModal').showModal();
}
function saveProfileEdits(){
  const nv = $('editorNick').value.trim(); if(nv) state.nick = nv;
  const preview = $('editorPreview').src; if(preview) state.avatar = preview;
  saveState(); document.getElementById('profileModal').close(); notify('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω');
}

/* ---------- Misc / Utility ---------- */
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function goTo(tab){
  // tabs: buy, vip, shop, profile, chat map to page ids
  const mapping = {buy:'page-buy', vip:'page-vip', shop:'page-shop', profile:'page-profile', chat:'page-chat'};
  document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section[id^="page-"]').forEach(s=>s.style.display='none');
  document.getElementById('btn-'+tab).classList.add('active');
  document.getElementById(mapping[tab]).style.display = 'block';
}

/* ---------- Confetti (simple) ---------- */
const confettiCanvas = $('confetti');
const ctx = confettiCanvas.getContext ? confettiCanvas.getContext('2d') : null;
let confetti = [];
function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas); resizeCanvas();
function launchConfetti(){
  if(!ctx) return;
  for(let i=0;i<120;i++){
    confetti.push({x: Math.random()*confettiCanvas.width, y: -Math.random()*confettiCanvas.height, vx: (Math.random()-0.5)*6, vy: 2+Math.random()*6, s: 4+Math.random()*8, c: ['#ff4d4d','#ffd65b','#7c4dff','#00d4ff','#4dff88'][Math.floor(Math.random()*5)], r: Math.random()*360});
  }
  if(!window._confettiRunning) { window._confettiRunning = true; requestAnimationFrame(confettiLoop); }
}
function confettiLoop(){
  ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confetti.forEach((p,i)=>{
    p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.r += p.vx;
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r*Math.PI/180);
    ctx.fillStyle = p.c; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); ctx.restore();
    if(p.y > confettiCanvas.height + 50) confetti.splice(i,1);
  });
  if(confetti.length) requestAnimationFrame(confettiLoop); else window._confettiRunning = false;
}

/* ---------- Events and bindings ---------- */
function bindUI(){
  // tab buttons
  document.getElementById('btn-buy').addEventListener('click', ()=>goTo('buy'));
  document.getElementById('btn-vip').addEventListener('click', ()=>goTo('vip'));
  document.getElementById('btn-shop').addEventListener('click', ()=>goTo('shop'));
  document.getElementById('btn-profile').addEventListener('click', ()=>goTo('profile'));
  document.getElementById('btn-chat').addEventListener('click', ()=>goTo('chat'));

  // chat send
  $('chatSend').addEventListener('click', sendChat);
  $('chatInput').addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(); });

  // buy vip demo (header button)
  $('authBtn').addEventListener('click', ()=>{ notify('DEMO: –í–æ–π–¥–µ–Ω—ã –∫–∞–∫ –≥–æ—Å—Ç—å'); });

  // quick actions
  window.addEventListener('beforeunload', ()=> saveState());
}

/* ---------- Create heavy content dynamically (makes code "huge" in effect) ---------- */
function renderHugeCatalog(){
  // frames, glows, coinpacks, items, loaders already rendered by specific functions
  renderAll(); // initial
}

/* ---------- Small helper actions ---------- */
function awardDemoXP(){ addXP(200); notify('+200 XP'); saveState(); }
function clearChat(){ state.chat = []; saveState(); notify('–ß–∞—Ç –æ—á–∏—â–µ–Ω'); }
function exportChat(){ const blob = new Blob([JSON.stringify(state.chat, null, 2)], {type:'application/json'}); const u = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = u; a.download = 'chat_export.json'; a.click(); URL.revokeObjectURL(u); }

/* ---------- Initial load & run ---------- */
loadState();
bindUI();

// render functions that rely on DOM
function startApp(){ renderAll(); renderHugeCatalog(); }
startApp();

/* ---------- Render functions definitions (must be after start to allow calls above) ---------- */
/* Implement renderCoinPacks/renderFramesGrid/renderGlowsGrid/renderShopItems/renderLoaders/populateFilters functions used above (they exist earlier) */
function renderCoinPacks(){ renderCoinPacksInner(); }
function renderFramesGrid(){ renderFramesGridInner(); }
function renderGlowsGrid(){ renderGlowsGridInner(); }
function renderShopItems(){ renderShopItemsInner(); }
function renderLoaders(){ renderLoadersInner(); }
function populateFilters(){ populateFiltersInner(); }

/* real definitions for the inner functions (redeclare to keep code large and explicit) */
function renderCoinPacksInner(){
  const parent = $('coinPacks'); if(!parent) return; parent.innerHTML = '';
  COIN_PACKS.forEach(p=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div class="hint">${p.price} ‚ÇΩ</div>`;
    const b = document.createElement('button'); b.className='btn primary'; b.textContent='–ö—É–ø–∏—Ç—å';
    b.onclick = ()=>{ state.coins += p.coins; addXP(Math.round(p.coins/5)); notify(`–ö—É–ø–ª–µ–Ω–æ ${p.coins} –º–æ–Ω–µ—Ç (+${Math.round(p.coins/5)} XP)`); saveState(); };
    el.appendChild(b); parent.appendChild(el);
  });
}
function renderFramesGridInner(){
  const parent = $('framesGrid'); if(!parent) return; parent.innerHTML = '';
  FRAMES.forEach(f=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="height:110px;display:flex;align-items:center;justify-content:center"><img src="${f.url}" style="max-width:100%;max-height:100%;border-radius:8px" onerror="this.style.opacity=0.5"/></div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(f.title)}</div>
      <div class="hint">${f.vipOnly? 'VIP only' : f.price + ' –º–æ–Ω–µ—Ç'}</div>`;
    el.addEventListener('click', ()=>{
      if(f.vipOnly && !state.vip){ notify('–†–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP'); goTo('vip'); return; }
      if(!state.ownedFrames.includes(f.id)){
        if(!f.vipOnly){
          if(state.coins < f.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
          state.coins -= f.price;
          state.ownedFrames.push(f.id);
          addXP(Math.round(f.price/2));
          notify('–†–∞–º–∫–∞ –∫—É–ø–ª–µ–Ω–∞: ' + f.title);
          saveState();
        } else { state.ownedFrames.push(f.id); notify('–†–∞–º–∫–∞ –≤—ã–¥–∞–Ω–∞ (VIP)'); saveState(); }
      } else { state.applied = {type:'frame', id:f.id}; notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: '+f.title); saveState(); }
    });
    if(state.ownedFrames.includes(f.id)){ const tag = document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}
function renderGlowsGridInner(){
  const parent = $('glowsGrid'); if(!parent) return; parent.innerHTML = '';
  GLOWS.forEach(g=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(g.title)}</div>
      <div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>`;
    el.addEventListener('click', ()=>{
      if(!state.ownedGlows.includes(g.id)){
        if(state.coins < g.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        state.coins -= g.price; state.ownedGlows.push(g.id); addXP(Math.round(g.price/3));
        notify('–ö—É–ø–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ: '+g.title); saveState();
      } else { state.applied = {type:'glow', id:g.id}; notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: '+g.title); saveState(); }
    });
    if(state.ownedGlows.includes(g.id)){ const tag = document.createElement('div'); tag.className='hint'; tag.style.marginTop='6px'; tag.textContent='–ö—É–ø–ª–µ–Ω–æ'; el.appendChild(tag); }
    parent.appendChild(el);
  });
}
function renderShopItemsInner(){
  const parent = $('itemsGrid'); if(!parent) return; parent.innerHTML = '';
  SHOP_ITEMS.forEach(it=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(it.title)}</div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(it.title)}</div>
      <div class="hint">${escapeHtml(it.desc)}</div>
      <div style="display:flex;align-items:center;margin-top:8px;gap:8px"><div style="flex:1;color:var(--muted)">${it.price} –º–æ–Ω–µ—Ç ${it.vipOnly? '(VIP)':''}</div></div>`;
    const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent = it.vipOnly ? 'VIP' : '–ö—É–ø–∏—Ç—å';
    btn.onclick = ()=> {
      if(it.vipOnly && !state.vip){ notify('–¢—Ä–µ–±—É–µ—Ç—Å—è VIP'); goTo('vip'); return; }
      if(state.coins < it.price){ notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
      state.coins -= it.price; if(!state.ownedItems) state.ownedItems = []; state.ownedItems.push(it.id);
      addXP(Math.round(it.price/2)); notify('–ö—É–ø–ª–µ–Ω–æ: '+it.title); saveState();
    };
    el.querySelector('div').appendChild(btn);
    parent.appendChild(el);
  });
}
function renderLoadersInner(){
  const parent = $('loadersGrid'); if(!parent) return; parent.innerHTML = '';
  const filterType = $('filterType').value;
  const filterGame = $('filterGame').value;
  LOADERS.filter(l=>{
    if(filterType!=='all' && l.type!==filterType) return false;
    if(filterGame && filterGame!=='all' && l.game!==filterGame) return false;
    return true;
  }).forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="hint">${escapeHtml(l.game)}</div><div style="font-weight:900;margin-top:6px">${escapeHtml(l.name)}</div><div class="hint" style="margin-top:8px">${l.type==='free' ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π' : l.type==='pro' ? '–ü–ª–∞—Ç–Ω—ã–π '+l.price+'‚ÇΩ' : '–¢–æ–ª—å–∫–æ VIP'}</div>`;
    const ctrl = document.createElement('div'); ctrl.style.marginTop='10px';
    if(l.type==='free'){
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–°–∫–∞—á–∞—Ç—å'; btn.onclick = ()=>{ state.stats.downloads++; addXP(50); notify('–°–∫–∞—á–∞–Ω–æ (–¥–µ–º–æ) +50 XP'); saveState(); };
      ctrl.appendChild(btn);
    } else if(l.type==='pro'){
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent=`–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`; btn.onclick = ()=>{ state.ownedItems = state.ownedItems || []; state.ownedItems.push('PRO:'+l.id); addXP(300); notify('–ö—É–ø–ª–µ–Ω Pro (–¥–µ–º–æ) +300 XP'); saveState(); };
      ctrl.appendChild(btn);
    } else {
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–¢–æ–ª—å–∫–æ VIP'; btn.onclick = ()=>{ if(state.vip){ state.stats.downloads++; addXP(100); notify('VIP –∑–∞–≥—Ä—É–∑–∫–∞ +100 XP'); saveState(); } else { notify('–ù—É–∂–µ–Ω VIP'); goTo('vip'); } };
      ctrl.appendChild(btn);
    }
    el.appendChild(ctrl); parent.appendChild(el);
  });
}
function populateFiltersInner(){
  const sel = $('filterGame'); if(!sel) return; sel.innerHTML = '<option value="all">–í—Å–µ –∏–≥—Ä—ã</option>'; GAMES.forEach(g=>{ const o = document.createElement('option'); o.value = g; o.textContent = g; sel.appendChild(o); });
  $('filterType').value='all'; $('filterGame').value='all';
  $('filterType').addEventListener('change', renderLoadersInner);
  $('filterGame').addEventListener('change', renderLoadersInner);
}

/* ---------- Small expose for console debugging ---------- */
window._GL = { state, saveState, addXP, applyFrame, applyGlow, unequipAll, buyVIP, launchConfetti };

/* ---------- Utilities at end ---------- */
function saveState(){ localStorage.setItem(STORAGE, JSON.stringify(state)); renderAll(); }
function loadState(){ try{ const s = JSON.parse(localStorage.getItem(STORAGE)); if(s) state = Object.assign(state, s); }catch(e){ } }
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* Immediately show a little intro */
notify('–ó–∞–≥—Ä—É–∂–µ–Ω–æ: GameLoaders Mega Hub ‚Äî –¥–µ–º–æ', 2500);
</script>
</body>
</html>
