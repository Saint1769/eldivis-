<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GameLoaders ‚Äî Mega Hub (Premium Edition)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
/* =========================================================
   Core theme
   ========================================================= */
:root{
  --bg1:#051025; --bg2:#0b1222; --card:#0f1724;
  --muted:#9ab0d6; --text:#e8f0ff;
  --neon1:#7c4dff; --neon2:#00d4ff;
  --glass:rgba(255,255,255,0.03);
  --vip-grad: conic-gradient(from 0deg,#ff0044,#ff9900,#ffee00,#00ff77,#00ccff,#7c4dff);
  --bronze: linear-gradient(135deg, #cd7f32, #8c5320, #cd7f32);
  --silver: linear-gradient(135deg, #c0c0c0, #a8a8a8, #c0c0c0);
  --gold: linear-gradient(135deg, #ffd700, #daa520, #ffd700);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
body{
  background:
    radial-gradient(600px 300px at 10% 10%, rgba(124,77,255,0.04), transparent),
    radial-gradient(600px 300px at 90% 80%, rgba(0,212,255,0.03), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  padding-bottom:140px;
}

/* Container & header */
.container{width:min(1280px,96%);margin:0 auto;padding:18px 0}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0;position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.00));backdrop-filter:blur(8px);z-index:300;border-bottom:1px solid rgba(255,255,255,0.06)}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--neon1)}
.brand .logo{width:18px;height:18px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 8px 28px rgba(124,77,255,0.2)}
.header .left,.header .center,.header .right{display:flex;align-items:center;gap:10px}
.tabbtn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);font-weight:800;cursor:pointer}
.tabbtn.active{color:var(--text);background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 12px 40px rgba(124,77,255,0.18)}

/* Sections */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.06);box-shadow:0 12px 40px rgba(2,6,23,0.5)}
.spaced{margin-top:16px}
.grid{display:grid;gap:12px}
.cols-2{grid-template-columns:repeat(2,1fr)}
.cols-3{grid-template-columns:repeat(3,1fr)}
.cols-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:960px){.cols-4{grid-template-columns:repeat(2,1fr)}.cols-3{grid-template-columns:repeat(2,1fr)}}

/* Cards & buttons */
.card{border-radius:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.06);transition:transform .18s,box-shadow .18s;overflow:hidden}
.card:hover{transform:translateY(-6px);box-shadow:0 22px 60px rgba(0,0,0,0.55)}
.hint{color:var(--muted);font-size:13px}
.btn{padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:900}
.btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;box-shadow:0 10px 30px rgba(124,77,255,0.22)}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.09)}
.btn.warn{background:linear-gradient(90deg,#ff9966,#ff4d4d);color:#041022}

/* Profile & avatar */
.profile-top{display:flex;gap:18px;align-items:center;position:relative}
.profile-snow-canvas{position:absolute;inset:0;pointer-events:none;z-index:0;border-radius:12px}
.avatar-zone{position:relative;z-index:1}
.avatar-wrap{position:relative;width:136px;height:136px;border-radius:50%;padding:0;background:transparent;box-shadow:none}
.avatar-inner{width:100%;height:100%;border-radius:50%;overflow:hidden;border:none}
.avatar-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%}

/* Frame overlay ‚Äî 100% —è—Ä–∫–æ—Å—Ç–∏, —Ä–æ–≤–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ */
.frame-overlay{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:148px;height:148px;border-radius:50%;pointer-events:none;filter:none !important;mix-blend-mode:normal !important;opacity:1 !important;
}

/* Glow overlay */
.glow-class{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:170px;height:170px;border-radius:50%;pointer-events:none;z-index:0}

/* Glow types */
.glow-fire{box-shadow:0 0 38px 16px rgba(255,110,25,0.9)!important;animation:glowFlicker 1.2s infinite}
.glow-water{box-shadow:0 0 36px 14px rgba(0,160,255,0.9)!important;animation:glowWave 3s infinite}
.glow-rainbow{animation:glowRainbow 5s linear infinite}
.glow-basic{box-shadow:0 0 24px 10px rgba(255,255,255,0.85)!important}
@keyframes glowFlicker{0%,20%,22%,64%,65%,100%{opacity:1}21%,23%,63%,66%{opacity:.35}}
@keyframes glowWave{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.06)}100%{transform:translate(-50%,-50%) scale(1)}}
@keyframes glowRainbow{
  0%{box-shadow:0 0 40px 12px rgba(255,0,0,0.9)}
  25%{box-shadow:0 0 40px 12px rgba(255,160,0,0.9)}
  50%{box-shadow:0 0 40px 12px rgba(0,200,255,0.9)}
  75%{box-shadow:0 0 40px 12px rgba(120,0,255,0.9)}
  100%{box-shadow:0 0 40px 12px rgba(255,0,0,0.9)}
}

/* VIP badge */
.vip-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:900;background:var(--vip-grad);background-size:300% 300%;animation:vipShift 6s linear infinite;color:#051022}
@keyframes vipShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* Chat */
.chat-wrap{display:flex;flex-direction:column;height:420px}
.chat-messages{flex:1;overflow:auto;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00))}
.chat-input{display:flex;gap:8px;margin-top:8px}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.09);background:transparent;color:var(--text)}
.chat-msg{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.04);}

/* Notifications */
#notif{position:fixed;right:20px;bottom:20px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;font-weight:900;transform:translateY(12px);opacity:0;transition:all .3s;z-index:9999}

/* Wheel styles */
#wheelWrapper{position:relative;display:flex;align-items:center;gap:18px;flex-wrap:wrap}
#wheel{border-radius:50%;box-shadow:0 0 25px #0ff, 0 0 50px #ff000044 inset;background:rgba(0,0,0,0.05)}
.garland{position:absolute;width:540px;height:540px;left:-20px;top:-20px;pointer-events:none}
.bulb{width:18px;height:18px;border-radius:50%;position:absolute;animation:blink 1.5s infinite alternate;box-shadow:0 0 12px currentColor}
@keyframes blink{from{opacity:.35}to{opacity:1}}

/* CryptoBot Modal */
#cryptoModal {border:none;border-radius:12px;padding:0;max-width:500px;width:90vw;background:var(--card)}
#cryptoModal::backdrop {background:rgba(0,0,0,0.7);backdrop-filter:blur(4px)}
.crypto-modal-content {padding:24px}
.crypto-amount {font-size:28px;font-weight:800;text-align:center;margin:16px 0;color:var(--neon2)}
.crypto-description {text-align:center;margin-bottom:24px;color:var(--muted)}
.crypto-qr-container {display:flex;justify-content:center;margin:20px 0}
.crypto-qr {width:220px;height:220px;border:3px solid var(--neon1);border-radius:12px;padding:12px;background:white}
.crypto-instructions {background:rgba(255,255,255,0.05);padding:16px;border-radius:8px;margin:20px 0;text-align:center}
.crypto-status {text-align:center;padding:30px 0}
.crypto-success {font-size:48px;margin-bottom:16px}
.loading-spinner {width:40px;height:40px;border:4px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:var(--neon1);animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin {to{transform:rotate(360deg)}}

@media (max-width:980px){
  .header{flex-direction:column;align-items:flex-start;gap:8px}
}

/* pointer */
.pointer{
  position:absolute;left:50%;top:-6px;transform:translateX(-50%);
  width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:24px solid #fff;filter:drop-shadow(0 4px 10px rgba(0,0,0,.5));
}

/* VIP Page Styles */
.vip-hero {
  text-align: center;
  padding: 30px 0;
  margin-bottom: 30px;
  background: linear-gradient(135deg, rgba(124, 77, 255, 0.1), rgba(0, 212, 255, 0.1));
  border-radius: 12px;
  position: relative;
  overflow: hidden;
}

.vip-title {
  font-size: 48px;
  font-weight: 900;
  margin: 0;
  background: linear-gradient(90deg, #ff0080, #ff8c00, #ffed00, #00ff80, #00ccff, #7c4dff);
  background-size: 400% 400%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rgbFlow 6s ease infinite;
  text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
}

@keyframes rgbFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.vip-subtitle {
  color: var(--muted);
  font-size: 18px;
  margin-top: 10px;
}

.vip-tiers {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 40px;
  flex-wrap: wrap;
}

.vip-tier {
  width: 300px;
  padding: 30px 20px;
  border-radius: 16px;
  text-align: center;
  position: relative;
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;
}

.vip-tier:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.vip-tier.bronze {
  background: var(--bronze);
  color: #3a2400;
}

.vip-tier.silver {
  background: var(--silver);
  color: #404040;
}

.vip-tier.gold {
  background: var(--gold);
  color: #5c4200;
}

.vip-tier-header {
  margin-bottom: 20px;
}

.vip-tier-name {
  font-size: 24px;
  font-weight: 800;
  margin: 0 0 10px 0;
}

.vip-tier-price {
  font-size: 32px;
  font-weight: 900;
  margin: 0;
}

.vip-tier-features {
  list-style: none;
  padding: 0;
  margin: 0 0 20px 0;
}

.vip-tier-features li {
  padding: 8px 0;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.vip-tier-button {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.3s;
}

.vip-tier.bronze .vip-tier-button {
  background: #8c5320;
  color: white;
}

.vip-tier.silver .vip-tier-button {
  background: #a8a8a8;
  color: #333;
}

.vip-tier.gold .vip-tier-button {
  background: #daa520;
  color: #333;
}

.vip-tier-button:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.vip-benefits {
  margin-top: 50px;
  padding: 30px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
}

.vip-benefits-title {
  text-align: center;
  font-size: 28px;
  margin-bottom: 30px;
  color: var(--neon2);
}

.vip-benefits-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}

.vip-benefit {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 10px;
  text-align: center;
}

.vip-benefit-icon {
  font-size: 40px;
  margin-bottom: 15px;
}

.vip-benefit-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 10px;
  color: var(--neon1);
}

.vip-benefit-desc {
  color: var(--muted);
  font-size: 14px;
}

/* Profile banner styles */
.profile-banner {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 180px;
  border-radius: 12px 12px 0 0;
  overflow: hidden;
  z-index: -1;
}

.profile-banner img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-content {
  margin-top: 120px;
  position: relative;
  z-index: 1;
}

/* Wheel result animation */
.wheel-result-animation {
  animation: wheelResultPulse 1s ease;
}

@keyframes wheelResultPulse {
  0% { transform: scale(0.9); opacity: 0; }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); opacity: 1; }
}
</style>
</head>
<body>

<div class="container" style="position:relative;z-index:1">
  <!-- HEADER -->
  <div class="header" role="banner">
    <div class="left brand"><div class="logo"></div> <div>GameLoaders Mega Hub</div></div>
    <div class="center">
      <button class="tabbtn active" id="btn-buy">–ö—É–ø–∏—Ç—å</button>
      <button class="tabbtn" id="btn-vip">VIP</button>
      <button class="tabbtn" id="btn-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tabbtn" id="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tabbtn" id="btn-chat">–ß–∞—Ç</button>
      <button class="tabbtn" id="btn-wheel">–ö–æ–ª–µ—Å–æ</button>
    </div>
    <div class="right">
      <div id="header-stats" style="display:flex;gap:12px;align-items:center">
        <div class="card" style="padding:6px 10px" id="statCoins">0 üí∞</div>
        <div class="card" style="padding:6px 10px" id="statLevel">Lvl 1</div>
        <div class="card" style="padding:6px 10px" id="statTickets">üéü 0</div>
      </div>
      <button class="tabbtn" id="authBtn">–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <!-- BUY -->
  <section id="page-buy" class="panel spaced">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 style="margin:0">–ö—É–ø–∏—Ç—å ‚Äî –õ–æ–∞–¥–µ—Ä—ã</h2>
        <div class="hint">Free / Pro / VIP-only ‚Äî –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ CryptoBot</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="filterGame" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.09);color:var(--text)"></select>
        <select id="filterType" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.09);color:var(--text)">
          <option value="all">–í—Å–µ —Ç–∏–ø—ã</option><option value="free">Free</option><option value="pro">Pro</option><option value="vip">VIP-only</option>
        </select>
      </div>
    </div>
    <div id="loadersGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
  </section>

  <!-- VIP -->
  <section id="page-vip" class="panel spaced" style="display:none">
    <div class="vip-hero">
      <h1 class="vip-title">VIP –ü–û–î–ü–ò–°–ö–ê</h1>
      <p class="vip-subtitle">–ü–æ–ª—É—á–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –∏ –±–æ–Ω—É—Å—ã</p>
    </div>

    <div class="vip-tiers">
      <div class="vip-tier bronze">
        <div class="vip-tier-header">
          <h3 class="vip-tier-name">BRONZE</h3>
          <p class="vip-tier-price">299 ‚ÇΩ</p>
          <p class="vip-tier-duration">–≤ –º–µ—Å—è—Ü</p>
        </div>
        <ul class="vip-tier-features">
          <li>+3 —É—Ä–æ–≤–Ω—è —Å—Ä–∞–∑—É</li>
          <li>+150 –º–æ–Ω–µ—Ç</li>
          <li>üéü 2 –±–∏–ª–µ—Ç–∞ –Ω–∞ –∫–æ–ª–µ—Å–æ</li>
          <li>–î–æ—Å—Ç—É–ø –∫ Bronze —Ä–∞–º–∫–∞–º</li>
          <li>–°–∫–∏–¥–∫–∞ 5% –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
        </ul>
        <button class="vip-tier-button" onclick="initiateCryptoPayment('vip_bronze', 299, 'Bronze VIP –Ω–∞ 1 –º–µ—Å—è—Ü')">–í—ã–±—Ä–∞—Ç—å</button>
      </div>

      <div class="vip-tier silver">
        <div class="vip-tier-header">
          <h3 class="vip-tier-name">SILVER</h3>
          <p class="vip-tier-price">699 ‚ÇΩ</p>
          <p class="vip-tier-duration">–≤ –º–µ—Å—è—Ü</p>
        </div>
        <ul class="vip-tier-features">
          <li>+5 —É—Ä–æ–≤–Ω–µ–π —Å—Ä–∞–∑—É</li>
          <li>+300 –º–æ–Ω–µ—Ç</li>
          <li>üéü 5 –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –∫–æ–ª–µ—Å–æ</li>
          <li>–î–æ—Å—Ç—É–ø –∫ Silver —Ä–∞–º–∫–∞–º</li>
          <li>–°–∫–∏–¥–∫–∞ 10% –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
          <li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</li>
        </ul>
        <button class="vip-tier-button" onclick="initiateCryptoPayment('vip_silver', 699, 'Silver VIP –Ω–∞ 1 –º–µ—Å—è—Ü')">–í—ã–±—Ä–∞—Ç—å</button>
      </div>

      <div class="vip-tier gold">
        <div class="vip-tier-header">
          <h3 class="vip-tier-name">GOLD</h3>
          <p class="vip-tier-price">1499 ‚ÇΩ</p>
          <p class="vip-tier-duration">–≤ –º–µ—Å—è—Ü</p>
        </div>
        <ul class="vip-tier-features">
          <li>+10 —É—Ä–æ–≤–Ω–µ–π —Å—Ä–∞–∑—É</li>
          <li>+700 –º–æ–Ω–µ—Ç</li>
          <li>üéü 10 –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –∫–æ–ª–µ—Å–æ</li>
          <li>–í—Å–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ä–∞–º–∫–∏</li>
          <li>–°–∫–∏–¥–∫–∞ 20% –≤ –º–∞–≥–∞–∑–∏–Ω–µ</li>
          <li>–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</li>
          <li>–†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤–∏–Ω–∫–∞–º</li>
        </ul>
        <button class="vip-tier-button" onclick="initiateCryptoPayment('vip_gold', 1499, 'Gold VIP –Ω–∞ 1 –º–µ—Å—è—Ü')">–í—ã–±—Ä–∞—Ç—å</button>
      </div>
    </div>

    <div class="vip-benefits">
      <h3 class="vip-benefits-title">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ VIP —Å—Ç–∞—Ç—É—Å–∞</h3>
      <div class="vip-benefits-grid">
        <div class="vip-benefit">
          <div class="vip-benefit-icon">üöÄ</div>
          <h4 class="vip-benefit-title">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</h4>
          <p class="vip-benefit-desc">–°–∫–∞—á–∏–≤–∞–π—Ç–µ —Ñ–∞–π–ª—ã –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é</p>
        </div>
        <div class="vip-benefit">
          <div class="vip-benefit-icon">üéÅ</div>
          <h4 class="vip-benefit-title">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</h4>
          <p class="vip-benefit-desc">–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –ª–æ–∞–¥–µ—Ä–∞–º –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º</p>
        </div>
        <div class="vip-benefit">
          <div class="vip-benefit-icon">üõ°Ô∏è</div>
          <h4 class="vip-benefit-title">–ó–∞—â–∏—Ç–∞ –∞–∫–∫–∞—É–Ω—Ç–∞</h4>
          <p class="vip-benefit-desc">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</p>
        </div>
        <div class="vip-benefit">
          <div class="vip-benefit-icon">üíé</div>
          <h4 class="vip-benefit-title">–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã</h4>
          <p class="vip-benefit-desc">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏, –±–æ–Ω—É—Å—ã –∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</p>
        </div>
      </div>
    </div>
  </section>

  <!-- SHOP -->
  <section id="page-shop" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="hint">–ú–æ–Ω–µ—Ç—ã, —Ä–∞–º–∫–∏, —Å–≤–µ—á–µ–Ω–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã.</div>

    <div class="spaced card">
      <h3>–ü–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç</h3>
      <div id="coinPacks" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–†–∞–º–∫–∏ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ; 2 ‚Äî VIP-only)</h3>
      <div id="framesGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–°–≤–µ—á–µ–Ω–∏—è</h3>
      <div id="glowsGrid" class="grid cols-4 spaced" style="margin-top:12px"></div>
    </div>

    <div class="spaced card">
      <h3>–≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <div id="effectsGrid" class="grid cols-3 spaced" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="page-profile" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ü—Ä–æ—Ñ–∏–ª—å</h2>

    <div class="profile-top spaced" id="profileTop">
      <div class="profile-banner">
        <img id="profileBanner" src="https://i.pinimg.com/originals/ff/2b/5c/ff2b5c1b42073e0f8f42292251cd0fcd.jpg" alt="Profile banner">
      </div>
      
      <div class="profile-content">
        <div class="avatar-zone">
          <div class="avatar-wrap" id="avatarWrap">
            <div class="avatar-inner"><img id="avatarImg" src="https://i.pravatar.cc/400?img=12" alt="avatar"></div>
          </div>
          <div style="margin-top:10px;font-weight:800" id="displayName">Player</div>
          <div id="vipBadge" style="margin-top:8px"></div>
        </div>

        <div style="flex:1" class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="hint">–£—Ä–æ–≤–µ–Ω—å</div>
              <div style="font-weight:900;font-size:20px" id="uiLevel">1</div>
            </div>
            <div style="width:60%">
              <div class="hint">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è</div>
              <div style="height:12px;background:rgba(255,255,255,0.08);border-radius:8px;margin-top:6px;overflow:hidden">
                <div id="uiXPbar" style="height:100%;background:linear-gradient(90deg,var(--neon1),var(--neon2));width:0%"></div>
              </div>
              <div style="margin-top:6px" class="hint" id="uiXPtext">0 / 1000 XP</div>
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <div class="hint">–ú–æ–Ω–µ—Ç—ã:</div><div style="font-weight:900" id="uiCoins">0</div>
            <div class="hint">üéü –ë–∏–ª–µ—Ç—ã:</div><div style="font-weight:900" id="uiTickets">0</div>
            <div style="margin-left:auto">
              <button class="btn ghost" onclick="openProfileEditor()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              <button class="btn ghost" onclick="changeBanner()">–°–º–µ–Ω–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4 style="margin:0">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏ / –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h4>
            <div id="ownedList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
          </div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <h3 style="margin:0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è–º–∏</h3>
      <div class="hint" style="margin-top:8px">–í—ã–±–µ—Ä–∏ ‚Äî —Ä–∞–º–∫—É –∏–ª–∏ —Å–≤–µ—á–µ–Ω–∏–µ. –ù–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</h4>
      <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
        <button class="btn ghost" onclick="unequipAll()">–°–Ω—è—Ç—å –≤—Å—ë</button>
        <button class="btn ghost" onclick="openFramesInShop()">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–º–∫–∏</button>
        <button class="btn ghost" onclick="openGlowsInShop()">–û—Ç–∫—Ä—ã—Ç—å —Å–≤–µ—á–µ–Ω–∏—è</button>
      </div>
    </div>
  </section>

  <!-- CHAT -->
  <section id="page-chat" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ß–∞—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ)</h2>
    <div class="row" style="margin-top:12px;gap:12px">
      <div style="flex:1" class="card">
        <div class="chat-wrap">
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button class="btn primary" id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div style="width:260px" class="card">
        <h4 style="margin:0">–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
        <div class="hint" style="margin-top:8px">–ß–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn ghost" onclick="clearChat()">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
          <button class="btn ghost" onclick="exportChat()">–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
      </div>
    </div>
  </section>

  <!-- WHEEL -->
  <section id="page-wheel" class="panel spaced" style="display:none">
    <h2 style="margin:0">–ö–æ–ª–µ—Å–æ –≤–µ–∑–µ–Ω–∏—è</h2>
    <div class="hint">–û–¥–Ω–æ –≤—Ä–∞—â–µ–Ω–∏–µ: 499 ‚ÇΩ (—á–µ—Ä–µ–∑ CryptoBot) –∏–ª–∏ 1 –±–∏–ª–µ—Ç.</div>

    <div id="wheelWrapper" class="spaced">
      <div style="position:relative">
        <canvas id="wheel" width="480" height="480"></canvas>
        <div class="pointer"></div>
        <div class="garland" id="garland"></div>
      </div>

      <div style="min-width:280px" class="card">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
          <div class="card" style="padding:6px 10px">üéü –ë–∏–ª–µ—Ç—ã: <b id="wheelTickets">0</b></div>
          <button class="btn primary" id="spinBtn">–í—Ä–∞—â–∞—Ç—å (1 –±–∏–ª–µ—Ç)</button>
          <button class="btn primary" onclick="initiateCryptoPayment('wheel_spin', 499, '–í—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–µ—Å–∞')">–ö—É–ø–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ (499 ‚ÇΩ)</button>
        </div>
        <div id="wheelResult" class="spaced"></div>
        <div class="spaced">
          <h4 style="margin:0">–ü—Ä–∏–∑—ã:</h4>
          <ul class="hint" style="margin:6px 0 0 18px">
            <li>+100 –º–æ–Ω–µ—Ç</li><li>+250 –º–æ–Ω–µ—Ç</li><li>+500 –º–æ–Ω–µ—Ç</li>
            <li>+700 XP</li><li>+1200 XP</li><li>üéü +1 –±–∏–ª–µ—Ç</li>
            <li>–£–∫—Ä–∞—à–µ–Ω–∏–µ: —Ä–∞–º–∫–∞ (—Å–ª—É—á.)</li><li>–£–∫—Ä–∞—à–µ–Ω–∏–µ: —Å–≤–µ—á–µ–Ω–∏–µ (—Å–ª—É—á.)</li>
            <li>VIP 1 –º–µ—Å—è—Ü</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <div style="height:40px"></div>
</div>

<div id="notif"></div>

<!-- CRYPTOBOT PAYMENT MODAL -->
<dialog id="cryptoModal">
  <div class="crypto-modal-content">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <h3 style="margin:0">–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ CryptoBot</h3>
      <button onclick="closeCryptoModal()" style="background:none;border:0;color:var(--muted);cursor:pointer;font-size:20px">‚úï</button>
    </div>
    
    <div id="cryptoPaymentInfo">
      <div class="crypto-amount" id="cryptoAmount">0 ‚ÇΩ</div>
      <div class="crypto-description" id="cryptoDescription">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</div>
      
      <div class="crypto-qr-container">
        <img id="cryptoQrCode" class="crypto-qr" src="" alt="QR –∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã">
      </div>
      
      <div style="text-align:center;margin-bottom:20px">
        <a id="cryptoPaymentLink" href="#" target="_blank" class="btn primary" style="display:inline-block;margin:10px;text-decoration:none">
          –û–ø–ª–∞—Ç–∏—Ç—å –≤ Telegram
        </a>
      </div>
      
      <div class="crypto-instructions">
        <p class="hint" style="margin:0">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
      </div>
      
      <div class="loading-spinner" id="cryptoLoading"></div>
      <div class="hint" style="text-align:center;margin-top:10px" id="cryptoStatus">–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã...</div>
    </div>
    
    <div id="cryptoPaymentStatus" style="display:none">
      <div class="crypto-status">
        <div class="crypto-success">‚úÖ</div>
        <h3 style="margin:10px 0;color:var(--neon2)">–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!</h3>
        <p class="hint">–¢–æ–≤–∞—Ä –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç</p>
        <button class="btn primary" onclick="closeCryptoModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
      </div>
    </div>
  </div>
</dialog>

<!-- PROFILE EDITOR -->
<dialog id="profileModal" style="border:none;border-radius:10px;padding:0">
  <div style="width:min(800px,96vw);background:rgba(255,255,255,0.03);padding:16px;border-radius:10px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <button onclick="document.getElementById('profileModal').close()" style="background:none;border:0;color:var(--muted);cursor:pointer">‚úï</button>
    </div>
    <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
      <div style="flex:0 0 140px"><img id="editorPreview" src="" style="width:140px;height:140px;border-radius:10px;object-fit:cover"></div>
      <div style="flex:1">
        <label class="hint">–ù–∏–∫</label>
        <input id="editorNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.09);background:transparent;color:var(--text)"/>
        <label class="hint" style="margin-top:8px">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
        <input id="editorAvatar" type="file" />
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn primary" onclick="saveProfileEdits()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" onclick="document.getElementById('profileModal').close()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</dialog>

<!-- Confetti -->
<canvas id="confetti" style="position:fixed;left:0;top:0;pointer-events:none;z-index:9999"></canvas>

<script>
/* =========================================================
   State & persistence
   ========================================================= */
const STORAGE = 'gameloaders_mega_crypto_v2';
const XP_PER_LEVEL = 1000, MAX_LEVEL = 100;

let state = {
  nick: 'Player',
  avatar: 'https://i.pravatar.cc/400?img=12',
  banner: 'https://i.pinimg.com/originals/ff/2b/5c/ff2b5c1b42073e0f8f42292251cd0fcd.jpg',
  coins: 100,
  xp: 0,
  vip: false,
  vipLevel: null,
  tickets: 0,
  ownedFrames: [],
  ownedGlows: [],
  ownedEffects: [],
  applied: {type: null, id: null},
  chat: [],
  stats: {downloads: 0, users: 1},
  userId: null,
  transactions: []
};

const BANNERS = [
  'https://i.pinimg.com/originals/ff/2b/5c/ff2b5c1b42073e0f8f42292251cd0fcd.jpg',
  'https://images.wallpaperscraft.com/image/single/starry_sky_space_open_space_129155_2560x1080.jpg',
  'https://wallpaperaccess.com/full/1268180.jpg',
  'https://wallpaperaccess.com/full/1369100.jpg'
];

function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE);
    if (saved) {
      const parsed = JSON.parse(saved);
      state = {...state, ...parsed};
      
      // Ensure userId exists
      if (!state.userId) {
        state.userId = 'user_' + Math.random().toString(36).substr(2, 9);
        saveState();
      }
    }
  } catch (e) {
    console.error('Error loading state:', e);
  }
}

function saveState() {
  try {
    localStorage.setItem(STORAGE, JSON.stringify(state));
  } catch (e) {
    console.error('Error saving state:', e);
  }
}

/* =========================================================
   CryptoBot Integration
   ========================================================= */
const CRYPTOBOT_API_TOKEN = 'YOUR_CRYPTOBOT_API_TOKEN'; // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –¢–û–ö–ï–ù
const CRYPTOBOT_API_URL = 'https://pay.crypt.bot/api';

let activePayment = null;
let paymentCheckInterval = null;

async function initiateCryptoPayment(productId, amount, description) {
  try {
    showCryptoModal(amount, description);
    
    // Create invoice
    const response = await fetch('https://api.cryptobot.pro/createInvoice', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        amount: amount,
        currency: 'RUB',
        description: description,
        user_id: state.userId,
        product_id: productId,
        return_url: window.location.href
      })
    });

    if (!response.ok) {
      throw new Error('Network error');
    }

    const data = await response.json();
    
    if (data.success) {
      const invoice = data.data;
      activePayment = {
        invoice_id: invoice.invoice_id,
        productId: productId,
        amount: amount,
        hash: invoice.hash
      };

      // Show QR code and payment link
      document.getElementById('cryptoQrCode').src = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(invoice.pay_url)}`;
      document.getElementById('cryptoPaymentLink').href = invoice.pay_url;

      // Start checking payment status
      startPaymentStatusCheck(invoice.invoice_id, invoice.hash);
      
    } else {
      throw new Error(data.error || 'Payment creation failed');
    }
  } catch (error) {
    console.error('CryptoBot error:', error);
    notify('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞: ' + error.message);
    closeCryptoModal();
  }
}

function startPaymentStatusCheck(invoiceId, hash) {
  paymentCheckInterval = setInterval(async () => {
    try {
      const response = await fetch(`https://api.cryptobot.pro/checkPayment?invoice_id=${invoiceId}&hash=${hash}`);
      const data = await response.json();
      
      if (data.success) {
        const status = data.data.status;
        
        if (status === 'paid') {
          clearInterval(paymentCheckInterval);
          processSuccessfulPayment(data.data);
        } else if (status === 'expired') {
          clearInterval(paymentCheckInterval);
          document.getElementById('cryptoStatus').textContent = '–í—Ä–µ–º—è –æ–ø–ª–∞—Ç—ã –∏—Å—Ç–µ–∫–ª–æ';
          setTimeout(closeCryptoModal, 2000);
        }
      }
    } catch (error) {
      console.error('Payment check error:', error);
    }
  }, 3000);
}

function processSuccessfulPayment(paymentData) {
  try {
    document.getElementById('cryptoLoading').style.display = 'none';
    document.getElementById('cryptoStatus').textContent = '–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!';
    
    setTimeout(() => {
      document.getElementById('cryptoPaymentInfo').style.display = 'none';
      document.getElementById('cryptoPaymentStatus').style.display = 'block';
      
      // Add transaction to history
      state.transactions.push({
        id: paymentData.invoice_id,
        productId: activePayment.productId,
        amount: activePayment.amount,
        date: new Date().toISOString(),
        status: 'completed'
      });
      
      // Process the purchase
      processPurchase(activePayment.productId, activePayment.amount);
      
      saveState();
      launchConfetti();
      
    }, 1000);
    
  } catch (error) {
    console.error('Payment processing error:', error);
    notify('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞');
  }
}

function processPurchase(productId, amount) {
  switch (productId) {
    case 'vip_bronze':
      buyVIP('bronze', amount, 2, 150, 3);
      break;
    case 'vip_silver':
      buyVIP('silver', amount, 5, 300, 5);
      break;
    case 'vip_gold':
      buyVIP('gold', amount, 10, 700, 10);
      break;
    case 'wheel_spin':
      spinWheelReal();
      break;
    default:
      if (productId.startsWith('coin_')) {
        const coins = parseInt(productId.split('_')[1]);
        state.coins += coins;
        addXP(Math.round(coins / 5));
        notify(`–ö—É–ø–ª–µ–Ω–æ ${coins} –º–æ–Ω–µ—Ç`);
      } else if (productId.startsWith('loader_')) {
        const loaderId = productId.replace('loader_', '');
        state.stats.downloads++;
        addXP(300);
        notify('Pro –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞');
      }
      break;
  }
}

function showCryptoModal(amount, description) {
  const modal = document.getElementById('cryptoModal');
  document.getElementById('cryptoAmount').textContent = amount + ' ‚ÇΩ';
  document.getElementById('cryptoDescription').textContent = description;
  document.getElementById('cryptoPaymentInfo').style.display = 'block';
  document.getElementById('cryptoPaymentStatus').style.display = 'none';
  document.getElementById('cryptoLoading').style.display = 'block';
  document.getElementById('cryptoStatus').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã...';
  modal.showModal();
}

function closeCryptoModal() {
  const modal = document.getElementById('cryptoModal');
  if (paymentCheckInterval) {
    clearInterval(paymentCheckInterval);
    paymentCheckInterval = null;
  }
  activePayment = null;
  modal.close();
  renderAll();
}

/* =========================================================
   VIP System
   ========================================================= */
function buyVIP(level, price, tickets, coins, levels) {
  state.vip = true;
  state.vipLevel = level;
  state.tickets += tickets;
  state.coins += coins;
  addXP(levels * XP_PER_LEVEL);
  notify(`VIP –æ—Ñ–æ—Ä–º–ª–µ–Ω (${level}). –ë–∏–ª–µ—Ç–æ–≤: +${tickets}, –º–æ–Ω–µ—Ç—ã: +${coins}, —É—Ä–æ–≤–Ω–∏: +${levels}.`);
  saveState();
}

/* =========================================================
   Wheel System
   ========================================================= */
const wheelCanvas = document.getElementById('wheel');
const wctx = wheelCanvas.getContext('2d');
const radius = wheelCanvas.width / 2;
const wheelPrizes = [
  {k:'coins100', label:'+100 –º–æ–Ω–µ—Ç', action:()=>{ state.coins+=100; }},
  {k:'coins250', label:'+250 –º–æ–Ω–µ—Ç', action:()=>{ state.coins+=250; }},
  {k:'coins500', label:'+500 –º–æ–Ω–µ—Ç', action:()=>{ state.coins+=500; }},
  {k:'xp700', label:'+700 XP', action:()=>{ addXP(700); }},
  {k:'xp1200', label:'+1200 XP', action:()=>{ addXP(1200); }},
  {k:'ticket', label:'üéü +1 –±–∏–ª–µ—Ç', action:()=>{ state.tickets+=1; }},
  {k:'frame', label:'–†–∞–º–∫–∞ (—Å–ª—É—á.)', action:()=>{ 
    const availableFrames = FRAMES.filter(f => !state.ownedFrames.includes(f.id) && !f.vipOnly);
    if (availableFrames.length > 0) {
      const randomFrame = availableFrames[Math.floor(Math.random() * availableFrames.length)];
      state.ownedFrames.push(randomFrame.id);
      notify(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Ä–∞–º–∫—É: ${randomFrame.title}`);
    } else {
      state.coins += 200;
      notify('+200 –º–æ–Ω–µ—Ç (–≤–º–µ—Å—Ç–æ —Ä–∞–º–∫–∏)');
    }
  }},
  {k:'glow', label:'–°–≤–µ—á–µ–Ω–∏–µ (—Å–ª—É—á.)', action:()=>{ 
    const availableGlows = GLOWS.filter(g => !state.ownedGlows.includes(g.id));
    if (availableGlows.length > 0) {
      const randomGlow = availableGlows[Math.floor(Math.random() * availableGlows.length)];
      state.ownedGlows.push(randomGlow.id);
      notify(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Å–≤–µ—á–µ–Ω–∏–µ: ${randomGlow.title}`);
    } else {
      state.coins += 300;
      notify('+300 –º–æ–Ω–µ—Ç (–≤–º–µ—Å—Ç–æ —Å–≤–µ—á–µ–Ω–∏—è)');
    }
  }},
  {k:'vip1m', label:'VIP 1 –º–µ—Å—è—Ü', action:()=>{ 
    if (!state.vip) {
      buyVIP('bronze', 0, 2, 150, 3);
    } else {
      state.tickets += 5;
      state.coins += 1000;
      notify('+5 –±–∏–ª–µ—Ç–æ–≤ –∏ +1000 –º–æ–Ω–µ—Ç (–≤–º–µ—Å—Ç–æ VIP)');
    }
  }}
];

const seg = Math.PI * 2 / wheelPrizes.length;
let wheelAngle = 0, wheelSpeed = 0, wheelSpinning = false;
let targetPrizeIndex = -1;

function drawWheel(rot = 0) {
  wctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
  
  for (let i = 0; i < wheelPrizes.length; i++) {
    const start = i * seg + rot;
    wctx.beginPath();
    const colors = ['#ff4d4d','#ffd24d','#4dff88','#4da6ff','#b84dff','#ff944d','#4dffff','#ff66cc','#9cff4d'];
    wctx.fillStyle = colors[i % colors.length];
    wctx.moveTo(radius, radius);
    wctx.arc(radius, radius, radius - 4, start, start + seg);
    wctx.fill();

    wctx.save();
    wctx.translate(radius, radius);
    wctx.rotate(start + seg / 2);
    wctx.fillStyle = '#041022';
    wctx.font = '14px Inter, Arial';
    wctx.textAlign = 'right';
    wctx.fillText(wheelPrizes[i].label, radius - 30, 6);
    wctx.restore();
  }

  wctx.beginPath();
  wctx.fillStyle = '#fff';
  wctx.arc(radius, radius, 36, 0, Math.PI * 2);
  wctx.fill();
  
  wctx.beginPath();
  wctx.fillStyle = '#0dd';
  wctx.arc(radius, radius, 26, 0, Math.PI * 2);
  wctx.fill();
}

function setupWheel() {
  drawWheel(wheelAngle);
  document.getElementById('spinBtn').addEventListener('click', () => {
    if (state.tickets > 0) {
      state.tickets--;
      spinWheelReal();
    } else {
      notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∏–ª–µ—Ç–æ–≤');
    }
  });
}

function spinWheelReal() {
  if (wheelSpinning) return;
  wheelSpinning = true;
  
  // Calculate target prize index based on pointer position
  targetPrizeIndex = Math.floor(Math.random() * wheelPrizes.length);
  
  // Calculate the angle needed to position the target prize at the pointer
  const targetAngle = (targetPrizeIndex / wheelPrizes.length) * Math.PI * 2;
  const pointerOffset = Math.PI; // Pointer is at the top (180 degrees)
  const targetRotation = pointerOffset - targetAngle;
  
  // Add multiple full rotations for visual effect
  const fullRotations = 5;
  const totalRotation = fullRotations * Math.PI * 2 + targetRotation;
  
  // Animate the wheel
  const startTime = Date.now();
  const duration = 5000; // 5 seconds
  
  function animate() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / duration, 1);
    
    // Easing function for smooth deceleration
    const easeOut = function(t) {
      return 1 - Math.pow(1 - t, 3);
    };
    
    wheelAngle = easeOut(progress) * totalRotation;
    drawWheel(wheelAngle);
    
    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      wheelSpinning = false;
      const prize = wheelPrizes[targetPrizeIndex];
      prize.action();
      saveState();
      
      const resultEl = document.getElementById('wheelResult');
      resultEl.innerHTML = `<div class="card wheel-result-animation">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <b>${prize.label}</b></div>`;
      notify('–í—ã–∏–≥—Ä—ã—à: ' + prize.label, 3000);
    }
  }
  
  animate();
}

function createGarland() {
  const g = document.getElementById('garland');
  g.innerHTML = '';
  const count = 34;
  for (let i = 0; i < count; i++) {
    const bulb = document.createElement('div');
    bulb.className = 'bulb';
    bulb.style.color = ['#ff3b3b','#ffe066','#66ff99','#66d9ff','#ff66ff'][i % 5];
    const a = (i / count) * Math.PI * 2;
    const x = 270 + Math.cos(a) * 260;
    const y = 270 + Math.sin(a) * 260;
    bulb.style.left = (x - 9) + 'px';
    bulb.style.top = (y - 9) + 'px';
    bulb.style.animationDelay = (i * 0.08) + 's';
    g.appendChild(bulb);
  }
}

/* =========================================================
   Catalog data
   ========================================================= */
const FRAMES = [
  {id:'f1', title:'Ice (LoL style)', price:150, vipOnly:false, url:'https://wallpapers.com/images/hd/leagueof-legends-ice-themed-icon-lbz9rlqcojud9fo5.png'},
  {id:'f2', title:'LoL Icon Ring', price:220, vipOnly:false, url:'https://i2.wp.com/www.seekpng.com/png/full/155-1551417_league-of-legends-icon-png.png'},
  {id:'f3', title:'Neon Circle', price:300, vipOnly:false, url:'https://i.imgur.com/V7HiEOp.png'},
  {id:'f4', title:'VIP - Gold Spiral', price:0, vipOnly:true, url:'https://i.imgur.com/6zq4O8y.png'},
  {id:'f5', title:'VIP - Royal Crest', price:0, vipOnly:true, url:'https://i.imgur.com/3Xq1GkN.png'},
];

for (let i = 6; i <= 16; i++) {
  FRAMES.push({
    id: 'f' + i,
    title: 'Frame #' + i,
    price: 80 + ((i * 17) % 420),
    vipOnly: (i % 11 === 0),
    url: `https://picsum.photos/seed/frame${i}/300/300`
  });
}

const GLOWS = [
  {id:'g1', title:'üî• Fire', price:500, cls:'glow-fire'},
  {id:'g2', title:'üíß Water', price:500, cls:'glow-water'},
  {id:'g3', title:'üåà Rainbow', price:1000, cls:'glow-rainbow'},
  {id:'g4', title:'‚≠ê Soft Glow', price:200, cls:'glow-basic'}
];

for (let i = 5; i <= 12; i++) {
  GLOWS.push({
    id: 'g' + i,
    title: `Glow FX ${i}`,
    price: 100 + ((i * 37) % 700),
    cls: (i % 2 ? 'glow-basic' : 'glow-rainbow')
  });
}

const EFFECTS = [
  {id:'profile-snow', title:'–°–Ω–µ–≥ –≤ –ø—Ä–æ—Ñ–∏–ª–µ', price:400, desc:'–ö—Ä–∞—Å–∏–≤—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥ –Ω–∞ —Ñ–æ–Ω–µ –ø—Ä–æ—Ñ–∏–ª—è.'}
];

const COIN_PACKS = [
  {id:'coin_100', coins:100, price:99},
  {id:'coin_250', coins:250, price:199},
  {id:'coin_500', coins:500, price:349},
  {id:'coin_1000', coins:1000, price:599},
  {id:'coin_2500', coins:2500, price:1299},
  {id:'coin_5000', coins:5000, price:2399}
];

const GAMES = ['Apex Legends','Fortnite','Minecraft','CS:GO','Rust','GTA V','Valorant','Overwatch','LoL','Dota2'];
const LOADERS = [];

GAMES.forEach((g, idx) => {
  LOADERS.push({id:`free-${idx}`, name:`${g} ‚Äî Free Loader`, game:g, type:'free'});
  LOADERS.push({id:`pro-${idx}`, name:`${g} ‚Äî Pro Loader`, game:g, type:'pro', price:1299 + idx * 100});
  LOADERS.push({id:`vip-${idx}`, name:`${g} ‚Äî VIP Loader`, game:g, type:'vip'});
});

/* =========================================================
   Rendering functions
   ========================================================= */
function renderAll() {
  // Update header stats
  document.getElementById('statCoins').textContent = `${state.coins} üí∞`;
  document.getElementById('statLevel').textContent = `Lvl ${xpToLevel(state.xp)}`;
  document.getElementById('statTickets').textContent = `üéü ${state.tickets}`;
  document.getElementById('wheelTickets').textContent = state.tickets;

  // Update profile
  document.getElementById('displayName').textContent = state.nick;
  document.getElementById('avatarImg').src = state.avatar;
  document.getElementById('profileBanner').src = state.banner;
  document.getElementById('uiCoins').textContent = state.coins;
  document.getElementById('uiTickets').textContent = state.tickets;
  document.getElementById('uiLevel').textContent = xpToLevel(state.xp);
  
  const cur = state.xp % XP_PER_LEVEL;
  document.getElementById('uiXPbar').style.width = (cur / XP_PER_LEVEL * 100) + '%';
  document.getElementById('uiXPtext').textContent = `${cur} / ${XP_PER_LEVEL} XP`;

  // VIP badge
  const vb = document.getElementById('vipBadge');
  vb.innerHTML = '';
  if (state.vip) {
    const d = document.createElement('div');
    d.className = 'vip-badge';
    d.textContent = state.vipLevel === 'gold' ? 'VIP Gold' : (state.vipLevel === 'silver' ? 'VIP Silver' : 'VIP Bronze');
    vb.appendChild(d);
  } else {
    vb.innerHTML = '<div class="hint">–ù–µ—Ç VIP</div>';
  }

  // Owned items
  renderOwnedList();
  renderApplied();

  if (!window._renderedOnce) {
    populateFilters();
    renderLoaders();
    renderCoinPacks();
    renderFramesGrid();
    renderGlowsGrid();
    renderEffectsGrid();
    setupWheel();
    createGarland();
    window._renderedOnce = true;
  }
}

function renderOwnedList() {
  const ol = document.getElementById('ownedList');
  ol.innerHTML = '';
  
  state.ownedFrames.forEach(fid => {
    const f = FRAMES.find(x => x.id === fid);
    if (!f) return;
    
    const el = document.createElement('div');
    el.className = 'card';
    el.style.padding = '8px';
    el.innerHTML = `
      <div style="font-weight:800">${escapeHtml(f.title)}</div>
      <div class="hint">${f.vipOnly ? 'VIP only' : f.price + ' –º–æ–Ω–µ—Ç'}</div>
      <div style="margin-top:8px">
        <button class="btn ghost" onclick="applyFrame('${f.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>
    `;
    ol.appendChild(el);
  });

  state.ownedGlows.forEach(gid => {
    const g = GLOWS.find(x => x.id === gid);
    if (!g) return;
    
    const el = document.createElement('div');
    el.className = 'card';
    el.style.padding = '8px';
    el.innerHTML = `
      <div style="font-weight:800">${escapeHtml(g.title)}</div>
      <div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>
      <div style="margin-top:8px">
        <button class="btn ghost" onclick="applyGlow('${g.id}')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>
    `;
    ol.appendChild(el);
  });

  state.ownedEffects.forEach(eid => {
    const e = EFFECTS.find(x => x.id === eid);
    if (!e) return;
    
    const el = document.createElement('div');
    el.className = 'card';
    el.style.padding = '8px';
    el.innerHTML = `
      <div style="font-weight:800">${escapeHtml(e.title)}</div>
      <div class="hint">${e.price} –º–æ–Ω–µ—Ç</div>
    `;
    ol.appendChild(el);
  });
}

function renderCoinPacks() {
  const parent = document.getElementById('coinPacks');
  parent.innerHTML = '';
  
  COIN_PACKS.forEach(p => {
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div>
      <div class="hint">${p.price} ‚ÇΩ</div>
    `;
    
    const b = document.createElement('button');
    b.className = 'btn primary';
    b.textContent = '–ö—É–ø–∏—Ç—å';
    b.onclick = () => initiateCryptoPayment(p.id, p.price, `–ü–∞–∫–µ—Ç ${p.coins} –º–æ–Ω–µ—Ç`);
    el.appendChild(b);
    parent.appendChild(el);
  });
}

function renderLoaders() {
  const parent = document.getElementById('loadersGrid');
  parent.innerHTML = '';
  const t = document.getElementById('filterType').value;
  const g = document.getElementById('filterGame').value;
  
  LOADERS.filter(l => {
    if (t !== 'all' && l.type !== t) return false;
    if (g && g !== 'all' && l.game !== g) return false;
    return true;
  }).forEach(l => {
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div class="hint">${escapeHtml(l.game)}</div>
      <div style="font-weight:900;margin-top:6px">${escapeHtml(l.name)}</div>
      <div class="hint" style="margin-top:8px">${l.type === 'free' ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π' : l.type === 'pro' ? '–ü–ª–∞—Ç–Ω—ã–π ' + l.price + '‚ÇΩ' : '–¢–æ–ª—å–∫–æ VIP'}</div>
    `;
    
    const ctrl = document.createElement('div');
    ctrl.style.marginTop = '10px';
    
    if (l.type === 'free') {
      const b = document.createElement('button');
      b.className = 'btn primary';
      b.textContent = '–°–∫–∞—á–∞—Ç—å';
      b.onclick = () => {
        state.stats.downloads++;
        addXP(50);
        notify('–°–∫–∞—á–∞–Ω–æ +50 XP');
        saveState();
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        window.open('#download', '_blank');
      };
      ctrl.appendChild(b);
    } else if (l.type === 'pro') {
      const b = document.createElement('button');
      b.className = 'btn primary';
      b.textContent = `–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`;
      b.onclick = () => initiateCryptoPayment(`loader_${l.id}`, l.price, l.name);
      ctrl.appendChild(b);
    } else {
      const b = document.createElement('button');
      b.className = 'btn primary';
      b.textContent = '–¢–æ–ª—å–∫–æ VIP';
      b.onclick = () => {
        if (state.vip) {
          state.stats.downloads++;
          addXP(100);
          notify('VIP –∑–∞–≥—Ä—É–∑–∫–∞ +100 XP');
          saveState();
          window.open('#download-vip', '_blank');
        } else {
          notify('–ù—É–∂–µ–Ω VIP');
          goTo('vip');
        }
      };
      ctrl.appendChild(b);
    }
    
    el.appendChild(ctrl);
    parent.appendChild(el);
  });
}

function renderFramesGrid() {
  const parent = document.getElementById('framesGrid');
  parent.innerHTML = '';
  
  FRAMES.forEach(f => {
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div style="height:130px;display:flex;align-items:center;justify-content:center">
        <img src="${f.url}" onerror="this.style.opacity=.5" style="max-width:100%;max-height:100%"/>
      </div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(f.title)}</div>
      <div class="hint">${f.vipOnly ? 'VIP only' : f.price + ' –º–æ–Ω–µ—Ç'}</div>
    `;
    
    el.addEventListener('click', () => {
      if (f.vipOnly && !state.vip) {
        notify('–†–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP');
        goTo('vip');
        return;
      }
      
      if (!state.ownedFrames.includes(f.id)) {
        if (!f.vipOnly) {
          if (state.coins < f.price) {
            notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
            return;
          }
          state.coins -= f.price;
          state.ownedFrames.push(f.id);
          addXP(Math.round(f.price / 2));
          notify('–†–∞–º–∫–∞ –∫—É–ø–ª–µ–Ω–∞: ' + f.title);
          saveState();
        } else {
          state.ownedFrames.push(f.id);
          notify('–†–∞–º–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ (VIP)');
          saveState();
        }
      } else {
        state.applied = {type: 'frame', id: f.id};
        notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: ' + f.title);
        saveState();
      }
    });
    
    if (state.ownedFrames.includes(f.id)) {
      const tag = document.createElement('div');
      tag.className = 'hint';
      tag.style.marginTop = '6px';
      tag.textContent = '–ö—É–ø–ª–µ–Ω–æ';
      el.appendChild(tag);
    }
    
    parent.appendChild(el);
  });
}

function renderGlowsGrid() {
  const parent = document.getElementById('glowsGrid');
  parent.innerHTML = '';
  
  GLOWS.forEach(g => {
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div style="height:86px;display:flex;align-items:center;justify-content:center;font-weight:900">${escapeHtml(g.title)}</div>
      <div class="hint">${g.price} –º–æ–Ω–µ—Ç</div>
    `;
    
    el.addEventListener('click', () => {
      if (!state.ownedGlows.includes(g.id)) {
        if (state.coins < g.price) {
          notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
          return;
        }
        state.coins -= g.price;
        state.ownedGlows.push(g.id);
        addXP(Math.round(g.price / 3));
        notify('–ö—É–ø–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ: ' + g.title);
        saveState();
      } else {
        state.applied = {type: 'glow', id: g.id};
        notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: ' + g.title);
        saveState();
      }
    });
    
    if (state.ownedGlows.includes(g.id)) {
      const tag = document.createElement('div');
      tag.className = 'hint';
      tag.style.marginTop = '6px';
      tag.textContent = '–ö—É–ø–ª–µ–Ω–æ';
      el.appendChild(tag);
    }
    
    parent.appendChild(el);
  });
}

function renderEffectsGrid() {
  const parent = document.getElementById('effectsGrid');
  parent.innerHTML = '';
  
  EFFECTS.forEach(e => {
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div style="font-weight:900">${escapeHtml(e.title)}</div>
      <div class="hint">${escapeHtml(e.desc)}</div>
      <div class="hint" style="margin-top:6px">${e.price} –º–æ–Ω–µ—Ç</div>
    `;
    
    el.addEventListener('click', () => {
      if (!state.ownedEffects.includes(e.id)) {
        if (state.coins < e.price) {
          notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
          return;
        }
        state.coins -= e.price;
        state.ownedEffects.push(e.id);
        addXP(Math.round(e.price / 2));
        notify('–ö—É–ø–ª–µ–Ω–æ: ' + e.title);
        saveState();
      } else {
        if (e.id === 'profile-snow') {
          toggleProfileSnow(true);
          notify('–°–Ω–µ–≥ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –≤–∫–ª—é—á—ë–Ω');
        }
      }
    });
    
    if (state.ownedEffects.includes(e.id)) {
      const tag = document.createElement('div');
      tag.className = 'hint';
      tag.style.marginTop = '6px';
      tag.textContent = '–ö—É–ø–ª–µ–Ω–æ';
      el.appendChild(tag);
    }
    
    parent.appendChild(el);
  });
}

function populateFilters() {
  const sel = document.getElementById('filterGame');
  sel.innerHTML = '<option value="all">–í—Å–µ –∏–≥—Ä—ã</option>';
  GAMES.forEach(g => {
    const o = document.createElement('option');
    o.value = g;
    o.textContent = g;
    sel.appendChild(o);
  });
  
  document.getElementById('filterType').addEventListener('change', renderLoaders);
  document.getElementById('filterGame').addEventListener('change', renderLoaders);
}

/* =========================================================
   Profile decorations
   ========================================================= */
function clearOverlays() {
  const f = document.querySelector('.frame-overlay');
  if (f) f.remove();
  const g = document.querySelector('.glow-class');
  if (g) g.remove();
  const wrap = document.getElementById('avatarWrap');
  GLOWS.forEach(x => wrap.classList.remove(x.cls));
}

function renderApplied() {
  clearOverlays();
  const wrap = document.getElementById('avatarWrap');
  
  if (state.applied && state.applied.type === 'frame') {
    const f = FRAMES.find(x => x.id === state.applied.id);
    if (f) {
      const img = document.createElement('img');
      img.className = 'frame-overlay';
      img.src = f.url;
      wrap.appendChild(img);
    }
  } else if (state.applied && state.applied.type === 'glow') {
    const g = GLOWS.find(x => x.id === state.applied.id);
    if (g) {
      const div = document.createElement('div');
      div.className = 'glow-class ' + g.cls;
      wrap.appendChild(div);
    }
  }
}

function applyFrame(fid) {
  if (!state.ownedFrames.includes(fid)) {
    notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–π —Ä–∞–º–∫–∏');
    return;
  }
  state.applied = {type: 'frame', id: fid};
  saveState();
  notify('–†–∞–º–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');
}

function applyGlow(gid) {
  if (!state.ownedGlows.includes(gid)) {
    notify('–£ —Ç–µ–±—è –Ω–µ—Ç —ç—Ç–æ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è');
    return;
  }
  state.applied = {type: 'glow', id: gid};
  saveState();
  notify('–°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ');
}

function unequipAll() {
  state.applied = {type: null, id: null};
  saveState();
  notify('–í—Å–µ —É–∫—Ä–∞—à–µ–Ω–∏—è —Å–Ω—è—Ç—ã');
}

function openFramesInShop() {
  goTo('shop');
  setTimeout(() => document.getElementById('framesGrid').scrollIntoView({behavior: 'smooth'}), 50);
}

function openGlowsInShop() {
  goTo('shop');
  setTimeout(() => document.getElementById('glowsGrid').scrollIntoView({behavior: 'smooth'}), 50);
}

/* =========================================================
   Profile editor
   ========================================================= */
document.getElementById('editorAvatar').addEventListener('change', e => {
  const f = e.target.files[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = () => {
    document.getElementById('editorPreview').src = r.result;
  };
  r.readAsDataURL(f);
});

function openProfileEditor() {
  document.getElementById('editorPreview').src = state.avatar;
  document.getElementById('editorNick').value = state.nick;
  document.getElementById('profileModal').showModal();
}

function saveProfileEdits() {
  const nv = document.getElementById('editorNick').value.trim();
  if (nv) state.nick = nv;
  const preview = document.getElementById('editorPreview').src;
  if (preview) state.avatar = preview;
  saveState();
  document.getElementById('profileModal').close();
  notify('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω');
}

function changeBanner() {
  const currentIndex = BANNERS.indexOf(state.banner);
  const nextIndex = (currentIndex + 1) % BANNERS.length;
  state.banner = BANNERS[nextIndex];
  saveState();
  renderAll();
  notify('–ë–∞–Ω–Ω–µ—Ä –∏–∑–º–µ–Ω—ë–Ω');
}

/* =========================================================
   Chat system
   ========================================================= */
function renderChat() {
  const out = document.getElementById('chatMessages');
  out.innerHTML = '';
  
  state.chat.slice(-500).forEach(m => {
    const div = document.createElement('div');
    div.className = 'chat-msg';
    const t = new Date(m.t).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
    div.innerHTML = `
      <div style="font-weight:700">${escapeHtml(m.nick)} <span style="font-weight:400;color:var(--muted);font-size:12px"> ${t}</span></div>
      <div>${escapeHtml(m.msg)}</div>
    `;
    out.appendChild(div);
  });
  
  out.scrollTop = out.scrollHeight;
}

function sendChat() {
  const inp = document.getElementById('chatInput');
  const txt = inp.value.trim();
  if (!txt) return;
  
  state.chat.push({
    nick: state.nick,
    msg: txt,
    t: Date.now()
  });
  
  saveState();
  inp.value = '';
  renderChat();
}

function clearChat() {
  state.chat = [];
  saveState();
  notify('–ß–∞—Ç –æ—á–∏—â–µ–Ω');
}

function exportChat() {
  const blob = new Blob([JSON.stringify(state.chat, null, 2)], {type: 'application/json'});
  const u = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = u;
  a.download = 'chat_export.json';
  a.click();
  URL.revokeObjectURL(u);
}

/* =========================================================
   Confetti
   ========================================================= */
const confettiCanvas = document.getElementById('confetti');
const cctx = confettiCanvas.getContext('2d');
let confetti = [];

function resizeCanvas() {
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function launchConfetti() {
  for (let i = 0; i < 130; i++) {
    confetti.push({
      x: Math.random() * confettiCanvas.width,
      y: -Math.random() * confettiCanvas.height,
      vx: (Math.random() - 0.5) * 6,
      vy: 2 + Math.random() * 6,
      s: 4 + Math.random() * 8,
      c: ['#ff4d4d','#ffd65b','#7c4dff','#00d4ff','#4dff88'][Math.floor(Math.random() * 5)],
      r: Math.random() * 360
    });
  }
  
  if (!window._confRun) {
    window._confRun = true;
    requestAnimationFrame(confettiLoop);
  }
}

function confettiLoop() {
  cctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  
  confetti.forEach((p, i) => {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.05;
    p.r += p.vx;
    
    cctx.save();
    cctx.translate(p.x, p.y);
    cctx.rotate(p.r * Math.PI / 180);
    cctx.fillStyle = p.c;
    cctx.fillRect(-p.s / 2, -p.s / 2, p.s, p.s);
    cctx.restore();
    
    if (p.y > confettiCanvas.height + 50) {
      confetti.splice(i, 1);
    }
  });
  
  if (confetti.length) {
    requestAnimationFrame(confettiLoop);
  } else {
    window._confRun = false;
  }
}

/* =========================================================
   Utilities
   ========================================================= */
function $(id) {
  return document.getElementById(id);
}

function clamp(v, a, b) {
  return Math.max(a, Math.min(b, v));
}

function notify(msg, t = 2200) {
  const n = document.getElementById('notif');
  n.textContent = msg;
  n.style.opacity = 1;
  n.style.transform = 'translateY(0)';
  
  setTimeout(() => {
    n.style.opacity = 0;
    n.style.transform = 'translateY(12px)';
  }, t);
}

function xpToLevel(xp) {
  return clamp(Math.floor(xp / XP_PER_LEVEL) + 1, 1, MAX_LEVEL);
}

function addXP(amount) {
  if (state.xp >= MAX_LEVEL * XP_PER_LEVEL) return;
  
  const prev = xpToLevel(state.xp);
  state.xp = clamp(state.xp + amount, 0, MAX_LEVEL * XP_PER_LEVEL);
  const now = xpToLevel(state.xp);
  
  if (now > prev) {
    notify('üéâ Level Up ‚Äî ' + now, 3000);
    launchConfetti();
  }
  
  saveState();
}

function escapeHtml(s) {
  return (s + '').replace(/[&<>"']/g, c => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  }[c]));
}

/* =========================================================
   Navigation
   ========================================================= */
function goTo(tab) {
  const mapping = {
    buy: 'page-buy',
    vip: 'page-vip',
    shop: 'page-shop',
    profile: 'page-profile',
    chat: 'page-chat',
    wheel: 'page-wheel'
  };
  
  document.querySelectorAll('.tabbtn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('section[id^="page-"]').forEach(s => s.style.display = 'none');
  
  document.getElementById('btn-' + tab).classList.add('active');
  document.getElementById(mapping[tab]).style.display = 'block';
  
  if (tab === 'chat') {
    renderChat();
  }
}

function bindUI() {
  document.getElementById('btn-buy').addEventListener('click', () => goTo('buy'));
  document.getElementById('btn-vip').addEventListener('click', () => goTo('vip'));
  document.getElementById('btn-shop').addEventListener('click', () => goTo('shop'));
  document.getElementById('btn-profile').addEventListener('click', () => goTo('profile'));
  document.getElementById('btn-chat').addEventListener('click', () => goTo('chat'));
  document.getElementById('btn-wheel').addEventListener('click', () => goTo('wheel'));
  
  document.getElementById('chatSend').addEventListener('click', sendChat);
  document.getElementById('chatInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') sendChat();
  });
  
  document.getElementById('authBtn').addEventListener('click', () => {
    notify('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
  });
}

/* =========================================================
   Initialization
   ========================================================= */
loadState();
bindUI();
renderAll();

// Initial notification
setTimeout(() => {
  notify('–°–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ CryptoBot –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ üéÆ', 3000);
}, 1000);

// Expose for debugging
window._GL = {
  state, saveState, addXP, initiateCryptoPayment,
  applyFrame, applyGlow, unequipAll, buyVIP,
  changeBanner, launchConfetti
};
</script>
</body>
</html>
