<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GameLoaders ‚Äî Shop, VIP, Profile, Frames</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#05060a;
    --panel: rgba(255,255,255,0.03);
    --muted:#9aa6d1;
    --white:#eaf0ff;
    --neon1:#7c4dff;
    --neon2:#00d4ff;
    --vip-gradient: conic-gradient(from 0deg, #ff0044, #ff9900, #ffee00, #00ff77, #00ccff, #7c4dff);
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,Arial;
    background:
      radial-gradient(800px 400px at 10% 10%, rgba(124,77,255,0.06), transparent),
      radial-gradient(600px 300px at 90% 80%, rgba(0,212,255,0.04), transparent),
      var(--bg);
    color:var(--white);
    -webkit-font-smoothing:antialiased;
  }

  .container{width:min(1150px,94%);margin:0 auto;padding:24px 0;}

  header{position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));backdrop-filter: blur(6px);border-bottom:1px solid rgba(255,255,255,0.03);z-index:90}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px;color:var(--neon1)}
  .brand .dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 6px 20px rgba(124,77,255,0.25)}
  nav{display:flex;gap:8px;align-items:center}
  nav button{background:transparent;border:0;color:var(--muted);padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  nav button.active{color:var(--white);background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 10px 30px rgba(124,77,255,0.14)}
  #authBtn{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--white);cursor:pointer}

  /* layout */
  .hero{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:20px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 40px rgba(2,6,23,0.5)}
  .title{font-size:22px;font-weight:800;margin-bottom:6px}
  .muted{color:var(--muted);font-size:13px}

  .grid{display:grid;gap:12px}
  .grid.cols-4{grid-template-columns:repeat(4,1fr)}
  .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  .loader-card{border-radius:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);transition:transform .18s, box-shadow .18s;overflow:hidden}
  .loader-card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(0,0,0,0.6)}
  .game{font-size:12px;color:var(--muted);font-weight:700}
  .loader-name{font-size:15px;font-weight:800;margin:8px 0}
  .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
  .cta{display:flex;gap:8px;align-items:center}

  .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
  .btn.primary{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:white;box-shadow:0 8px 30px rgba(124,77,255,0.14)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--white)}

  /* avatar and profile */
  .profile{display:flex;gap:12px;align-items:center}
  .avatar-frame{position:relative;width:120px;height:120px;border-radius:50%;padding:6px;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 12px 40px rgba(124,77,255,0.16);animation:rotateHue 8s linear infinite}
  .avatar-frame .inner{width:100%;height:100%;border-radius:50%;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(255,255,255,0.02));display:flex;align-items:center;justify-content:center;overflow:hidden;border:4px solid rgba(0,0,0,0.25)}
  .avatar-frame img{width:100%;height:100%;object-fit:cover;border-radius:50%}
  @keyframes rotateHue{0%{filter:hue-rotate(0deg)}100%{filter:hue-rotate(360deg)}}

  .vip-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-weight:800;background:var(--vip-gradient);background-size:300% 300%;animation:vipShift 6s linear infinite;color:#051022;box-shadow:0 12px 30px rgba(124,77,255,0.08)}
  @keyframes vipShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

  /* frames gallery */
  .frames-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
  .frame-card{border-radius:10px;padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);text-align:center;cursor:pointer;transition:transform .18s, box-shadow .18s}
  .frame-card:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .frame-card img{width:100%;height:84px;object-fit:cover;border-radius:8px}
  .frame-price{font-weight:800;margin-top:6px}

  /* item card */
  .item-card{border-radius:10px;padding:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03)}
  .item-thumb{height:84px;border-radius:8px;background:linear-gradient(45deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));display:flex;align-items:center;justify-content:center;font-weight:900}

  .notif{position:fixed;right:18px;bottom:18px;min-width:240px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#041022;font-weight:800;transform:translateY(20px);opacity:0;pointer-events:none;transition:all .3s}
  .notif.show{opacity:1;transform:translateY(0);pointer-events:auto}

  footer{margin-top:40px;color:var(--muted);font-size:13px;text-align:center;opacity:0.9}

  @media(max-width:980px){
    .hero{grid-template-columns:1fr}
    .grid.cols-4{grid-template-columns:repeat(2,1fr)}
    .grid.cols-3{grid-template-columns:repeat(2,1fr)}
  }
  @media(max-width:520px){
    .grid.cols-4{grid-template-columns:1fr}
    .grid.cols-3{grid-template-columns:1fr}
    nav{flex-wrap:wrap;gap:6px}
  }
</style>
</head>
<body>
  <header>
    <div class="container topbar">
      <div class="brand"><span class="dot"></span>GameLoaders</div>
      <nav>
        <button id="tab-buy" class="active" onclick="goTab('buy')">–ö—É–ø–∏—Ç—å</button>
        <button id="tab-vip" onclick="goTab('vip')">VIP</button>
        <button id="tab-profile" onclick="goTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
        <button id="tab-shop" onclick="goTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button id="authBtn" onclick="authDemo()">–í–æ–π—Ç–∏</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="panel">
        <div class="title">GameLoaders ‚Äî –ª–æ–∞–¥–µ—Ä—ã –∏ —É–∫—Ä–∞—à–µ–Ω–∏—è</div>
        <div class="muted">Free, Pro –∏ VIP-only –ª–æ–∞–¥–µ—Ä—ã. –ú–∞–≥–∞–∑–∏–Ω —É–∫—Ä–∞—à–µ–Ω–∏–π –∏ —Ä–∞–º–æ–∫ ‚Äî –≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ, 2 —Ä–∞–º–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è VIP.</div>

        <div style="margin-top:12px;display:flex;gap:10px">
          <button class="btn primary" onclick="goTab('buy')">–ö—É–ø–∏—Ç—å –ª–æ–∞–¥–µ—Ä—ã</button>
          <button class="btn ghost" onclick="goTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
        </div>

        <div style="margin-top:16px;display:flex;gap:10px;align-items:center">
          <div style="flex:1">
            <div style="color:var(--muted);font-size:13px">–ë–∞–ª–∞–Ω—Å</div>
            <div style="font-weight:800;font-size:18px"><span id="uiCoins">0</span> –º–æ–Ω–µ—Ç</div>
          </div>
          <div style="width:240px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
            <div class="muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
            <div style="font-weight:800" id="uiNick">Player</div>
            <div style="margin-top:6px"><button class="btn ghost" onclick="goTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button></div>
          </div>
        </div>
      </div>

      <aside class="panel">
        <div style="display:flex;flex-direction:column;align-items:center;gap:12px">
          <div class="profile" style="flex-direction:column">
            <div class="avatar-frame" id="avatarFrame">
              <div class="inner"><img id="avatarImg" src="https://i.pravatar.cc/300?img=12" alt="avatar"/></div>
            </div>
            <div style="font-weight:800" id="displayName">Player</div>
            <div id="vipWrapper"></div>

            <div style="width:100%;margin-top:8px">
              <div style="display:flex;justify-content:space-between;color:var(--muted);font-size:13px">
                <div>–£—Ä–æ–≤–µ–Ω—å</div><div id="uiLevel">1</div>
              </div>
              <div style="height:10px;background:rgba(255,255,255,0.03);border-radius:6px;margin-top:6px;overflow:hidden">
                <div id="xpBar" style="height:100%;background:linear-gradient(90deg,var(--neon1),var(--neon2));width:0%"></div>
              </div>
              <div style="display:flex;justify-content:space-between;color:var(--muted);font-size:12px;margin-top:6px">
                <div id="xpText">0 / 1000 XP</div><div id="levelCap" style="color:var(--muted)">–º–∞–∫—Å 100</div>
              </div>
            </div>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button class="btn ghost" onclick="openEdit()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              <button class="btn primary" onclick="demoGainXP()">+XP (demo)</button>
            </div>
          </div>
        </div>
      </aside>
    </section>

    <!-- BUY PAGE -->
    <section id="page-buy" class="panel" style="margin-top:18px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h3 style="margin:0">–õ–æ–∞–¥–µ—Ä—ã ‚Äî Free / Pro / VIP-only</h3>
          <div class="muted">–í—ã–±–µ—Ä–∏ –∏–≥—Ä—É –∏ —Å–∫–∞—á–∞–π –∏–ª–∏ –∫—É–ø–∏ –ª–æ–∞–¥–µ—Ä</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="filterGame" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--white)"></select>
          <select id="filterType" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--white)">
            <option value="all">–í—Å–µ</option><option value="free">Free</option><option value="pro">Pro</option><option value="vip">VIP-only</option>
          </select>
        </div>
      </div>

      <div id="loadersGrid" class="grid cols-4" style="margin-top:12px"></div>
    </section>

    <!-- VIP PAGE -->
    <section id="page-vip" class="panel" style="margin-top:18px;display:none">
      <h3>VIP –ø–æ–¥–ø–∏—Å–∫–∏</h3>
      <div class="muted">VIP –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∫ VIP-only —Ä–∞–º–∫–∞–º –∏ –ª–æ–∞–¥–µ—Ä–∞–º, +5 —É—Ä–æ–≤–Ω–µ–π –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px">
        <div class="panel card">
          <h4>1 –º–µ—Å—è—Ü</h4><div class="muted">–ë–∞–∑–æ–≤—ã–π VIP</div>
          <div style="margin-top:8px"><button class="btn primary" onclick="purchaseVIP('month',299)">–ö—É–ø–∏—Ç—å –∑–∞ 299 ‚ÇΩ</button></div>
        </div>
        <div class="panel card">
          <h4>12 –º–µ—Å—è—Ü–µ–≤</h4><div class="muted">VIP –Ω–∞ –≥–æ–¥</div>
          <div style="margin-top:8px"><button class="btn primary" onclick="purchaseVIP('year',2870)">–ö—É–ø–∏—Ç—å –∑–∞ 2870 ‚ÇΩ</button></div>
        </div>
        <div class="panel card">
          <h4>–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ</h4><div class="muted">VIP –Ω–∞–≤—Å–µ–≥–¥–∞</div>
          <div style="margin-top:8px"><button class="btn primary" onclick="purchaseVIP('lifetime',7990)">–ö—É–ø–∏—Ç—å –∑–∞ 7990 ‚ÇΩ</button></div>
        </div>
      </div>
    </section>

    <!-- PROFILE PAGE -->
    <section id="page-profile" class="panel" style="margin-top:18px;display:none">
      <h3>–ü—Ä–æ—Ñ–∏–ª—å –∏ —Ä–∞–º–∫–∏</h3>
      <div style="display:grid;grid-template-columns:320px 1fr;gap:12px">
        <div class="panel">
          <div style="display:flex;flex-direction:column;align-items:center;gap:10px">
            <div class="avatar-frame">
              <div class="inner"><img id="profileAvatar" src="" style="width:100%;height:100%;object-fit:cover;border-radius:50%"/></div>
            </div>
            <div style="font-weight:800" id="profileNick"></div>
            <div id="profileVip"></div>
            <div style="width:100%;margin-top:8px">
              <label class="muted">–ù–∏–∫</label>
              <input id="inputNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--white)"/>
              <label class="muted" style="margin-top:8px;display:block">–ê–≤–∞—Ç–∞—Ä</label>
              <input id="inputAvatar" type="file"/>
              <div style="display:flex;gap:8px;margin-top:10px">
                <button class="btn primary" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn ghost" onclick="resetProfile()">–°–±—Ä–æ—Å</button>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h4>–ú–∞–≥–∞–∑–∏–Ω —Ä–∞–º–æ–∫ (–≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ, 2 ‚Äî VIP-only)</h4>
          <div class="muted">–ö—É–ø–∏ —Ä–∞–º–∫—É ‚Äî –æ–Ω–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∫ –∞–≤–∞—Ç–∞—Ä—É. VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å VIP-—Ä–∞–º–∫–∏.</div>
          <div id="framesGrid" class="frames-grid" style="margin-top:12px"></div>
        </div>
      </div>
    </section>

    <!-- SHOP PAGE -->
    <section id="page-shop" class="panel" style="margin-top:18px;display:none">
      <h3>–ú–∞–≥–∞–∑–∏–Ω –º–æ–Ω–µ—Ç –∏ –ø—Ä–∏–∫–æ–ª—é—Ö</h3>
      <div style="margin-top:8px">
        <div class="muted">–ü–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç (–¥–µ–º–æ). –ü–æ–∫—É–ø–∫–∞ –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è.</div>
        <div id="coinGrid" class="grid cols-4" style="margin-top:12px"></div>
      </div>

      <h4 style="margin-top:18px">–ü—Ä–∏–∫–æ–ª—é—Ö–∏ (–∫—É–ø–∏—Ç—å –∑–∞ –º–æ–Ω–µ—Ç—ã)</h4>
      <div id="itemsGrid" class="grid cols-4" style="margin-top:12px"></div>
    </section>

    <footer style="margin-top:28px">¬© GameLoaders ‚Äî –¥–µ–º–æ. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø–ª–∞—Ç—ã –ø–æ–¥–∫–ª—é—á–∏ LolzTeam / LZT API –∏ webhook.</footer>
  </main>

  <div id="notif" class="notif"></div>

<!-- PROFILE EDIT DIALOG -->
<dialog id="dlg" style="border:none;border-radius:12px;padding:0">
  <div style="width:min(720px,96vw);padding:18px;background:var(--panel);border-radius:12px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
      <button onclick="document.getElementById('dlg').close()" style="background:none;border:0;color:var(--muted);cursor:pointer">‚úï</button>
    </div>
    <div style="display:flex;gap:12px;margin-top:12px">
      <div style="flex:0 0 120px"><img id="dlgPreview" src="" style="width:120px;height:120px;border-radius:8px;object-fit:cover"/></div>
      <div style="flex:1">
        <label class="muted">–ù–∏–∫</label>
        <input id="dlgNick" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--white)"/>
        <label class="muted" style="margin-top:8px;display:block">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
        <input id="dlgAvatar" type="file"/>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn primary" onclick="saveDlg()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" onclick="document.getElementById('dlg').close()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</dialog>

<script>
/* =========================
   State, Persistence, Init
   ========================= */
const STORAGE = 'gameloaders_v2';
let state = {
  nick: 'Player',
  avatar: 'https://i.pravatar.cc/300?img=12',
  coins: 500,
  xp: 0,           // total XP
  vip: false,
  vipLevel: null,  // 'month','year','lifetime'
  ownedItems: [],  // purchased item ids
  ownedFrames: [], // purchased frame ids
  appliedFrame: null,
  downloads: 0,
};
function load() {
  try {
    const s = JSON.parse(localStorage.getItem(STORAGE));
    if (s) state = Object.assign(state, s);
  } catch(e){}
}
function save() {
  localStorage.setItem(STORAGE, JSON.stringify(state));
  renderAll();
}

/* =========================
   XP and Levels
   ========================= */
const XP_PER_LEVEL = 1000;
const MAX_LEVEL = 100;
function xpToLevel(xp) {
  // level 1 at XP in [0..999] -> level = floor(xp/1000)+1
  const lvl = Math.min(MAX_LEVEL, Math.floor(xp / XP_PER_LEVEL) + 1);
  return lvl;
}
function levelToXP(level) {
  return Math.max(0, (level - 1) * XP_PER_LEVEL);
}
function addXP(amount) {
  if (state.xp >= MAX_LEVEL * XP_PER_LEVEL) return; // already max
  const prevLevel = xpToLevel(state.xp);
  state.xp = Math.min(state.xp + amount, MAX_LEVEL * XP_PER_LEVEL);
  const newLevel = xpToLevel(state.xp);
  if (newLevel > prevLevel) {
    notify(`üéâ Level Up! –£—Ä–æ–≤–µ–Ω—å ${newLevel}`, 3000);
    // small visual pulse - handled in renderAll
  }
  save();
}

/* =========================
   Notify
   ========================= */
const notifEl = document.getElementById('notif');
let notifTimer = null;
function notify(msg, t=2000) {
  notifEl.textContent = msg;
  notifEl.classList.add('show');
  if (notifTimer) clearTimeout(notifTimer);
  notifTimer = setTimeout(()=> { notifEl.classList.remove('show'); notifTimer = null; }, t);
}

/* =========================
   Frames (user-provided links)
   All frames are paid; 2 frames are VIP-only
   ========================= */
const FRAMES = [
  { id:'f1', title:'Ice Frame', url:'https://i.pravatar.cc/400?img=10', price:150, vipOnly:false },
  // Using user's provided links (they are search results; we include them but they may or may not load ‚Äî user can replace with direct images)
  { id:'f2', title:'Border 2', url:'https://i2.wp.com/www.seekpng.com/png/full/155-1551417_league-of-legends-icon-png.png', price:200, vipOnly:false },
  { id:'f3', title:'Cool Frame', url:'https://i.imgur.com/V7HiEOp.png', price:300, vipOnly:false },
  { id:'f4', title:'Decor Border', url:'https://en.idei.club/uploads/posts/2023-06/1687020123_en-idei-club-p-border-avatar-dizain-krasivo-3.png', price:400, vipOnly:true },
  { id:'f5', title:'Royal Frame', url:'https://en.idei.club/uploads/posts/2023-06/1687020123_en-idei-club-p-border-avatar-dizain-krasivo-3.png', price:500, vipOnly:true }
];
// Note: If URLs don't load (yandex search pages), replace with direct image links.

function renderFramesGrid() {
  const grid = document.getElementById('framesGrid');
  grid.innerHTML = '';
  FRAMES.forEach(f=>{
    const div = document.createElement('div');
    div.className = 'frame-card';
    const owned = state.ownedFrames.includes(f.id);
    div.innerHTML = `
      <img src="${f.url}" alt="${escapeHtml(f.title)}" onerror="this.style.opacity=0.5"/>
      <div style="margin-top:8px;font-weight:700">${escapeHtml(f.title)}</div>
      <div class="frame-price">${f.vipOnly ? 'VIP only' : f.price + ' –º–æ–Ω–µ—Ç'}</div>
    `;
    // click handler: buy or apply
    div.addEventListener('click', ()=>{
      if (f.vipOnly && !state.vip) { notify('–≠—Ç–∞ —Ä–∞–º–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ VIP'); goTab('vip'); return; }
      if (!owned) {
        if (state.coins < f.price) { notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
        // purchase
        state.coins -= f.price;
        state.ownedFrames.push(f.id);
        // buying grants XP: e.g., 200 XP per purchase (tunable). Let's grant based on price: price/2 XP
        const xpGain = Math.round(f.price / 2);
        addXP(xpGain);
        notify(`–ö—É–ø–ª–µ–Ω–∞ —Ä–∞–º–∫–∞ ${f.title}. +${xpGain} XP`);
        save();
      } else {
        // already owned -> apply
        state.appliedFrame = f.id;
        notify(`–†–∞–º–∫–∞ ${f.title} –ø—Ä–∏–º–µ–Ω–µ–Ω–∞`);
        save();
      }
    });
    // apply badge if applied
    if (state.appliedFrame === f.id) {
      div.style.boxShadow = '0 8px 40px rgba(124,77,255,0.28)';
      div.style.transform = 'translateY(-6px)';
    }
    // show VIP overlay for VIP-only
    if (f.vipOnly) {
      const vipTag = document.createElement('div');
      vipTag.style.position = 'absolute';
      vipTag.style.top = '8px';
      vipTag.style.right = '8px';
      vipTag.style.padding = '4px 8px';
      vipTag.style.borderRadius = '999px';
      vipTag.style.fontWeight = '800';
      vipTag.style.background = 'linear-gradient(90deg,#ffd65b,#ff9c00)';
      vipTag.style.color = '#000';
      vipTag.textContent = 'VIP';
      div.appendChild(vipTag);
    }
    grid.appendChild(div);
  });
}

/* =========================
   Coin packs and shop items
   ========================= */
const COIN_PACKS = [
  {id:'coin1', coins:100, price:99},
  {id:'coin2', coins:250, price:199},
  {id:'coin3', coins:500, price:349},
  {id:'coin4', coins:1000, price:599},
  {id:'coin5', coins:2500, price:1299},
  {id:'coin6', coins:5000, price:2399},
];
function renderCoinPacks(){
  const grid = document.getElementById('coinGrid');
  grid.innerHTML = '';
  COIN_PACKS.forEach(p=>{
    const el = document.createElement('div'); el.className='coin-pack';
    el.style.padding='12px';
    el.style.borderRadius='10px';
    el.style.background='linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))';
    el.style.border='1px solid rgba(255,255,255,0.03)';
    el.innerHTML = `<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div style="color:var(--muted)">${p.price} ‚ÇΩ</div>`;
    const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–ö—É–ø–∏—Ç—å';
    btn.onclick = ()=>{ state.coins += p.coins; addXP(Math.round(p.coins/5)); notify(`–ö—É–ø–ª–µ–Ω–æ ${p.coins} –º–æ–Ω–µ—Ç. +${Math.round(p.coins/5)} XP`); save(); };
    el.appendChild(btn);
    grid.appendChild(el);
  });
}

const SHOP_ITEMS = (function(){
  const types = ['Aura','Frame','Badge','Theme','Emoji','Effect'];
  const arr = [];
  for(let i=1;i<=24;i++){
    arr.push({
      id:'item'+i,
      title: `${types[i%types.length]} #${i}`,
      price: 20 + i*8,
      desc: `–ü—Ä–∏–∫–æ–ª—é—Ö–∞ ${i}`,
      vipOnly: (i%7===0)
    });
  }
  return arr;
})();
function renderShopItems(){
  const grid = document.getElementById('itemsGrid');
  grid.innerHTML = '';
  SHOP_ITEMS.forEach(it=>{
    const div = document.createElement('div'); div.className='item-card';
    div.innerHTML = `<div class="item-thumb">${escapeHtml(it.title)}</div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(it.title)}</div>
      <div class="muted" style="font-size:13px">${escapeHtml(it.desc)}</div>
      <div style="display:flex;align-items:center;margin-top:8px;gap:8px">
        <div style="flex:1;color:var(--muted)">${it.price} –º–æ–Ω–µ—Ç</div>
        <button class="btn primary">${it.vipOnly ? 'VIP' : '–ö—É–ø–∏—Ç—å'}</button>
      </div>`;
    const btn = div.querySelector('button');
    btn.onclick = ()=>{
      if (it.vipOnly && !state.vip) { notify('–¢—Ä–µ–±—É–µ—Ç—Å—è VIP –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —ç—Ç–æ–π –ø—Ä–∏–∫–æ–ª—é—Ö–∏'); goTab('vip'); return; }
      if (state.coins < it.price) { notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
      state.coins -= it.price;
      state.ownedItems.push(it.id);
      addXP(Math.round(it.price/2)); // purchase grants XP
      notify(`–ö—É–ø–ª–µ–Ω–æ: ${it.title}. +${Math.round(it.price/2)} XP`);
      save();
    };
    grid.appendChild(div);
  });
}

/* =========================
   Loaders (games)
   ========================= */
const GAMES = ['Apex','Fortnite','Minecraft','CS:GO','Rust','GTA V','Valorant','Overwatch','LoL','Dota2'];
const LOADERS = [];
(function initLoaders(){
  GAMES.forEach((g, idx)=>{
    LOADERS.push({id:`free-${idx}`, name:`${g} ‚Äî Free Loader`, game:g, type:'free'});
    LOADERS.push({id:`pro-${idx}`, name:`${g} ‚Äî Pro Loader`, game:g, type:'pro', price: 149 + idx*20});
    LOADERS.push({id:`vip-${idx}`, name:`${g} ‚Äî VIP Loader`, game:g, type:'vip'});
  });
})();
function renderLoaderFilter(){
  const sel = document.getElementById('filterGame');
  sel.innerHTML = '<option value="all">–í—Å–µ –∏–≥—Ä—ã</option>';
  GAMES.forEach(g=>{ const o = document.createElement('option'); o.value=g; o.textContent = g; sel.appendChild(o); });
}
function renderLoaders(){
  const grid = document.getElementById('loadersGrid');
  grid.innerHTML = '';
  const filterType = document.getElementById('filterType').value;
  const filterGame = document.getElementById('filterGame').value;
  LOADERS.filter(l=>{
    if (filterType !== 'all' && l.type !== filterType) return false;
    if (filterGame !== 'all' && l.game !== filterGame) return false;
    return true;
  }).forEach(l=>{
    const div = document.createElement('div'); div.className = 'loader-card';
    div.innerHTML = `<div class="game">${escapeHtml(l.game)}</div><div class="loader-name">${escapeHtml(l.name)}</div><div class="meta">${l.type === 'free' ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π' : (l.type==='pro' ? '–ü–ª–∞—Ç–Ω—ã–π' : '–¢–æ–ª—å–∫–æ VIP')}</div><div class="cta"></div>`;
    const cta = div.querySelector('.cta');
    if (l.type === 'free') {
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–°–∫–∞—á–∞—Ç—å'; btn.onclick = ()=>{ state.downloads++; save(); notify('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ (–¥–µ–º–æ)'); };
      cta.appendChild(btn);
    } else if (l.type === 'pro') {
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent=`–ö—É–ø–∏—Ç—å ${l.price}‚ÇΩ`; btn.onclick = ()=>{ /* demo: buy pro costs real money ‚Äî emulate by coin deduction? we'll add to owned */ state.ownedItems.push('PRO:'+l.id); addXP(300); notify(`–ö—É–ø–ª–µ–Ω Pro ${l.name} (+300 XP)`); save(); };
      cta.appendChild(btn);
    } else {
      const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–¢–æ–ª—å–∫–æ VIP'; btn.onclick = ()=>{ if(state.vip) { state.downloads++; save(); notify('–°–∫–∞—á–∞–Ω–æ VIP'); } else { notify('–ù—É–∂–µ–Ω VIP'); goTab('vip'); } };
      cta.appendChild(btn);
    }
    grid.appendChild(div);
  });
}

/* =========================
   VIP purchase: gives +5 levels instantly
   Each level = 1000 XP => +5000 XP
   Cap at MAX_LEVEL
   ========================= */
function purchaseVIP(kind, price) {
  // In demo we don't handle money flows. If you want to charge coins, could deduct a coin cost.
  state.vip = true;
  state.vipLevel = kind;
  // add 5 levels worth XP
  addXP(5 * XP_PER_LEVEL);
  // bonus coins for VIP
  state.coins += 200;
  notify(`VIP –∫—É–ø–ª–µ–Ω: ${kind}. +5 —É—Ä–æ–≤–Ω–µ–π –∏ +200 –º–æ–Ω–µ—Ç`);
  save();
}

/* =========================
   Profile edit/save
   ========================= */
function openEdit(){
  const dlg = document.getElementById('dlg');
  document.getElementById('dlgPreview').src = state.avatar;
  document.getElementById('dlgNick').value = state.nick;
  dlg.showModal();
}
function saveDlg(){
  const nv = document.getElementById('dlgNick').value.trim();
  if(nv) state.nick = nv;
  const preview = document.getElementById('dlgPreview').src;
  if(preview) state.avatar = preview;
  save();
  document.getElementById('dlg').close();
  notify('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
}
document.getElementById('dlgAvatar') && document.getElementById('dlgAvatar').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=> { document.getElementById('dlgPreview').src = r.result; };
  r.readAsDataURL(f);
});
function openEdit() {
  const dlg = document.getElementById('dlg');
  document.getElementById('dlgPreview').src = state.avatar;
  document.getElementById('dlgNick').value = state.nick;
  dlg.showModal();
}
function saveProfile(){
  const nick = document.getElementById('inputNick').value.trim();
  if(nick) state.nick = nick;
  const ai = document.getElementById('inputAvatar');
  if (ai && ai.files && ai.files[0]) {
    const f = ai.files[0];
    const r = new FileReader();
    r.onload = ()=>{ state.avatar = r.result; save(); notify('–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω'); };
    r.readAsDataURL(f);
  } else {
    save();
    notify('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
  }
}
function resetProfile(){
  state.nick = 'Player';
  state.avatar = 'https://i.pravatar.cc/300?img=12';
  save();
  notify('–ü—Ä–æ—Ñ–∏–ª—å —Å–±—Ä–æ—à–µ–Ω');
}

/* =========================
   Utility functions & init
   ========================= */
function escapeHtml(s){ return (s+"").replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

function renderAll(){
  // summary UI
  document.getElementById('uiCoins').textContent = Math.round(state.coins);
  document.getElementById('uiNick').textContent = state.nick;
  document.getElementById('displayName').textContent = state.nick;
  document.getElementById('profileNick').textContent = state.nick;
  document.getElementById('profileAvatar').src = state.avatar;
  document.getElementById('avatarImg').src = state.avatar;
  document.getElementById('uiLevel').textContent = xpToLevel(state.xp);
  const curXP = state.xp % XP_PER_LEVEL;
  document.getElementById('xpText').textContent = `${curXP} / ${XP_PER_LEVEL} XP`;
  document.getElementById('xpBar').style.width = `${(curXP / XP_PER_LEVEL) * 100}%`;
  // VIP
  const vipWrapper = document.getElementById('vipWrapper');
  vipWrapper.innerHTML = '';
  if (state.vip) {
    const b = document.createElement('div'); b.className='vip-badge'; b.textContent = state.vipLevel === 'lifetime' ? 'VIP ¬∑ Forever' : (state.vipLevel === 'year' ? 'VIP ¬∑ Year' : 'VIP ¬∑ Month');
    vipWrapper.appendChild(b);
    document.getElementById('profileVip').innerHTML = '<div class="vip-badge">' + (state.vipLevel === 'lifetime' ? 'VIP ¬∑ Forever' : 'VIP') + '</div>';
  } else {
    document.getElementById('profileVip').innerHTML = '<div class="muted">–ù–µ—Ç VIP</div>';
  }

  // apply frame overlay visually if any
  const af = state.appliedFrame ? FRAMES.find(f=>f.id===state.appliedFrame) : null;
  const avatarFrame = document.getElementById('avatarFrame');
  if (af) {
    // apply frame image as outline via CSS mask approach or overlay ‚Äî we'll set border-image effect by adding overlay element
    avatarFrame.style.boxShadow = '0 18px 48px rgba(124,77,255,0.22)';
    avatarFrame.style.background = 'linear-gradient(90deg,var(--neon1),var(--neon2))';
  } else {
    avatarFrame.style.boxShadow = '0 12px 40px rgba(124,77,255,0.16)';
    avatarFrame.style.background = 'linear-gradient(90deg,var(--neon1),var(--neon2))';
  }

  // owned items list in profile
  const ownedArea = document.getElementById('ownedItems');
  if (ownedArea) {
    ownedArea.innerHTML = state.ownedItems.length ? state.ownedItems.map(id=>`<span style="display:inline-block;padding:6px 8px;margin:6px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent)">${escapeHtml(id)}</span>`).join('') : '<div class="muted">–ù–µ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∫–æ–ª—é—Ö</div>';
  }

  // reflect applied frame visually by adding border-image around avatar (simple method: show overlay image element)
  // remove previous overlay if any
  const existingOverlay = document.getElementById('frameOverlay');
  if (existingOverlay) existingOverlay.remove();
  if (af) {
    const overlay = document.createElement('img');
    overlay.id = 'frameOverlay';
    overlay.src = af.url;
    overlay.style.position = 'absolute';
    overlay.style.width = '152px';
    overlay.style.height = '152px';
    overlay.style.left = (document.getElementById('avatarFrame').getBoundingClientRect().left + window.scrollX) + 'px'; // not used, we'll attach to DOM instead
    // better: append overlay into avatarFrame's parent in relative coordinates
    const parent = document.getElementById('avatarFrame');
    overlay.style.position = 'absolute';
    overlay.style.left = '50%';
    overlay.style.top = '50%';
    overlay.style.transform = 'translate(-50%,-50%)';
    overlay.style.borderRadius = '50%';
    overlay.style.pointerEvents = 'none';
    overlay.style.boxShadow = '0 12px 30px rgba(0,0,0,0.6)';
    overlay.style.mixBlendMode = 'screen';
    overlay.style.opacity = '0.95';
    overlay.style.width = '140px';
    overlay.style.height = '140px';
    parent.appendChild(overlay);
  }

  // render grids
  renderFramesGrid();
  renderCoinPacks();
  renderShopItems();
  renderLoaders();
  renderLoaderFilter();
}

function goTab(tab) {
  // tabs: buy, vip, profile, shop
  ['buy','vip','profile','shop'].forEach(t=>{
    const el = document.getElementById('page-'+t);
    if (el) el.style.display = 'none';
    const btn = document.getElementById('tab-'+t);
    if (btn) btn.classList.remove('active');
  });
  document.getElementById('page-'+tab).style.display = 'block';
  const btn = document.getElementById('tab-'+tab);
  if (btn) btn.classList.add('active');
}

function renderShopItems(){ renderShopItemsInner(); } // alias for earlier function definition
function renderCoinPacks(){ renderCoinPacksInner(); } // alias binding
// but we actually defined functions with these names earlier; ensure we call them

// The functions renderCoinPacks and renderShopItems are declared earlier; ensure presence
// (they already exist above)

/* =========================
   Small helpers
   ========================= */
function notifyAndPersist(msg){
  notify(msg);
  save();
}

/* =========================
   Demo auth
   ========================= */
function authDemo(){ notify('DEMO: –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –≥–æ—Å—Ç—å'); }

/* =========================
   Helpers & init
   ========================= */
function demoGainXP(){ addXP(200); notify('DEMO: +200 XP') }
function purchaseVIP(kind, price){ state.vip = true; state.vipLevel = kind; // grant +5 levels
  addXP(5 * XP_PER_LEVEL);
  // also grant some coins as bonus
  state.coins += 500;
  notify(`VIP –∫—É–ø–ª–µ–Ω: ${kind} ‚Äî +5 —É—Ä–æ–≤–Ω–µ–π –∏ +500 –º–æ–Ω–µ—Ç`);
  save();
}

function renderCoinPacksInner(){
  const grid = document.getElementById('coinGrid'); if(!grid) return;
  grid.innerHTML = '';
  COIN_PACKS.forEach(p=>{
    const el = document.createElement('div'); el.className='coin-pack';
    el.style.padding='12px';
    el.style.borderRadius='10px';
    el.style.background='linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))';
    el.style.border='1px solid rgba(255,255,255,0.03)';
    el.innerHTML = `<div style="font-weight:900">${p.coins} –º–æ–Ω–µ—Ç</div><div style="color:var(--muted)">${p.price} ‚ÇΩ</div>`;
    const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='–ö—É–ø–∏—Ç—å';
    btn.onclick = ()=>{ state.coins += p.coins; addXP(Math.round(p.coins/5)); notify(`–ö—É–ø–ª–µ–Ω–æ ${p.coins} –º–æ–Ω–µ—Ç ‚Äî +${Math.round(p.coins/5)} XP`); save(); };
    el.appendChild(btn);
    grid.appendChild(el);
  });
}

function renderShopItemsInner(){
  const grid = document.getElementById('itemsGrid'); if(!grid) return;
  grid.innerHTML = '';
  SHOP_ITEMS.forEach(it=>{
    const div = document.createElement('div'); div.className='item-card';
    div.innerHTML = `<div class="item-thumb">${escapeHtml(it.title)}</div>
      <div style="font-weight:800;margin-top:8px">${escapeHtml(it.title)}</div>
      <div class="muted" style="font-size:13px">${escapeHtml(it.desc)}</div>
      <div style="display:flex;align-items:center;margin-top:8px;gap:8px">
        <div style="flex:1;color:var(--muted)">${it.price} –º–æ–Ω–µ—Ç</div>
        <button class="btn primary">${it.vipOnly ? 'VIP' : '–ö—É–ø–∏—Ç—å'}</button>
      </div>`;
    const btn = div.querySelector('button');
    btn.onclick = ()=>{
      if (it.vipOnly && !state.vip) { notify('–¢—Ä–µ–±—É–µ—Ç—Å—è VIP'); goTab('vip'); return; }
      if (state.coins < it.price) { notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç'); return; }
      state.coins -= it.price;
      state.ownedItems.push(it.id);
      addXP(Math.round(it.price/2));
      notify(`–ö—É–ø–ª–µ–Ω–æ ${it.title}. +${Math.round(it.price/2)} XP`);
      save();
    };
    grid.appendChild(div);
  });
}

/* =========================
   Ensure initial load and render
   ========================= */
load();
renderAll();
goTab('buy');

/* Attach change listeners for filter selects */
document.getElementById('filterType').addEventListener('change', renderLoaders);
document.getElementById('filterGame').addEventListener('change', renderLoaders);

/* Attach avatar file input on profile */
document.getElementById('inputAvatar').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{ state.avatar = reader.result; save(); notify('–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω'); };
  reader.readAsDataURL(f);
});

// function alias compatibility (some functions declared earlier)
function renderShopItemsInnerFallback(){ renderShopItemsInner(); }

// helper to purchase VIP via buttons
function buyVIPPlan(kind){
  purchaseVIP(kind, 0);
}

// small wrappers for older named functions referenced earlier
function purchaseVIP(kind, price){ purchaseVIP && purchaseVIP(kind, price); } // noop guard (overwritten above)

// expose some functions to console for testing
window._GL = { state, save, load, addXP, purchaseVIP, buyCoins: (p)=>{ state.coins+=p.coins; addXP(Math.round(p.coins/5)); save(); } };

</script>
</body>
</html>
